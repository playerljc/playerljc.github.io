"use strict";(self.webpackChunk_ctsj_build=self.webpackChunk_ctsj_build||[]).push([[8798,5447],{15447:(t,e,o)=>{o.r(e),o.d(e,{default:()=>r});var n=o(88724),i=function(){return(i=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};const r={flyToChina:function(t){t.centerAndZoom(new BMap.Point(106.638754,34.842904),2)},fillCityBoundary:function(t,e,o){var n=[],r=[];return new Promise((function(a){(new BMap.Boundary).get(t,(function(t){for(var s=0;s<t.boundaries.length;s++){var l=((l=t.boundaries[s]).split(";").forEach((function(t){t=t.trim().split(","),r.push(new BMap.Point(parseFloat(t[0].trim()),parseFloat(t[1].trim())))})),new BMap.Polygon(l,i({},e)));n.push(l),o.addOverlay(l)}a({cityOverlays:n,cityPoints:r})}))}))},fit:function(t,e,o){return new Promise((function(n){var i=t.getViewport(e,null!=o?o:{});t.centerAndZoom(i.center,i.zoom),setTimeout((function(){n(null)}),200)}))},pixelToPoint:function(t,e){return t.pixelToPoint(e)},pointToPixel:function(t,e){return t.pointToPixel(e)},getBound:function(t){var e=(t=t.getBounds()).getSouthWest();t=t.getNorthEast();return{leftTopLon:e.lng,leftTopLat:t.lat,rightBottomLon:t.lng,rightBottomLat:e.lat}},getScale:function(t){var e=t.getCenter(),o=t.pointToPixel(e),n=new BMap.Point(e.lng,e.lat+.001),i=t.pointToPixel(n);return((i=Math.abs(i.y-o.y))<=0?1:i)/t.getDistance(e,n)},getUnitPixelToM:function(t){return Math.pow(2,18-t)},getArrowPoints:function(t){var e=t.from,o=t.to,n=void 0===(n=t.scale)?1:n,i=void 0===(i=t.width)?5:i,r=(t=void 0===(t=t.theta)?35:t,e.x),a=(e=e.y,o.x);o=o.y,r=((e=180*Math.atan2(e-o,r-a)/Math.PI)+t)*Math.PI/180,e=(e-t)*Math.PI/180;return{A:{x:(t=a+i*Math.cos(r))*n,y:(r=o+i*Math.sin(r))*n},B:{x:a*n,y:o*n},C:{x:(a+i*Math.cos(e))*n,y:(o+i*Math.sin(e))*n}}},clientToCtxPointToEl:function(t){var e=t.event,o=t.rect,n=(t=t.offsetEl,(t="undefined"!=typeof window?window.getComputedStyle(t,null):{left:"0",top:"0"}).left);t=t.top,n=parseInt(n.replace("px","")),t=parseInt(t.replace("px",""));return this.clientToCtxPoint({event:e,rect:o,offsetLeft:n,offsetTop:t})},clientToCtxPoint:function(t){var e=t.event,o=t.rect,i=t.offsetLeft;t=t.offsetTop;return(e=n.A.clientToCtxPoint({event:e,rect:o})).x-=i,e.y-=t,e}}},8798:(t,e,o)=>{o.r(e),o.d(e,{Feature:()=>v,Format:()=>i,Geom:()=>r,ImageCache:()=>C,InnerTextFeature:()=>j,Interaction:()=>s,Styles:()=>l,Trajectory:()=>c,Types:()=>n,VectorLayer:()=>N,VectorSource:()=>Kt});var n={};o.r(n),o.d(n,{GeoJSONType:()=>d,GeometryType:()=>p,TrajectoryStatus:()=>f,VectorActions:()=>h,VectorEventActions:()=>y});var i={};o.r(i),o.d(i,{GeoJSONFormat:()=>Jt});var r={};o.r(r),o.d(r,{CircleGeometry:()=>it,Geometry:()=>H,LeafGeometry:()=>lt,LineStringGeometry:()=>J,MultiCircleGeometry:()=>oe,MultiLeafGeometry:()=>ae,MultiLineStringGeometry:()=>tt,MultiPointGeometry:()=>Rt,MultiPolygonGeometry:()=>Zt,MultiRadiusRectGeometry:()=>he,MultiRectGeometry:()=>ue,MultiRegularPolygonGeometry:()=>xe,MultiSectorGeometry:()=>Ce,MultiStartGeometry:()=>De,PointGeometry:()=>Et,PolygonGeometry:()=>Ht,RadiusRectGeometry:()=>gt,RectGeometry:()=>yt,RegularPolygonGeometry:()=>Tt,SectorGeometry:()=>wt,StartGeometry:()=>Ot,TextGeometry:()=>je});var a={};o.r(a),o.d(a,{ActionEvents:()=>ze,ActionStatus:()=>be,ActionType:()=>Ne,InteractionLayerActions:()=>Be,SelectType:()=>Re});var s={};o.r(s),o.d(s,{CircleDrawAction:()=>Ye,CircleModifyAction:()=>bo,DefaultAnchorStyle:()=>Ae,DefaultMoveGemStyle:()=>Le,DefaultStyle:()=>Ee,DiamondDrawAction:()=>Qe,DiamondModifyAction:()=>No,DistanceDrawAction:()=>ro,DrawAction:()=>He,FreeDrawAction:()=>lo,InteractionLayer:()=>Do,ModifyAction:()=>Oo,PolygonDrawAction:()=>to,PolygonModifyAction:()=>Wo,RectangleDrawAction:()=>po,RectangleModifyAction:()=>Zo,StartDrawAction:()=>fo,StartModifyAction:()=>Xo,TriangleDrawAction:()=>Mo,TriangleModifyAction:()=>en,Types:()=>a,Util:()=>Fe});var l={};o.r(l),o.d(l,{AnchorStyle:()=>on,DistancePointStyle:()=>Xe,GeometryStyle:()=>u,MoveGeomStyle:()=>nn,TextStyle:()=>P});var c={};o.r(c),o.d(c,{Trajectory:()=>sn,TrajectoryPlayBackLayer:()=>yn});const u={fillStyle:"rgb(91,155,213,1)",strokeStyle:"rgba(0,0,0,.8)",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[],lineDashOffset:-1,globalAlpha:1};var p,y,h,d,f,g;(g=p=p||{}).Point="Point",g.MultiPoint="MultiPoint",g.Circle="Circle",g.MultiCircle="MultiCircle",g.LineString="LineString",g.MultiLineString="MultiLineString",g.Polygon="Polygon",g.MultiPolygon="MultiPolygon",g.Rect="Rect",g.RadiusRect="RadiusRect",g.MultiRadiusRect="MultiRadiusRect",g.Leaf="Leaf",g.MultiLeaf="MultiLeaf",g.MultiRect="MultiRect",g.Text="Text",g.RegularPolygon="RegularPolygon",g.MultiRegularPolygon="MultiRegularPolygon",g.Start="Start",g.MultiStart="MultiStart",g.Sector="Sector",g.MultiSector="MultiSector",function(t){t.FEATURE_CLICK="feature:click",t.VECTOR_CLICK="vector:click"}(y=y||{}),function(t){t.UPDATE="UPDATE",t.APPEND="APPEND"}(h=h||{}),function(t){t.Point="Point",t.MultiPoint="MultiPoint",t.LineString="LineString",t.MultiLineString="MultiLineString",t.Polygon="Polygon",t.MultiPolygon="MultiPolygon",t.GeometryCollection="GeometryCollection",t.Feature="Feature",t.FeatureCollection="FeatureCollection"}(d=d||{}),function(t){t[t.UnInit=0]="UnInit",t[t.Init=1]="Init",t[t.Running=2]="Running",t[t.Pause=3]="Pause",t[t.End=4]="End",t[t.Destroy=5]="Destroy"}(f=f||{});var x=function(){function t(t){this.name="",this.id="",this.style=u,this.zIndex=1,this.properties={},this.name=null==t?void 0:t.name,this.id=null==t?void 0:t.id,this.properties=null==t?void 0:t.properties,this.style=null==t?void 0:t.style,this.geometry=null==t?void 0:t.geometry,this.setGeometryContext()}return t.prototype.setGeometryContext=function(){this.geometry&&this.geometry.setContext(this)},t.prototype.draw=function(t){this.geometry.draw(t,this.style)},t.prototype.getGeometry=function(){return this.geometry},t.prototype.getId=function(){return this.id},t.prototype.getName=function(){return this.name},t.prototype.getStyle=function(){return this.style},t.prototype.getZIndex=function(){return this.zIndex},t.prototype.getProperties=function(){return this.properties},t.prototype.setGeometry=function(t){this.geometry=t,this.setGeometryContext(),null!=(t=null==(t=this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},t.prototype.setStyle=function(t){this.style=t,null!=(t=null==(t=this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},t.prototype.setId=function(t){this.id=t},t.prototype.setName=function(t){this.name=t},t.prototype.setZIndex=function(t){this.zIndex=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},t.prototype.setProperties=function(t){this.properties=t},t.prototype.getContext=function(){return this.context},t.prototype.setContext=function(t){this.context=t},t.prototype.getLayer=function(){var t;return null==(t=null==this?void 0:this.getContext())?void 0:t.getContext()},t.prototype.getMap=function(){var t;return null==(t=null==this?void 0:this.getLayer())?void 0:t.getMap()},t.prototype.isPointInFeature=function(t,e){return this.geometry.isPixelInGeometry(t,e)},t}();const v=x;var M=new Map,T={add:function(t,e){return M.set(JSON.stringify(t),e)},get:function(t){return M.get(JSON.stringify(t))},delete:function(t){return M.delete(JSON.stringify(t))},clear:function(){M.clear()},values:function(){return Array.from(M.values())},keys:function(){return Array.from(M.keys()).map((function(t){return JSON.parse(t)}))}};const C=T;var m=function(){return(m=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};const P=m({font:"10px sans-serif",textAlign:"start",textBaseline:"middle",direction:"inherit"},u);var w,D=(w=function(t,e){return(w=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),S=function(){return(S=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},I=function(t,e){var o={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(o[i[n]]=t[i[n]]);return o},O=function(t){function e(e){var o=this,n=(e.text,e.textStyle,I(e,["text","textStyle"]));return(o=t.call(this,n)||this).text=e.text,o.textStyle=e.textStyle,o}return D(e,t),e.prototype.getText=function(){return this.text},e.prototype.getTextStyle=function(){return this.textStyle},e.prototype.setText=function(t){this.text=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},e.prototype.setTextStyle=function(t){this.textStyle=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},e.prototype.draw=function(e){t.prototype.draw.call(this,e),this.geometry.drawText({ctx:e,text:this.text,style:this.style,textStyle:this.textStyle||S({},P)})},e}(v);const j=O;var A,L=o(88724),E=o(54043),b=(A=function(t,e){return(A=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),z=function(){return(z=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},B=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},R=function(t){function e(e,o){var n=this;return n.update=n.update.bind(n),(n=t.call(this,{update:n.update,paneName:o.paneName,zIndex:o.zIndex})||this).isLoad=!1,n.emitter=new E.A.Events,n.map=e,n.config=z({},o),n.source=o.source,n.source&&n.source.setContext(n),n.onUpdate=n.onUpdate.bind(n),n.initEvents(),n}return b(e,t),e.prototype.getSource=function(){return this.source},e.prototype.getZIndex=function(){return this.config.zIndex},e.prototype.setSource=function(t){this.source=t,this.source&&this.source.setContext(this),this.update()},e.prototype.drawSource=function(){var t=this.source.getFeatures(),e=(t.sort((function(t,e){return t.getZIndex()>e.getZIndex()?1:t.getZIndex()<e.getZIndex()?-1:0})),this.canvas.getContext("2d"));e&&(t||[]).forEach((function(t){t.draw(e)}))},e.prototype.firstLoad=function(){this.initCanvasEvents()},e.prototype.update=function(){var t=this.canvas.getContext("2d");t&&(this.isLoad||this.firstLoad(),this.isLoad=!0,t.clearRect(0,0,t.canvas.width,t.canvas.height),this.drawSource())},e.prototype.getMap=function(){return this.map},e.prototype.getEmitter=function(){return this.emitter},e.prototype.addEventListener=function(t,e){this.emitter.on(t,e)},e.prototype.removeEventListener=function(t,e){this.emitter.remove(t,e)},e.prototype.initCanvasEvents=function(){var t=this;this.canvas.addEventListener("click",(function(e){var o=L.A.clientToCtxPoint({event:e,rect:t.canvas.getBoundingClientRect()});(e=t.source.getFeatures().filter((function(t){return t.isPointInFeature(o,t.getStyle())}))).length?t.emitter.trigger(y.FEATURE_CLICK,{features:B([],e,!0),pixel:o}):t.emitter.trigger(y.VECTOR_CLICK)}))},e.prototype.initEvents=function(){this.emitter.on(h.UPDATE,this.onUpdate)},e.prototype.onUpdate=function(){this.update()},e}(BMap.CanvasLayer);const N=R;var _=o(15447),k=function(){return(k=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},G=function(){function t(){this.context=null}return t.prototype.setContext=function(t){this.context=t},t.prototype.getContext=function(){return this.context},t.prototype.drawText=function(t){var e=t.ctx,o=t.text,n=t.style;t=t.textStyle,e.beginPath(),e.save(),t=k(k({},P),null!=t?t:{}),e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.direction=t.direction,e.strokeStyle=t.strokeStyle,e.fillStyle=t.fillStyle,t=k(k({},u),null!=n?n:{}),e.lineWidth=t.lineWidth,e.lineJoin=t.lineJoin,e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.strokeStyle=t.strokeStyle,t=this.getCenterCoordinate({ctx:e,style:n,isScale:!0});e.fillText(o||"",t.x,t.y),e.restore()},t.prototype.getMap=function(){var t;return null==(t=null==this?void 0:this.getLayer())?void 0:t.getMap()},t.prototype.getLayer=function(){var t=this.getContext();return t?t.getContext().getContext():null},t}();const H=G;var W,U=(W=function(t,e){return(W=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}W(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Y=function(){return(Y=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},F=new Map([["small",3],["normal",10],["large",20]]),Z=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return U(e,t),e.drawStartArrow=function(t){var e=t.ctx,o=t.style,n=t.coordinates,i=(t=t.map,e.save(),e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,t.pointToPixel(new BMap.Point(n.point1.lng,n.point1.lat)));t=t.pointToPixel(new BMap.Point(n.point2.lng,n.point2.lat)),t=(n=_.default.getArrowPoints({from:t,to:i,scale:1,width:F.get(o.arrow.size)})).A,i=n.B,o=n.C;e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(o.x,o.y),e.closePath(),e.stroke(),e.fill(),e.restore()},e.drawEndArrow=function(t){var e=t.ctx,o=t.style,n=t.coordinates,i=(t=t.map,e.save(),e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,t.pointToPixel(new BMap.Point(n.point1.lng,n.point1.lat)));t=t.pointToPixel(new BMap.Point(n.point2.lng,n.point2.lat)),i=(n=_.default.getArrowPoints({from:i,to:t,scale:1,width:F.get(o.arrow.size)})).A,t=n.B,o=n.C;e.moveTo(i.x,i.y),e.lineTo(t.x,t.y),e.lineTo(o.x,o.y),e.closePath(),e.stroke(),e.fill(),e.restore()},e.drawLineString=function(t){var o=t.ctx,n=t.style,i=t.coordinates,r=(t=t.map,o.save(),Y(Y(Y({},u),null!=n?n:{}),{arrow:{draw:!1,direction:"end",type:"normal",size:"normal"}})),a=(o.beginPath(),o.lineWidth=r.lineWidth,o.lineJoin=r.lineJoin,o.lineCap=r.lineCap,o.setLineDash(r.lineDash),o.lineDashOffset=r.lineDashOffset,o.strokeStyle=r.strokeStyle,i.point1),s=i.point2;a=t.pointToPixel(new BMap.Point(a.lng,a.lat)),s=t.pointToPixel(new BMap.Point(s.lng,s.lat));o.moveTo(a.x,a.y),o.lineTo(s.x,s.y),o.stroke(),o.restore(),n.arrow.draw&&("start"===n.arrow.direction?e.drawStartArrow({ctx:o,style:r,coordinates:i,map:t}):"end"===n.arrow.direction?e.drawEndArrow({ctx:o,style:r,coordinates:i,map:t}):"bothEnds"===n.arrow.direction&&(e.drawStartArrow({ctx:o,style:r,coordinates:i,map:t}),e.drawEndArrow({ctx:o,style:r,coordinates:i,map:t})))},e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return Y({},this.coordinates)},e.prototype.getType=function(){return p.LineString},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map;t.style,t.isScale,t=e.point1,e=e.point2,t=o.pointToPixel(new BMap.Point(t.lng,t.lat)),o=o.pointToPixel(new BMap.Point(e.lng,e.lat));return L.A.midpoint(t,o)},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({ctx:o,coordinates:this.coordinates,map:this.getMap(),style:n,isScale:t})},e.prototype.draw=function(t,o){e.drawLineString({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap()})},e.prototype.drawText=function(t){var e=t.ctx,o=t.text,n=t.style,i=(t=t.textStyle,e.save(),e.beginPath(),this.getMap()),r=this.getCenterCoordinate({ctx:e,style:n,isScale:!0}),a=(r=(e.translate(r.x,r.y),this.coordinates)).point1;r=r.point2,a=i.pointToPixel(new BMap.Point(a.lng,a.lat)),i=i.pointToPixel(new BMap.Point(r.lng,r.lat)),r=L.A.slopToRadian(a,i),e.rotate(r),a=Y(Y({},P),null!=t?t:{}),e.font=a.font,e.textAlign=a.textAlign,e.textBaseline=a.textBaseline,e.direction=a.direction,e.strokeStyle=a.strokeStyle,e.fillStyle=a.fillStyle,i=Y(Y({},u),null!=n?n:{});e.lineWidth=i.lineWidth,e.lineJoin=i.lineJoin,e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.strokeStyle=i.strokeStyle,e.fillText(o||"",0,0),e.restore()},e.isPixelInGeometry=function(t){var e=t.pixel,o=(t.style,t.coordinates),n=(t=t.map,document.createElement("canvas").getContext("2d"));if(!n)return!1;n.beginPath();var i=o.point1;o=o.point2,i=t.pointToPixel(new BMap.Point(i.lng,i.lat)),t=t.pointToPixel(new BMap.Point(o.lng,o.lat));return n.moveTo(i.x,i.y),n.lineTo(t.x,t.y),n.isPointInPath(e.x,e.y)},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({pixel:t,style:o,coordinates:this.coordinates,map:this.getMap()})},e}(H);const J=Z;var Q,V=o(23172),X=(Q=function(t,e){return(Q=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}Q(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),K=function(){return(K=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},q=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},$=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return X(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return q([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiLineString},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap(),o=[];t.forEach((function(t){var n=e.pointToPixel(new BMap.Point(t.point1.lng,t.point1.lat));t=e.pointToPixel(new BMap.Point(t.point2.lng,t.point2.lat));o.push(V.zx7([n.x,n.y])),o.push(V.zx7([t.x,t.y]))})),t=V.Lrk(o);return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this,n=this.coordinates,i=K(K(K({},u),null!=e?e:{}),{arrow:{draw:!1,direction:"end",type:"normal",size:"normal"}});n.forEach((function(e){J.drawLineString({ctx:t,style:i,coordinates:e,map:o.getMap()})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return J.isPixelInGeometry({pixel:t,style:e,coordinates:n,map:o.getMap()})}))},e}(H);const tt=$;var et=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ot=function(){return(ot=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},nt=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return et(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return ot({},this.coordinates)},e.prototype.getType=function(){return p.Circle},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map;t.style,t.isScale,t=o.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return ot({},t)},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:t})},e.drawCircle=function(t){var e=t.ctx,o=t.style,n=t.coordinates,i=t.map;t=t.isScale,e.save(),e.beginPath(),o=ot(ot({},u),null!=o?o:{}),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,o=n.center,n=n.radius,o=i.pointToPixel(new BMap.Point(o.lng,o.lat)),i=_.default.getScale(i),t=t?i*n:n;e.ellipse(o.x,o.y,t,t,45*Math.PI/180,0,2*Math.PI),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawCircle({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var o=t.coordinates,n=t.map,i=t.style,r=t.pixel,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawCircle({ctx:a,coordinates:o,style:i,map:n,isScale:t}),a.isPointInPath(r.x,r.y))},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:o,pixel:t,isScale:!0})},e}(H);const it=nt;var rt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),at=function(){return(at=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},st=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return rt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return at({},this.coordinates)},e.prototype.getType=function(){return p.Leaf},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map;t.style,t.isScale,t=o.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return at({},t)},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:t})},e.drawLeaf=function(t){for(var e=t.ctx,o=t.style,n=t.coordinates,i=t.map,r=(t=t.isScale,o=(e.save(),at(at({},u),null!=o?o:{})),e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,n.n),a=(o=n.center,n.size),s=a,l=n=n.length,c=(t&&(s=(t=_.default.getScale(i))*a,l=t*n),i.pointToPixel(new BMap.Point(o.lng,o.lat))),p=(e.moveTo(c.x,c.y+s),2*Math.PI/r),y=1;y<r+1;y++){var h=Math.sin((y-1)*p)*l+c.x,d=Math.cos((y-1)*p)*l+c.y,f=Math.sin(y*p)*l+c.x,g=Math.cos(y*p)*l+c.y,x=Math.sin(y*p)*s+c.x,v=Math.cos(y*p)*s+c.y;e.bezierCurveTo(h,d,f,g,x,v)}e.closePath(),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawLeaf({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var o=t.coordinates,n=t.map,i=t.pixel,r=t.style,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawLeaf({ctx:a,coordinates:o,style:r,map:n,isScale:t}),a.isPointInPath(i.x,i.y))},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:o,isScale:!0,pixel:t})},e}(H);const lt=st;var ct=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ut=function(){return(ut=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},pt=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return ct(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return ut({},this.coordinates)},e.prototype.getType=function(){return p.Rect},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map,n=(t=(t.style,t.isScale),e.leftTop),i=e.width,r=(e=e.height,n=o.pointToPixel(new BMap.Point(n.lng,n.lat)),o=_.default.getScale(o),i),a=e;t&&(r=o*i,a=o*e),t=V.Lrk([V.zx7([n.x,n.y]),V.zx7([n.x+r,n.y]),V.zx7([n.x+r,n.y+a]),V.zx7([n.x,n.y+a])]);return{x:(i=V.gXo(t)).geometry.coordinates[0],y:i.geometry.coordinates[1]}},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:t})},e.drawRect=function(t){var e=t.ctx,o=t.style,n=t.coordinates,i=t.map,r=(t=t.isScale,o=(e.save(),ut(ut({},u),null!=o?o:{})),o=(e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,n.leftTop),n.width),a=(n=n.height,o=i.pointToPixel(new BMap.Point(o.lng,o.lat)),i=_.default.getScale(i),r),s=n;t&&(a=i*r,s=i*n),e.rect(o.x,o.y,a,s),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawRect({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var o=t.coordinates,n=t.map,i=t.style,r=t.pixel,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawRect({ctx:a,coordinates:o,style:i,map:n,isScale:t}),a.isPointInPath(r.x,r.y))},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:o,isScale:!0,pixel:t})},e}(H);const yt=pt;var ht=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),dt=function(){return(dt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ft=function(t){function e(e){var o=t.call(this,e)||this;return o.coordinates=e,o}return ht(e,t),e.prototype.getType=function(){return p.RadiusRect},e.drawRadiusRect=function(t){var e=t.ctx,o=t.style,n=t.coordinates,i=t.map,r=(t=t.isScale,o=dt(dt({},u),null!=o?o:{}),o=(e.save(),e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,n.leftTop),n.width),a=n.height,s=(n=n.radius,o=i.pointToPixel(new BMap.Point(o.lng,o.lat)),i=_.default.getScale(i),r),l=a,c=n;t&&(s=i*r,l=i*a,c=i*n),e.moveTo(o.x,o.y+c),e.arcTo(o.x,o.y,o.x+c,o.y,c),e.lineTo(o.x+s-c,o.y),t={x:o.x+s-c,y:o.y},e.arcTo(t.x+c,o.y,t.x+c,o.y+c,c),t={x:t.x+c,y:o.y+c},e.lineTo(t.x,t.y+(l-2*c)),e.arcTo((t={x:t.x,y:t.y+(l-2*c)}).x,t.y+c,t.x-c,t.y+c,c),e.lineTo((t={x:t.x-c,y:t.y+c}).x-(s-2*c),t.y),e.arcTo((t={x:t.x-(s-2*c),y:t.y}).x-c,t.y,t.x-c,t.y-c,c),e.lineTo((t={x:t.x-c,y:t.y-c}).x,t.y-(l-2*c)),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawRadiusRect({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e}(yt);const gt=ft;var xt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),vt=function(){return(vt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Mt=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return xt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return vt({},this.coordinates)},e.prototype.getType=function(){return p.RegularPolygon},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map;t.style,t.isScale,t=o.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return vt({},t)},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:t})},e.drawRegularPolygon=function(t){for(var e=t.ctx,o=t.style,n=t.coordinates,i=t.map,r=(t=t.isScale,o=(e.save(),vt(vt({},u),null!=o?o:{})),e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,n.n),a=(o=n.center,n=n.size),s=(t&&(a=_.default.getScale(i)*n),i.pointToPixel(new BMap.Point(o.lng,o.lat))),l=2*Math.PI/r,c=0;c<r;c++){var p=Math.cos(c*l),y=Math.sin(c*l);e.lineTo(p*a+s.x,y*a+s.y)}e.closePath(),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawRegularPolygon({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var o=t.coordinates,n=t.map,i=t.pixel,r=t.style,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawRegularPolygon({ctx:a,coordinates:o,style:r,map:n,isScale:t}),a.isPointInPath(i.x,i.y))},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:o,isScale:!0,pixel:t})},e}(H);const Tt=Mt;var Ct=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),mt=function(){return(mt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Pt=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return Ct(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return mt({},this.coordinates)},e.prototype.getType=function(){return p.Sector},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map;t.style,t.isScale,t=o.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return mt({},t)},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:t})},e.drawSector=function(t){var e=t.ctx,o=t.style,n=t.coordinates,i=t.map,r=(t=t.isScale,o=(e.save(),mt(mt({},u),null!=o?o:{})),o=(e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,n.center),n.radius),a=n.angle1,s=(n=n.angle2,r);t&&(s=_.default.getScale(i)*r),t=i.pointToPixel(new BMap.Point(o.lng,o.lat));e.moveTo(t.x,t.y),e.arc(t.x,t.y,s,a*Math.PI/180,n*Math.PI/180,!1),e.closePath(),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawSector({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var o=t.coordinates,n=t.map,i=t.style,r=t.pixel,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawSector({ctx:a,coordinates:o,style:i,map:n,isScale:t}),a.isPointInPath(r.x,r.y))},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:o,pixel:t,isScale:!0})},e}(H);const wt=Pt;var Dt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),St=function(){return(St=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},It=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return Dt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return St({},this.coordinates)},e.prototype.getType=function(){return p.Start},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map;t.style,t.isScale,t=o.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return St({},t)},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:t})},e.drawStart=function(t){for(var e=t.ctx,o=t.style,n=t.coordinates,i=t.map,r=(t=t.isScale,o=(e.save(),St(St({},u),null!=o?o:{})),o=(e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle,n.center),n.innerRadius),a=r,s=n=n.outRadius,l=(t&&(a=(t=_.default.getScale(i))*r,s=t*n),i.pointToPixel(new BMap.Point(o.lng,o.lat))),c=0;c<5;c++)e.lineTo(Math.cos((18+72*c)/180*Math.PI)*s+l.x,-Math.sin((18+72*c)/180*Math.PI)*s+l.y),e.lineTo(Math.cos((54+72*c)/180*Math.PI)*a+l.x,-Math.sin((54+72*c)/180*Math.PI)*a+l.y);e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawStart({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var o=t.coordinates,n=t.map,i=t.pixel,r=t.style,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawStart({ctx:a,coordinates:o,style:r,map:n,isScale:t}),a.isPointInPath(i.x,i.y))},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),isScale:!0,style:o,pixel:t})},e}(H);const Ot=It;var jt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),At=function(){return(At=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Lt=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return jt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return At({},this.coordinates)},e.prototype.getType=function(){return p.Point},e.getCenterCoordinate=function(t){var o=t.ctx,n=t.coordinates,i=t.map,r=t.style;t=t.isScale;return e.centerCoordinateMapping.get(r.pointType)({ctx:o,coordinates:n,map:i,style:r,isScale:t})},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;return t.isScale,e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:!1})},e.drawCirclePoint=function(t){var e=t.ctx,o=t.style,n=t.coordinates;t=t.map;it.drawCircle({ctx:e,style:o,coordinates:{radius:o.radius,center:n},map:t,isScale:!1})},e.drawImagePoint=function(t){var e,o=t.ctx,n=t.style,i=t.coordinates,r=t.map.pointToPixel(new BMap.Point(i.lng,i.lat));(i=C.get({src:(null==(t=null==n?void 0:n.img)?void 0:t.src)||"",width:(null==(i=null==n?void 0:n.img)?void 0:i.width)||0,height:(null==(t=null==n?void 0:n.img)?void 0:t.height)||0}))?o.drawImage(i,r.x,r.y,n.img.width,n.img.height):((e=new Image(n.img.width,n.img.height)).onload=function(){var t;C.add({src:(null==(t=null==n?void 0:n.img)?void 0:t.src)||"",width:(null==(t=null==n?void 0:n.img)?void 0:t.width)||0,height:(null==(t=null==n?void 0:n.img)?void 0:t.height)||0},e),o.drawImage(e,r.x,r.y,n.img.width,n.img.height)},e.src=n.img.src)},e.drawRegularPolygon=function(t){var e=t.ctx,o=t.style,n=t.coordinates;t=t.map;Tt.drawRegularPolygon({ctx:e,style:o,coordinates:At(At({},o.regularPolygon),{center:n}),map:t,isScale:!1})},e.drawStart=function(t){var e=t.ctx,o=t.style,n=t.coordinates;t=t.map;Ot.drawStart({ctx:e,style:o,coordinates:At(At({},o.start),{center:n}),map:t,isScale:!1})},e.drawSector=function(t){var e=t.ctx,o=t.style,n=t.coordinates;t=t.map;wt.drawSector({ctx:e,style:o,coordinates:At(At({},o.sector),{center:n}),map:t,isScale:!1})},e.drawRect=function(t){var e=t.ctx,o=t.style,n=t.coordinates;t=t.map;yt.drawRect({ctx:e,style:o,coordinates:At(At({},o.rect),{leftTop:n}),map:t,isScale:!1})},e.drawRadiusRect=function(t){var e=t.ctx,o=t.style,n=t.coordinates;t=t.map;gt.drawRadiusRect({ctx:e,style:o,coordinates:At(At({},o.radiusRect),{leftTop:n}),map:t,isScale:!1})},e.drawLeaf=function(t){var e=t.ctx,o=t.style,n=t.coordinates;t=t.map;lt.drawLeaf({ctx:e,style:o,coordinates:At(At({},o.leaf),{center:n}),map:t,isScale:!1})},e.drawPoint=function(t){var o=t.ctx,n=t.style,i=t.coordinates;t=t.map,n=At(At(At({},u),{radius:5,pointType:"circle"}),null!=n?n:{});e.drawMapping.get(null==n?void 0:n.pointType)({ctx:o,style:n,coordinates:i,map:t})},e.prototype.draw=function(t,o){e.drawPoint({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap()})},e.isPixelInGeometry=function(t){var o=t.coordinates,n=t.map,i=t.pixel;t=t.style;return e.isPixelInGeometryMapping.get(null==t?void 0:t.pointType)({coordinates:e.pointTypeToCoordinatesMapping.get(null==t?void 0:t.pointType)(o,t),isScale:!1,map:n,style:t,pixel:i})},e.prototype.isPixelInGeometry=function(t,o){return e.isPixelInGeometry({coordinates:this.coordinates,pixel:t,map:this.getMap(),style:o})},e.drawMapping=new Map([["circle",e.drawCirclePoint],["image",e.drawImagePoint],["regularPolygon",e.drawRegularPolygon],["start",e.drawStart],["sector",e.drawSector],["rect",e.drawRect],["radiusRect",e.drawRadiusRect],["leaf",e.drawLeaf]]),e.isPixelInGeometryMapping=new Map([["circle",it.isPixelInGeometry],["image",yt.isPixelInGeometry],["regularPolygon",Tt.isPixelInGeometry],["start",Ot.isPixelInGeometry],["sector",wt.isPixelInGeometry],["rect",yt.isPixelInGeometry],["radiusRect",gt.isPixelInGeometry],["leaf",lt.isPixelInGeometry]]),e.centerCoordinateMapping=new Map([["circle",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return it.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:{center:o,radius:i.radius}})}],["image",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return yt.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:At({leftTop:o},i.img)})}],["regularPolygon",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return Tt.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:At({center:o},i.regularPolygon)})}],["start",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return Ot.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:At({center:o},i.start)})}],["sector",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return wt.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:At({center:o},i.sector)})}],["rect",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return yt.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:At({leftTop:o},i.rect)})}],["radiusRect",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return gt.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:At({leftTop:o},i.radiusRect)})}],["leaf",function(t){var e=t.ctx,o=t.coordinates,n=t.map,i=t.style;t=t.isScale;return lt.getCenterCoordinate({ctx:e,map:n,style:i,isScale:t,coordinates:At({center:o},i.leaf)})}]]),e.pointTypeToCoordinatesMapping=new Map([["circle",function(t,e){return{center:t,radius:e.radius}}],["image",function(t,e){return{leftTop:t,width:e.img.width,height:e.img.height}}],["regularPolygon",function(t,e){return At({center:t},e.regularPolygon)}],["start",function(t,e){return At({center:t},e.start)}],["sector",function(t,e){return At({center:t},e.sector)}],["rect",function(t,e){return At({leftTop:t},e.rect)}],["radiusRect",function(t,e){return At({leftTop:t},e.radiusRect)}],["leaf",function(t,e){return At({center:t},e.leaf)}]]),e}(H);const Et=Lt;var bt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),zt=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Bt=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return bt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return zt([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiPoint},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap();t=V.Lrk(t.map((function(t){return t=e.pointToPixel(new BMap.Point(t.lng,t.lat)),V.zx7([t.x,t.y])})));return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){Et.drawPoint({ctx:t,style:e,coordinates:o,map:n})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return Et.isPixelInGeometry({coordinates:n,map:o.getMap(),pixel:t,style:e})}))},e}(H);const Rt=Bt;var Nt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),_t=function(){return(_t=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},kt=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Gt=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return Nt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return kt([],this.coordinates,!0)},e.prototype.getType=function(){return p.Polygon},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,o=t.map;t.style,t.isScale,t=V.n1([e.map((function(t){return[(t=o.pointToPixel(new BMap.Point(t.lng,t.lat))).x,t.y]}))]);return{x:(e=V.NAY(t)).geometry.coordinates[0],y:e.geometry.coordinates[1]}},e.prototype.getCenterCoordinate=function(t){var o=t.ctx,n=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:o,map:this.getMap(),style:n,isScale:t})},e.drawPolygon=function(t){var e=t.ctx,o=t.style,n=t.coordinates,i=t.map;e.save(),t=_t(_t({},u),null!=o?o:{});e.beginPath(),e.lineWidth=t.lineWidth,e.lineJoin=t.lineJoin,e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.strokeStyle=t.strokeStyle,e.fillStyle=t.fillStyle,n.forEach((function(t,o){t=i.pointToPixel(new BMap.Point(t.lng,t.lat)),0===o?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,o){e.drawPolygon({ctx:t,style:o,coordinates:this.coordinates,map:this.getMap()})},e.isPixelInGeometry=function(t){var e=t.coordinates,o=t.map;t=t.pixel,t=V.zx7([t.x,t.y]),e=V.n1([e.map((function(t){return[(t=o.pointToPixel(new BMap.Point(t.lng,t.lat))).x,t.y]}))]);return V.mFO(t,e)},e.prototype.isPixelInGeometry=function(t){return e.isPixelInGeometry({coordinates:this.coordinates,pixel:t,map:this.getMap()})},e}(H);const Ht=Gt;var Wt,Ut=(Wt=function(t,e){return(Wt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}Wt(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Yt=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Ft=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return Ut(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return Yt([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiPolygon},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap();t=t.map((function(t){return t.map((function(t){return[(t=e.pointToPixel(new BMap.Point(t.lng,t.lat))).x,t.y]}))})),t=V.n1(t);return{x:(t=V.NAY(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){Ht.drawPolygon({ctx:t,style:e,coordinates:o,map:n})}))},e.prototype.isPixelInGeometry=function(t){var e=this;return this.coordinates.some((function(o){return Ht.isPixelInGeometry({coordinates:o,map:e.getMap(),pixel:t})}))},e}(H);const Zt=Ft,Jt={parse:function(t,e){var o=[];return function t(o,n,i){var r=null;o.type===d.Point?((r=n(new Et({lng:o.coordinates[0],lat:o.coordinates[1]}))).setId(L.A.uuid()),i.push(r)):o.type===d.MultiPoint?((r=n(new Rt(o.coordinates.map((function(t){return{lng:t[0],lat:t[1]}}))))).setId(L.A.uuid()),i.push(r)):o.type===d.LineString?((r=n(new J({point1:{lng:o.coordinates[0][0],lat:o.coordinates[0][1]},point2:{lng:o.coordinates[1][0],lat:o.coordinates[1][1]}}))).setId(L.A.uuid()),i.push(r)):o.type===d.MultiLineString?((r=n(new tt(o.coordinates.map((function(t){return{point1:{lng:t[0][0],lat:t[0][1]},point2:{lng:t[1][0],lat:t[1][1]}}}))))).setId(L.A.uuid()),i.push(r)):o.type===d.Polygon?((r=n(new Ht(o.coordinates.map((function(t){return{lng:t[0],lat:t[1]}}))))).setId(L.A.uuid()),i.push(r)):o.type===d.MultiPolygon?((r=n(new Zt(o.coordinates.map((function(t){return t.map((function(t){return{lng:t[0],lat:t[1]}}))}))))).setId(L.A.uuid()),i.push(r)):o.type===d.GeometryCollection?o.geometries.forEach((function(o){t(o,e,i)})):o.type===d.Feature?t(o.geometry,(function(t){return(t=e(t)).setId(o.id),t.setProperties(o.properties),t}),i):o.type===d.FeatureCollection&&o.features.forEach((function(o){t(o,e,i)}))}(t,e,o),o},stringify:function(t){function e(t){return[(t=t.getCoordinates()).lng,t.lat]}function o(t){return t.getCoordinates().map((function(t){return[t.lng,t.lat]}))}function n(t){return[[(t=t.getCoordinates()).point1.lng,t.point1.lat],[t.point2.lng,t.point2.lat]]}function i(t){return t.getCoordinates().map((function(t){return[[t.point1.lng,t.point1.lat],[t.point2.lng,t.point2.lat]]}))}function r(t){return t.getCoordinates().map((function(t){return[t.lng,t.lat]}))}function a(t){return t.getCoordinates().map((function(t){return t.map((function(t){return[t.lng,t.lat]}))}))}var s,l={type:d.FeatureCollection,features:[]},c=[];for(s in d)c.push(s);return t.forEach((function(t){var s,u,p=t.getGeometry().getType();c.includes(p)&&l.features.push({type:d.Feature,geometry:{type:p,coordinates:(p=t.getGeometry(),s=new Map([[d.Point,e],[d.MultiPoint,o],[d.LineString,n],[d.MultiLineString,i],[d.Polygon,r],[d.MultiPolygon,a]]),u=p.getType(),s.get(u)(p))},id:t.getId(),properties:t.getProperties()})})),l}};var Qt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Vt=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Xt=function(t){function e(e){var o=t.call(this)||this;return o.context=null,o.features=[],o.features=e,o.setFeaturesContext(),o}return Qt(e,t),e.prototype.setFeaturesContext=function(){var t=this;this.features.forEach((function(e){e.setContext(t)}))},e.prototype.addFeature=function(t){this.hasFeatureById(t.getId())||(this.features.push(t),this.setFeaturesContext(),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(h.UPDATE))},e.prototype.addFeatures=function(t){var e=this;t=t.filter((function(t){return!e.hasFeatureById(t.getId())}));this.features=Vt(Vt([],this.features,!0),t,!0),this.setFeaturesContext(),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.addFirstFeature=function(t){this.hasFeatureById(t.getId())||(this.features.unshift(t),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(h.UPDATE))},e.prototype.insertFeature=function(t,e){this.hasFeatureById(t.getId())||(this.features.splice(e,0,t),this.setFeaturesContext(),null!=(e=null==this?void 0:this.getContext())&&e.getEmitter().trigger(h.UPDATE))},e.prototype.removeFeature=function(t){this.removeFeatureById(t.getId())},e.prototype.removeFeatureById=function(t){var e;this.hasFeatureById(t)&&(e=this.features.findIndex((function(e){return e.getId()===t})),this.features.splice(e,1),null!=(e=null==this?void 0:this.getContext()))&&e.getEmitter().trigger(h.UPDATE)},e.prototype.clear=function(){var t;this.features=[],null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getFeatureById=function(t){return this.features.find((function(e){return e.getId()===t}))},e.prototype.getFeatures=function(){return Vt([],this.features,!0)},e.prototype.hasFeature=function(t){return-1!==this.features.indexOf(t)},e.prototype.hasFeatureById=function(t){return!!this.features.find((function(e){return e.getId()===t}))},e.prototype.readGeoJSON=function(t,e){var o=this;this.features=Jt.parse(t,e),this.features.forEach((function(t){t.setContext(o)})),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.appendGeoJSON=function(t,e){var o=this;(t=Jt.parse(t,e)).forEach((function(t){t.setContext(o)})),this.features=Vt(Vt([],this.features,!0),t,!0),null!=(e=null==this?void 0:this.getContext())&&e.getEmitter().trigger(h.UPDATE)},e.prototype.featuresToGeoJSON=function(){return Jt.stringify(this.features)},e.prototype.setContext=function(t){this.context=t},e.prototype.getContext=function(){return this.context},e}(E.A.Events);const Kt=Xt;var qt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),$t=function(){return($t=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},te=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},ee=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return qt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return te([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiCircle},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap(),o=[];t.forEach((function(t){t=e.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),o.push(V.zx7([t.x,t.y]))})),t=V.Lrk(o);return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this,n=this.coordinates,i=$t($t({},u),null!=e?e:{});n.forEach((function(e){it.drawCircle({ctx:t,style:i,coordinates:e,map:o.getMap(),isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return it.isPixelInGeometry({coordinates:n,map:o.getMap(),style:e,pixel:t,isScale:!0})}))},e}(H);const oe=ee;var ne=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ie=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},re=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return ne(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return ie([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiLeaf},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],o=this.getMap();t.forEach((function(t){t=o.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(V.zx7([t.x,t.y]))})),t=V.Lrk(e);return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){lt.drawLeaf({ctx:t,style:e,coordinates:o,map:n,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return lt.isPixelInGeometry({coordinates:n,map:o.getMap(),pixel:t,style:e,isScale:!0})}))},e}(H);const ae=re;var se=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),le=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},ce=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return se(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return le([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiRect},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap();t=t.map((function(t){return t=e.pointToPixel(new BMap.Point(t.leftTop.lng,t.leftTop.lat)),V.zx7([t.x,t.y])})),t=V.Lrk(t);return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){yt.drawRect({ctx:t,style:e,coordinates:o,map:n,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return yt.isPixelInGeometry({coordinates:n,map:o.getMap(),pixel:t,style:e,isScale:!0})}))},e}(H);const ue=ce;var pe=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ye=function(t){function e(e){var o=t.call(this,e)||this;return o.coordinates=e,o}return pe(e,t),e.prototype.getType=function(){return p.MultiRadiusRect},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){gt.drawRadiusRect({ctx:t,style:e,coordinates:o,map:n,isScale:!0})}))},e}(ue);const he=ye;var de=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),fe=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},ge=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return de(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return fe([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiRegularPolygon},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],o=this.getMap();t.forEach((function(t){t=o.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(V.zx7([t.x,t.y]))})),t=V.Lrk(e);return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){Tt.drawRegularPolygon({ctx:t,style:e,coordinates:o,map:n,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return Tt.isPixelInGeometry({coordinates:n,map:o.getMap(),pixel:t,style:e,isScale:!0})}))},e}(H);const xe=ge;var ve=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Me=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Te=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return ve(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return Me([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiSector},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],o=this.getMap();t.forEach((function(t){t=o.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(V.zx7([t.x,t.y]))})),t=V.Lrk(e);return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){wt.drawSector({ctx:t,style:e,coordinates:o,map:n,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return wt.isPixelInGeometry({coordinates:n,map:o.getMap(),pixel:t,style:e,isScale:!0})}))},e}(H);const Ce=Te;var me=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Pe=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},we=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return me(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return Pe([],this.coordinates,!0)},e.prototype.getType=function(){return p.MultiStart},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],o=this.getMap();t.forEach((function(t){t=o.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(V.zx7([t.x,t.y]))})),t=V.Lrk(e);return{x:(t=V.gXo(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var o=this.coordinates,n=this.getMap();o.forEach((function(o){Ot.drawStart({ctx:t,style:e,coordinates:o,map:n,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var o=this;return this.coordinates.some((function(n){return Ot.isPixelInGeometry({coordinates:n,map:o.getMap(),pixel:t,style:e,isScale:!0})}))},e}(H);const De=we;var Se=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ie=function(){return(Ie=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Oe=function(t){function e(e){var o=t.call(this)||this;return o.coordinates=e,o}return Se(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(h.UPDATE)},e.prototype.getCoordinates=function(){return Ie({},this.coordinates)},e.prototype.getType=function(){return p.Text},e.getCenterCoordinate=function(t){return Ie({},t.point)},e.prototype.getCenterCoordinate=function(){return e.getCenterCoordinate(this.coordinates)},e.prototype.draw=function(t,e){t.save();e=Ie(Ie({},P),null!=e?e:{}),t.beginPath(),t.font=e.font,t.textAlign=e.textAlign,t.textBaseline=e.textBaseline,t.direction=e.direction,t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,e=this.getMap();var o=(n=this.coordinates).text,n=n.point;e=e.pointToPixel(new BMap.Point(n.lng,n.lat));t.fillText(o,e.x,e.y),t.restore()},e.prototype.isPixelInGeometry=function(t){return!1},e}(H);const je=Oe,Ae={fillStyle:"#fff",strokeStyle:"#fff",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1},Le={strokeStyle:"#fff",lineWidth:1,lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:.6},Ee={fillStyle:"rgb(91,155,213,1)",strokeStyle:"rgba(0,0,0,.8)",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[],lineDashOffset:-1};var be,ze,Be,Re,Ne;!function(t){t[t.UnStart=0]="UnStart",t[t.Running=1]="Running",t[t.End=2]="End",t[t.Destroy=3]="Destroy"}(be=be||{}),function(t){t.BeforeStart="BeforeStart",t.Start="Start",t.End="End",t.Destroy="Destroy"}(ze=ze||{}),function(t){t.CanvasMount="CanvasMount",t.CanvasClickEmpty="CanvasClickEmpty",t.CanvasClickGeometry="CanvasClickGeometry"}(Be=Be||{}),function(t){t.Polygon="Polygon",t.Circle="Circle",t.Rectangle="Rectangle",t.Triangle="Triangle",t.Diamond="Diamond",t.Start="Start",t.Free="Free",t.Distance="Distance"}(Re=Re||{}),function(t){t.Draw="Draw",t.Modify="Modify",t.Move="Move"}(Ne=Ne||{});var _e=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ke=function(){return(ke=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Ge=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.context=null,e.style=ke({},Ee),e.status=be.UnStart,e}return _e(e,t),e.prototype.destroy=function(){var t,e;this.context&&![be.Running,be.Destroy].includes(this.status)&&(t=(e=this.context).getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&(t.style.cursor=e.style.cursor="default",this.context.enableMap())},e.prototype.end=function(t){var e,o;this.context&&![be.Running,be.Destroy].includes(this.status)&&(e=(o=this.context).getCanvasEl(),o=o.getAssistCanvasEl(),e)&&o&&(e.style.cursor=o.style.cursor="default",this.context.enableMap())},e.prototype.start=function(t){this.context&&![be.Running,be.Destroy].includes(this.status)&&this.setCursor()},e.prototype.setCursor=function(){var t=this.context;t&&(t=t.getCanvasEl())&&(t.style.cursor="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjI3OTEzNjM1NDc3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQzMDgiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMi4wMDIgODg3QzMwNC44OTIgODg3IDEzNyA3MTkuMTA4IDEzNyA1MTIuMDAyIDEzNyAzMDQuODkyIDMwNC44OTIgMTM3IDUxMi4wMDIgMTM3IDcxOS4xMDggMTM3IDg4NyAzMDQuODkyIDg4NyA1MTIuMDAyIDg4NyA3MTkuMTA4IDcxOS4xMDggODg3IDUxMi4wMDIgODg3ek01MTIgNzg3YzE1MS44NzggMCAyNzUtMTIzLjEyMiAyNzUtMjc1UzY2My44NzggMjM3IDUxMiAyMzcgMjM3IDM2MC4xMjIgMjM3IDUxMnMxMjMuMTIyIDI3NSAyNzUgMjc1eiIgZmlsbD0iIzFBQTVGRiIgcC1pZD0iNDMwOSI+PC9wYXRoPjxwYXRoIGQ9Ik01MTIgNTEybS0yMjUgMGEyMjUgMjI1IDAgMSAwIDQ1MCAwIDIyNSAyMjUgMCAxIDAtNDUwIDBaIiBmaWxsPSIjMUFBNUZGIiBwLWlkPSI0MzEwIj48L3BhdGg+PC9zdmc+), auto")},e.prototype.setContext=function(t){this.context=t},e.prototype.getStatus=function(){return this.status},e}(E.A.Events);const He=Ge;var We=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ue=function(t){function e(){var e=t.call(this)||this;return e.centerPoint=null,e.isMove=!1,e.radius=0,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return We(e,t),e.booleanPointInData=function(t,o,n){return L.A.isPointInCircle(o,e.transformOriginToReal(t,n.data))},e.prototype.draw=function(t){var e,o=(i=this).context,n=i.centerPoint,i=i.style,r=null==o?void 0:o.getCtx();o&&r&&n&&(e=o.getCanvasEl())&&(t=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}))&&(o.clearDraw(),o.drawHistoryData(),r.beginPath(),this.radius=L.A.getDistanceByBetweenPoint({p1:n,p2:t}),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,r.ellipse((null==n?void 0:n.x)||0,(null==n?void 0:n.y)||0,this.radius,this.radius,45*Math.PI/180,0,2*Math.PI),r.stroke(),r.fill())},e.draw=function(t,o,n){o&&n&&(n.style&&(o.lineWidth=n.style.lineWidth,o.lineJoin=n.style.lineJoin,o.lineCap=n.style.lineCap,o.setLineDash(n.style.lineDash),o.lineDashOffset=n.style.lineDashOffset,o.strokeStyle=n.style.strokeStyle,o.fillStyle=n.style.fillStyle,o.globalAlpha=n.style.globalAlpha||1),e.drawHistoryPath(t,o,n.data),o.stroke(),o.fill())},e.drawHistoryPath=function(t,e,o){var n=t.pointToPixel(o.center);t=t.actualToDistance(o.radius);e.save(),e.beginPath(),e.ellipse(n.x,n.y,t,t,45*Math.PI/180,0,2*Math.PI),e.stroke(),e.fill(),e.restore()},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.centerPoint=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){var e=this.context;e&&e.getCtx()&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformRealToOrigin=function(t,e){return{center:t.pixelToPoint(e.center),radius:t.distanceToActual(e.radius)}},e.transformOriginToReal=function(t,e){return{center:t.pointToPixel(e.center),radius:t.actualToDistance(e.radius)}},e.prototype.getSelectType=function(){return Re.Circle},e.prototype.start=function(e){var o;this.context&&![be.Running,be.Destroy].includes(this.status)&&(o=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Draw}),null!=o&&o.addEventListener("mousedown",this.onCanvasMouseDown),this.status=be.Running,this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Draw}))},e.prototype.end=function(o){var n,i=this.context;i&&(n=i.getCanvasEl())&&(null!=n&&n.removeEventListener("mousedown",this.onCanvasMouseDown),null!=n&&n.removeEventListener("mousemove",this.onCanvasMouseMove),null!=n&&n.removeEventListener("mouseup",this.onCanvasMouseUp),o&&this.draw(o),this.status=be.End,n={id:L.A.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{center:this.centerPoint,radius:this.radius}),style:this.style},i.addHistoryData(n),this.centerPoint=null,this.radius=0,this.isMove=!1,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Draw,data:n})),t.prototype.end.call(this,o)},e.prototype.destroy=function(){var e,o=this.context;o&&(e=o.getCanvasEl())&&(this.status===be.Running&&(o.clearDraw(),o.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.centerPoint=null,this.radius=0,this.isMove=!1,this.status=be.Destroy,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Draw})),t.prototype.destroy.call(this)},e}(He);const Ye=Ue,Fe={getRectLeftTopPoint:function(t){var e=t.startPoint;return(t=t.targetPoint).x<=e.x&&t.y<=e.y?t:t.x<=e.x&&t.y>=e.y?{x:t.x,y:e.y}:t.x>=e.x&&t.y<=e.y?{x:e.x,y:t.y}:t.x>=e.x&&t.y>=e.y?e:null},triangle:function(t){var e,o=t.startPoint,n=(t=t.targetPoint,this.getRectLeftTopPoint({startPoint:o,targetPoint:t}));return n?(e=Math.abs(t.x-o.x),t=Math.abs(t.y-o.y),[{x:n.x,y:n.y+t},{x:n.x+e/2,y:n.y},{x:n.x+e,y:n.y+t}]):[]}};var Ze=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Je=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.leftTopPoint=null,e.width=0,e.height=0,e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return Ze(e,t),e.booleanPointInData=function(t,o,n){n=(t=e.transformOriginToReal(t,n.data)).leftTopPoint;var i=(a=t.width)/2,r=(t=t.height)/2,a=(o=V.zx7([o.x,o.y]),V.n1([[[n.x,n.y+r],[n.x+i,n.y],[n.x+a,n.y+r],[n.x+i,n.y+t],[n.x,n.y+r]]]));return V.mFO(o,a)},e.prototype.draw=function(t){var e,o=(i=this).context,n=i.startPoint,i=i.style,r=null==o?void 0:o.getCtx();o&&r&&(e=o.getCanvasEl())&&(t=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),o.clearDraw(),o.drawHistoryData(),r.beginPath(),this.leftTopPoint=Fe.getRectLeftTopPoint({startPoint:n,targetPoint:t}),this.leftTopPoint)&&(this.width=Math.abs(t.x-((null==n?void 0:n.x)||0)),this.height=Math.abs(t.y-((null==n?void 0:n.y)||0)),e=this.width/2,o=this.height/2,r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,r.moveTo(this.leftTopPoint.x,this.leftTopPoint.y+o),r.lineTo(this.leftTopPoint.x+e,this.leftTopPoint.y),r.lineTo(this.leftTopPoint.x+this.width,this.leftTopPoint.y+o),r.lineTo(this.leftTopPoint.x+e,this.leftTopPoint.y+this.height),r.stroke(),r.fill())},e.draw=function(t,e,o){e&&o&&(o.style&&(e.lineWidth=o.style.lineWidth,e.lineJoin=o.style.lineJoin,e.lineCap=o.style.lineCap,e.setLineDash(o.style.lineDash),e.lineDashOffset=o.style.lineDashOffset,e.strokeStyle=o.style.strokeStyle,e.fillStyle=o.style.fillStyle,e.globalAlpha=o.style.globalAlpha||1),this.drawHistoryPath(t,e,o.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,o,n){var i;o.save(),o.beginPath(),n&&n.leftTopPoint&&(n=(t=e.transformOriginToReal(t,n)).width/2,i=t.height/2,o.moveTo(t.leftTopPoint.x,t.leftTopPoint.y+i),o.lineTo(t.leftTopPoint.x+n,t.leftTopPoint.y),o.lineTo(t.leftTopPoint.x+t.width,t.leftTopPoint.y+i),o.lineTo(t.leftTopPoint.x+n,t.leftTopPoint.y+t.height),o.stroke(),o.fill(),o.restore())},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{leftTopPoint:t.pointToPixel(e.leftTopPoint),width:t.actualToDistance(e.width),height:t.actualToDistance(e.height)}},e.transformRealToOrigin=function(t,e){return{leftTopPoint:t.pixelToPoint(e.leftTopPoint),width:t.distanceToActual(e.width),height:t.distanceToActual(e.height)}},e.prototype.getSelectType=function(){return Re.Diamond},e.prototype.start=function(e){var o;this.context&&![be.Running,be.Destroy].includes(this.status)&&(o=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Draw}),null!=o&&o.addEventListener("mousedown",this.onCanvasMouseDown),this.status=be.Running,this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Draw}))},e.prototype.end=function(o){var n,i=this.context;i&&(n=i.getCanvasEl())&&(null!=n&&n.removeEventListener("mousedown",this.onCanvasMouseDown),null!=n&&n.removeEventListener("mousemove",this.onCanvasMouseMove),null!=n&&n.removeEventListener("mouseup",this.onCanvasMouseUp),o&&this.draw(o),this.status=be.End,n={id:L.A.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{leftTopPoint:this.leftTopPoint,width:this.width,height:this.height}),style:this.style},i.addHistoryData(n),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Draw,data:n})),t.prototype.end.call(this,o)},e.prototype.destroy=function(){var e,o=this.context;o&&(e=o.getCanvasEl())&&(this.status===be.Running&&(o.clearDraw(),o.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.status=be.Destroy,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Draw})),t.prototype.destroy.call(this)},e}(He);const Qe=Je;var Ve=o(59418);const Xe={fillStyle:"#fff",strokeStyle:"red",lineWidth:6,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:1};var Ke=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),qe=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},$e=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.pointStack=[],e.isMove=!1,e.onCanvasClick=e.onCanvasClick.bind(e),e.onCanvasMousemove=e.onCanvasMousemove.bind(e),e.onCanvasDbClick=e.onCanvasDbClick.bind(e),e}return Ke(e,t),e.booleanPointInData=function(t,o,n){return(n=qe([],n.data,!0)).push(n[0]),n=e.transformOriginToReal(t,n),t=V.zx7([o.x,o.y]),o=V.n1([n.map((function(t){return[t.x,t.y]}))]),V.mFO(t,o)},e.draw=function(t,e,o){e&&o&&(o.style&&(e.lineWidth=o.style.lineWidth,e.lineJoin=o.style.lineJoin,e.lineCap=o.style.lineCap,e.setLineDash(o.style.lineDash),e.lineDashOffset=o.style.lineDashOffset,e.strokeStyle=o.style.strokeStyle,e.fillStyle=o.style.fillStyle,e.globalAlpha=o.style.globalAlpha||1),this.drawHistoryPath(t,e,o.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,o,n){void 0===n&&(n=[]),o.save(),o.beginPath(),(e.transformOriginToReal(t,n)||[]).forEach((function(t,e){0===e?o.moveTo(t.x,t.y):o.lineTo(t.x,t.y)})),o.closePath(),o.stroke(),o.fill(),o.restore()},e.transformOriginToReal=function(t,e){return e.map((function(e){return t.pointToPixel(e)}))},e.transformRealToOrigin=function(t,e){return e.map((function(e){return t.pixelToPoint(e)}))},e.prototype.fill=function(){if(this.context){var t=this.pointStack,e=this.context.getCtx();if(e&&!(t.length<=1)){e.save(),e.beginPath();for(var o=0;o<t.length;o++){var n=t[o];0===o?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)}e.closePath(),e.fillStyle=this.style.fillStyle,e.fill(),e.restore()}}},e.prototype.drawLine=function(t,e){var o,n=this.context;n&&(o=this.style,n=n.getCtx())&&(n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.strokeStyle=o.strokeStyle,n.fillStyle=o.fillStyle,n.lineWidth=o.lineWidth,n.lineCap=o.lineCap,n.lineJoin=o.lineJoin,n.lineDashOffset=o.lineDashOffset,n.setLineDash(o.lineDash),n.stroke())},e.prototype.drawStack=function(){var t=this.pointStack;if(!(t.length<=1))for(var e=0;this.drawLine(t[e],t[e+1]),++e!=t.length-1;);},e.prototype.getCanvasClick=function(){return this.onCanvasClick},e.prototype.getCanvasMousemove=function(){return this.onCanvasMousemove},e.prototype.getCanvasDbClick=function(){return this.onCanvasDbClick},e.prototype.onCanvasClick=function(t){if(this.context){var e=this.context.getCanvasEl();if(e&&!(2<=t.detail)){if(this.startPoint){var o=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()});this.drawLine(this.startPoint,o),this.startPoint=o,this.startPoint&&this.pointStack.push(this.startPoint)}else{if(null!=e&&e.addEventListener("mousemove",this.getCanvasMousemove()),null!=e&&e.addEventListener("dblclick",this.getCanvasDbClick()),this.startPoint=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),!this.startPoint)return;this.pointStack.push(this.startPoint),this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Draw})}t.stopPropagation()}}},e.prototype.onCanvasMousemove=function(t){var e,o=this.context,n=this.startPoint;o&&n&&(e=o.getCanvasEl())&&(this.isMove=!0,o.clearDraw(),o.drawHistoryData(),this.drawStack(),this.drawLine(n,L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()})),t.stopPropagation())},e.prototype.onCanvasDbClick=function(t){this.isMove&&(this.end(),t.stopPropagation())},e.prototype.getSelectType=function(){return Re.Polygon},e.prototype.start=function(e){var o=this.context,n=this.status;o&&![be.Running,be.Destroy].includes(n)&&o&&(n=o.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Draw}),null!=n&&n.addEventListener("mouseup",this.getCanvasClick()),this.status=be.Running)},e.prototype.end=function(){var o=this.context;if(o){var n,i=o.getCanvasEl();if(i)return null!=i&&i.removeEventListener("mouseup",this.getCanvasClick()),null!=i&&i.removeEventListener("mousemove",this.getCanvasMousemove()),null!=i&&i.removeEventListener("dblclick",this.getCanvasDbClick()),o.clearDraw(),o.drawHistoryData(),this.fill(),this.status=be.End,n={id:i=L.A.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(o,this.pointStack),style:this.style},this.startPoint=null,this.pointStack=[],this.isMove=!1,o.addHistoryData(n),this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Draw,data:n}),t.prototype.end.call(this),i}t.prototype.end.call(this)},e.prototype.destroy=function(){var e,o=this.context;o&&(e=o.getCanvasEl())&&(this.status===be.Running&&(o.clearDraw(),o.drawHistoryData()),null!=e&&e.removeEventListener("mouseup",this.onCanvasClick),null!=e&&e.removeEventListener("mousemove",this.onCanvasMousemove),null!=e&&e.removeEventListener("dblclick",this.onCanvasDbClick),this.startPoint=null,this.pointStack=[],this.isMove=!1,this.status=be.Destroy,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Draw})),t.prototype.destroy.call(this)},e}(He);const to=$e;var eo=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),oo=function(){return(oo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},no=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},io=function(t){function e(){var e=t.call(this)||this;return e.style=oo(oo({},Ee),{strokeStyle:"red"}),e.onCanvasClick=e.onCanvasClick.bind(e),e.onCanvasMousemove=e.onCanvasMousemove.bind(e),e.onCanvasDbClick=e.onCanvasDbClick.bind(e),e.onCursorMouseMove=e.onCursorMouseMove.bind(e),e.onDelete=e.onDelete.bind(e),e}return eo(e,t),e.prototype.onCursorMouseMove=function(t){var e=this.context,o=this.pointStack;if(e){var n=e.getCanvasEl(),i=(t=L.A.clientToCtxPoint({event:t,rect:null==n?void 0:n.getBoundingClientRect()}),0);if(o.length){for(var r=0;r<o.length-1;r++){var a=o[r],s=o[r+1];i+=L.A.getDistanceByBetweenPoint({p1:a,p2:s})}n=L.A.getDistanceByBetweenPoint({p1:o[o.length-1],p2:t}),i=e.distanceToActual(i+n),n=e.getCtx(),t={x:t.x+10,y:t.y-25};var l=e.pixelToPoint(t),c=(l=(gt.drawRadiusRect({ctx:n,style:oo(oo({},u),{lineWidth:1,strokeStyle:"red",fillStyle:"#fff"}),coordinates:{leftTop:{lng:l.x,lat:l.y},width:120,height:50,radius:2},map:e.getMap(),isScale:!1}),""),e="",e=i<1e3?(l="".concat(i.toFixed(2)),Ve.Ay.v("米")):(l="".concat(L.A.distance(i,"kilometer").toFixed(2)),Ve.Ay.v("公里")),"10px sans-serif"),p="bottom",y=t.x+60,h=t.y+25,d=n.measureText(l).width/2;n.beginPath(),n.font=c,n.textAlign="right",n.textBaseline=p,n.fillStyle="#000",n.fillText("".concat(Ve.Ay.v("总长"),"："),y-d,h,n.measureText("".concat(Ve.Ay.v("总长"),"：")).width),n.beginPath(),n.font=c,n.textAlign="center",n.textBaseline=p,n.fillStyle="red",n.fillText(l,y,h,n.measureText(l).width),n.beginPath(),n.font=c,n.textAlign="left",n.textBaseline=p,n.fillStyle="#000",n.fillText(e,y+d,h,n.measureText(e).width),n.beginPath(),n.font=c,n.textAlign="center",n.textBaseline=p,n.fillStyle="#000",n.fillText(Ve.Ay.v("单击确定地点，双击结束"),y,t.y+37.5+3,n.measureText(Ve.Ay.v("单击确定地点，双击结束")).width)}}},e.drawHistoryPath=function(t,e,o){var n=this;void 0===o&&(o=[]),e.save(),e.beginPath(),(to.transformOriginToReal(t,o)||[]).forEach((function(t,o){0===o?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.stroke(),e.restore(),o.forEach((function(i){n.drawStartPoint({context:t,ctx:e,style:Xe,pointStack:o,toPoint:i})}))},e.drawStartPoint=function(t){var e=t.context,o=t.ctx,n=t.style,i=t.pointStack,r=t.toPoint,a=(t=e.pointToPixel(r),i.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(r)})));o.save(),o.beginPath(),o.fillStyle=n.fillStyle,o.strokeStyle=n.strokeStyle,o.lineWidth=n.lineWidth,o.ellipse(t.x,t.y,6,6,45*Math.PI/180,0,2*Math.PI),o.stroke(),o.fill(),o.restore(),o.save(),o.beginPath(),o.font="9px sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillStyle="blue",o.fillText("".concat(a+1),t.x,t.y),o.restore(),n={x:t.x+10,y:t.y-10},t=e.pixelToPoint(n),gt.drawRadiusRect({ctx:o,style:oo(oo({},u),{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),coordinates:{leftTop:{lng:t.x,lat:t.y},width:50,height:20,radius:2},map:e.getMap(),isScale:!1}),t="";if(0===a)t=Ve.Ay.v("起点");else{for(var s=0,l=0;l<a;l++){var c=e.pointToPixel(i[l]),p=e.pointToPixel(i[l+1]);s+=L.A.getDistanceByBetweenPoint({p1:c,p2:p})}t=(s=e.distanceToActual(s))<1e3?"".concat(s.toFixed(2)).concat(Ve.Ay.v("米")):"".concat(L.A.distance(s,"kilometer").toFixed(2)).concat(Ve.Ay.v("公里"))}o.save(),o.beginPath(),o.font="10px sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillStyle="#000",o.fillText(t,n.x+25,n.y+10),o.restore()},e.prototype.drawStartPoint=function(){var t,o,n=this.context,i=this.startPoint;n&&(t=n.getCtx())&&(o=this.pointStack,e.drawStartPoint({context:n,ctx:t,style:Xe,pointStack:to.transformRealToOrigin(n,no([],o,!0)),toPoint:n.pixelToPoint(i)}))},e.prototype.fill=function(){var t=this.context;if(t){var o=this.pointStack,n=t.getCtx();if(n)if(o.length<=1)1===o.length&&e.drawStartPoint({context:t,ctx:t.getCtx(),style:Xe,pointStack:to.transformRealToOrigin(t,o),toPoint:t.pixelToPoint(o[0])});else{n.fillStyle=this.style.fillStyle,n.save(),n.beginPath();for(var i=0;i<o.length;i++){var r=o[i];0===i?n.moveTo(r.x,r.y):n.lineTo(r.x,r.y)}n.stroke(),n.restore();var a=to.transformRealToOrigin(t,o);a.forEach((function(o,i){e.drawStartPoint({context:t,ctx:n,style:Xe,pointStack:a,toPoint:a[i]})}))}}},e.prototype.drawStack=function(){var t=this.pointStack,o=this.context;if(o)if(t.length<=1)1===t.length&&e.drawStartPoint({context:o,ctx:o.getCtx(),style:Xe,pointStack:to.transformRealToOrigin(o,t),toPoint:o.pixelToPoint(t[0])});else for(var n=0;n!==t.length-1&&this.drawLine(t[n],t[n+1]),e.drawStartPoint({context:o,ctx:o.getCtx(),style:Xe,pointStack:to.transformRealToOrigin(o,t),toPoint:o.pixelToPoint(t[n])}),++n<t.length;);},e.prototype.getCanvasClick=function(){return this.onCanvasClick},e.prototype.getCanvasMousemove=function(){return this.onCanvasMousemove},e.prototype.getCanvasDbClick=function(){return this.onCanvasDbClick},e.prototype.onCanvasClick=function(e){2<=e.detail||(t.prototype.onCanvasClick.call(this,e),this.drawStartPoint())},e.prototype.onCanvasMousemove=function(e){t.prototype.onCanvasMousemove.call(this,e),this.onCursorMouseMove(e)},e.prototype.onCanvasDbClick=function(e){t.prototype.onCanvasDbClick.call(this,e)},e.prototype.onDelete=function(t,e){var o,n,i,r=this.context;r&&(o=r.getMap(),-1!==(i=null==(n=null==r?void 0:r.getHistoryData())?void 0:n.findIndex((function(t){return t.id===e}))))&&(null!=n&&n.splice(i,1),r.setHistoryData(n),r.clearDraw(),r.drawHistoryData(),o.removeOverlay(t))},e.drawDeleteMark=function(t){var e,o=t.context,n=t.point,i=t.onDelete,r=(t=o.getMap(),new BMap.Icon("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMxMTk1MDc3NjM5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjExMjQ1IiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik0xNTkuMjE1NDg0IDI4NC43MzgwNjVoNzE1LjQ3ODcxYzEzLjIxMjkwMyAwIDIzLjc4MzIyNi0xMC41NzAzMjMgMjMuNzgzMjI1LTIzLjc4MzIyNnMtMTAuNTcwMzIzLTIzLjc4MzIyNi0yMy43ODMyMjUtMjMuNzgzMjI2SDE1OS4yMTU0ODRjLTEzLjIxMjkwMyAwLTIzLjc4MzIyNiAxMC41NzAzMjMtMjMuNzgzMjI2IDIzLjc4MzIyNnMxMC41NzAzMjMgMjMuNzgzMjI2IDIzLjc4MzIyNiAyMy43ODMyMjYiIHAtaWQ9IjExMjQ2IiBmaWxsPSIjZDgxZTA2Ij48L3BhdGg+PHBhdGggZD0iTTM1Ny40MDkwMzIgMzU2LjA4Nzc0MnY0MTMuNTYzODcxYzAgMTMuMjEyOTAzIDEwLjU3MDMyMyAyMy43ODMyMjYgMjMuNzgzMjI2IDIzLjc4MzIyNnMyMy43ODMyMjYtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjZWMzU2LjA4Nzc0MmMwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjYtMTIuNTUyMjU4IDAtMjMuNzgzMjI2IDEwLjU3MDMyMy0yMy43ODMyMjYgMjMuNzgzMjI2IiBwLWlkPSIxMTI0NyIgZmlsbD0iI2Q4MWUwNiI+PC9wYXRoPjxwYXRoIGQ9Ik01MDAuNzY5MDMyIDM1Ni4wODc3NDJ2NDEzLjU2Mzg3MWMwIDEzLjIxMjkwMyAxMC41NzAzMjMgMjMuNzgzMjI2IDIzLjc4MzIyNiAyMy43ODMyMjZzMjMuNzgzMjI2LTEwLjU3MDMyMyAyMy43ODMyMjYtMjMuNzgzMjI2VjM1Ni4wODc3NDJjMC0xMy4yMTI5MDMtMTAuNTcwMzIzLTIzLjc4MzIyNi0yMy43ODMyMjYtMjMuNzgzMjI2cy0yMy43ODMyMjYgMTAuNTcwMzIzLTIzLjc4MzIyNiAyMy43ODMyMjYiIHAtaWQ9IjExMjQ4IiBmaWxsPSIjZDgxZTA2Ij48L3BhdGg+PHBhdGggZD0iTTYyNy42MTI5MDMgMzU2LjA4Nzc0MnY0MTMuNTYzODcxYzAgMTMuMjEyOTAzIDEwLjU3MDMyMyAyMy43ODMyMjYgMjMuNzgzMjI2IDIzLjc4MzIyNnMyMy43ODMyMjYtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjZWMzU2LjA4Nzc0MmMwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjZTNjI3LjYxMjkwMyAzNDIuODc0ODM5IDYyNy42MTI5MDMgMzU2LjA4Nzc0MiIgcC1pZD0iMTEyNDkiIGZpbGw9IiNkODFlMDYiPjwvcGF0aD48cGF0aCBkPSJNNzU1LjExNzQxOSAyNzYuODEwMzIzdjU0MC40MDc3NDJjMCAxMy4yMTI5MDMtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjUgMjMuNzgzMjI1aC00MjkuNDE5MzU1Yy0xMy4yMTI5MDMgMC0yMy43ODMyMjYtMTAuNTcwMzIzLTIzLjc4MzIyNi0yMy43ODMyMjVWMjc2LjgxMDMyM2MwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjZzLTIzLjc4MzIyNiAxMC41NzAzMjMtMjMuNzgzMjI2IDIzLjc4MzIyNnY1NDAuNDA3NzQyYzAgMzkuNjM4NzEgMzEuNzEwOTY4IDcxLjM0OTY3NyA3MS4zNDk2NzggNzEuMzQ5Njc3aDQyOS40MTkzNTVjMzkuNjM4NzEgMCA3MS4zNDk2NzctMzEuNzEwOTY4IDcxLjM0OTY3Ny03MS4zNDk2NzdWMjc2LjgxMDMyM2MwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjZzLTIzLjc4MzIyNiAxMC41NzAzMjMtMjMuNzgzMjI2IDIzLjc4MzIyNnoiIHAtaWQ9IjExMjUwIiBmaWxsPSIjZDgxZTA2Ij48L3BhdGg+PHBhdGggZD0iTTM4OS43ODA2NDUgMjQ1LjA5OTM1NXYtNDcuNTY2NDUyYzAtMjEuODAxMjkgMTcuODM3NDE5LTM5LjYzODcxIDM5LjYzODcxLTM5LjYzODcwOWgxNzUuMDcwOTY4YzIxLjgwMTI5IDAgMzkuNjM4NzEgMTcuODM3NDE5IDM5LjYzODcwOSAzOS42Mzg3MDl2NDcuNTY2NDUyYzAgMTMuMjEyOTAzIDEwLjU3MDMyMyAyMy43ODMyMjYgMjMuNzgzMjI2IDIzLjc4MzIyNnMyMy43ODMyMjYtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjZ2LTQ3LjU2NjQ1MmMwLTQ4LjIyNzA5Ny0zOC45NzgwNjUtODcuMjA1MTYxLTg3LjIwNTE2MS04Ny4yMDUxNjFINDI5LjQxOTM1NWMtNDguMjI3MDk3IDAtODcuMjA1MTYxIDM4Ljk3ODA2NS04Ny4yMDUxNjEgODcuMjA1MTYxdjQ3LjU2NjQ1MmMwIDEzLjIxMjkwMyAxMC41NzAzMjMgMjMuNzgzMjI2IDIzLjc4MzIyNSAyMy43ODMyMjYgMTIuNTUyMjU4IDAgMjMuNzgzMjI2LTEwLjU3MDMyMyAyMy43ODMyMjYtMjMuNzgzMjI2eiIgcC1pZD0iMTEyNTEiIGZpbGw9IiNkODFlMDYiPjwvcGF0aD48L3N2Zz4=",new BMap.Size(30,30)));(e=o.pointToPixel(n)).x+=22,e.y+=30,n=o.pixelToPoint(e),o=new BMap.Point(n.x,n.y);return(e=new BMap.Marker(o,{icon:r})).addEventListener("click",(function(){i&&i()})),t.addOverlay(e),e},e.prototype.getSelectType=function(){return Re.Distance},e.prototype.start=function(e){var o=null==(o=null==this?void 0:this.context)?void 0:o.getMap();o.disableDragging(),o.disableScrollWheelZoom(),o.disableDoubleClickZoom(),o.disableContinuousZoom(),o.disablePinchToZoom(),t.prototype.start.call(this,e)},e.prototype.end=function(){var o,n,i,r=this,a=this.context;a&&((o=a.getMap()).enableDragging(),o.enableScrollWheelZoom(),o.enableDoubleClickZoom(),o.enableContinuousZoom(),o.enablePinchToZoom(),n=e.drawDeleteMark({context:a,point:a.pixelToPoint(this.pointStack[this.pointStack.length-1]),onDelete:function(){r.onDelete(n,i)}}),i=t.prototype.end.call(this))},e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=null==(e=null==this?void 0:this.context)?void 0:e.getMap();e.enableDragging(),e.enableScrollWheelZoom(),e.enableDoubleClickZoom(),e.enableContinuousZoom(),e.enablePinchToZoom()},e.prototype.setCursor=function(){var t=this.context;t&&(t=t.getCanvasEl())&&(t.style.cursor="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMxMDY4ODUyOTU4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5ODAiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTQxNiA4MjQuNkwyMjUuMSA2NjguNyA3MTYgOTYuMSA5MDYuOSAyNTJ6IiBmaWxsPSIjZDgxZTA2IiBwLWlkPSIyOTgxIj48L3BhdGg+PHBhdGggZD0iTTc4NiA5MjcuM2MtNC41IDAtOC44LTEuNi0xMi4yLTQuNEw1MjQuNSA3MTMuOGMtOC4xLTYuOC05LjEtMTguOC0yLjQtMjYuOCA2LjgtOCAxOC44LTkuMSAyNi44LTIuNGwyMzQuNyAxOTYuOEw5MTUgNzI0LjggNjc0LjYgNTIzLjJjLTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjggNi44LTggMTguOC05LjEgMjYuOC0yLjRsMjU1IDIxMy45YzguMSA2LjggOS4xIDE4LjggMi40IDI2LjhMODAwLjYgOTIwLjVjLTMuMyAzLjktNy45IDYuMy0xMi45IDYuNy0wLjYgMC4xLTEuMiAwLjEtMS43IDAuMXpNMzQwLjIgNTUzLjVjLTQuMyAwLTguNi0xLjUtMTIuMi00LjRMNzEgMzMzLjZjLTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhMMjI0LjQgMTIxYzYuOC04IDE4LjgtOS4xIDI2LjgtMi40bDI1My41IDIxMi42YzguMSA2LjggOS4xIDE4LjggMi40IDI2LjgtNi44IDguMS0xOC43IDkuMS0yNi44IDIuNEwyNDEuNCAxNjAgMTEwLjEgMzE2LjZsMjQyLjMgMjAzLjJjOC4xIDYuOCA5LjEgMTguOCAyLjQgMjYuOC0zLjggNC42LTkuMiA2LjktMTQuNiA2Ljl6IiBmaWxsPSIjZDgxZTA2IiBwLWlkPSIyOTgyIj48L3BhdGg+PHBhdGggZD0iTTIzOC44IDMxOC4yYy00LjMgMC04LjYtMS41LTEyLjItNC40LTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhsNzcuOS05Mi45YzYuOC04IDE4LjgtOS4xIDI2LjgtMi40IDguMSA2LjggOS4xIDE4LjggMi40IDI2LjhsLTc3LjkgOTIuOWMtMy43IDQuNS05LjEgNi44LTE0LjYgNi44ek0zNzkuMyAzNjQuOGMtNC4zIDAtOC42LTEuNS0xMi4yLTQuNC04LjEtNi44LTkuMS0xOC44LTIuNC0yNi44bDQyLjktNTEuMWM2LjgtOC4xIDE4LjgtOS4xIDI2LjgtMi40IDguMSA2LjggOS4xIDE4LjggMi40IDI2LjhMMzkzLjkgMzU4Yy0zLjggNC41LTkuMiA2LjgtMTQuNiA2Ljh6TTgwMC45IDcxOC4zYy00LjMgMC04LjYtMS41LTEyLjItNC40LTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhsNDIuOS01MS4xYzYuOC04LjEgMTguOC05LjEgMjYuOC0yLjQgOC4xIDYuOCA5LjEgMTguOCAyLjQgMjYuOGwtNDIuOSA1MS4xYy0zLjcgNC41LTkuMSA2LjgtMTQuNiA2Ljh6TTY2MC41IDY3MS43Yy00LjMgMC04LjYtMS41LTEyLjItNC40LTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhsNzcuOS05Mi45YzYuOC04LjEgMTguOC05LjEgMjYuOC0yLjQgOC4xIDYuOCA5LjEgMTguOCAyLjQgMjYuOGwtNzcuOSA5Mi45Yy0zLjggNC41LTkuMiA2LjgtMTQuNiA2Ljh6TTQxNiA4NDMuNmMtNC4yIDAtOC41LTEuNC0xMi00LjNMMjEzIDY4My41Yy00LTMuMi02LjUtOC02LjktMTMuMS0wLjQtNS4xIDEuMi0xMC4yIDQuNS0xNC4xTDcwMS41IDgzLjdjNi43LTcuOCAxOC41LTguOSAyNi41LTIuNGwxOTAuOSAxNTUuOWM0IDMuMiA2LjUgOCA2LjkgMTMuMSAwLjQgNS4xLTEuMiAxMC4yLTQuNSAxNC4xTDQzMC40IDgzN2MtMy43IDQuNC05LjEgNi42LTE0LjQgNi42ek0yNTIuMiA2NjYuM2wxNjEuNCAxMzEuOCA0NjYuMS01NDMuNy0xNjEuNC0xMzEuOC00NjYuMSA1NDMuN3oiIGZpbGw9IiNkODFlMDYiIHAtaWQ9IjI5ODMiPjwvcGF0aD48cGF0aCBkPSJNMTY4LjEgOTUyLjRjLTQuMyAwLTguNi0xLjUtMTIuMS00LjMtNS4zLTQuMy03LjgtMTEuMS02LjgtMTcuOGw0MC45LTI1MS40YzEuNy0xMC40IDExLjYtMTcuNCAyMS45LTE1LjggMTAuNCAxLjcgMTcuNCAxMS41IDE1LjggMjEuOWwtMzUuNiAyMTguOSAyMDcuMy03OC42YzkuOC0zLjggMjAuOCAxLjIgMjQuNiAxMSAzLjcgOS44LTEuMiAyMC44LTExIDI0LjZMMTc1IDk1MS4yYy0yLjQgMC44LTQuNyAxLjItNi45IDEuMnoiIGZpbGw9IiNkODFlMDYiIHAtaWQ9IjI5ODQiPjwvcGF0aD48L3N2Zz4=), auto")},e}(to);const ro=io;var ao=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),so=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.isMove=!1,e.points=[],e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return ao(e,t),e.prototype.draw=function(t,e){void 0===e&&(e=!1);var o,n=this.context,i=this.style,r=null==n?void 0:n.getCtx();n&&r&&(o=n.getCanvasEl())&&(t=L.A.clientToCtxPoint({event:t,rect:null==o?void 0:o.getBoundingClientRect()}))&&(this.points.push(t),n.clearDraw(),n.drawHistoryData(),r.beginPath(),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,this.points.forEach((function(t,e){0===e?r.moveTo(t.x,t.y):r.lineTo(t.x,t.y)})),e&&r.closePath(),r.stroke(),r.fill())},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),this.startPoint)&&(this.points.push(this.startPoint),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.draw=function(t,e,o){e&&o&&(o.style&&(e.lineWidth=o.style.lineWidth,e.lineJoin=o.style.lineJoin,e.lineCap=o.style.lineCap,e.setLineDash(o.style.lineDash),e.lineDashOffset=o.style.lineDashOffset,e.strokeStyle=o.style.strokeStyle,e.fillStyle=o.style.fillStyle,e.globalAlpha=o.style.globalAlpha||1),this.drawHistoryPath(t,e,o.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,o,n){o.save(),o.beginPath(),n=n.points,(e.transformOriginToReal(t,void 0===n?[]:n)||[]).forEach((function(t,e){0===e?o.moveTo(t.x,t.y):o.lineTo(t.x,t.y)})),o.closePath(),o.stroke(),o.fill(),o.restore()},e.transformRealToOrigin=function(t,e){return e.map((function(e){return t.pixelToPoint(e)}))},e.transformOriginToReal=function(t,e){return e.map((function(e){return t.pointToPixel(e)}))},e.prototype.getSelectType=function(){return Re.Free},e.prototype.start=function(e){var o;this.context&&![be.Running,be.Destroy].includes(this.status)&&(o=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Draw}),null!=o&&o.addEventListener("mousedown",this.onCanvasMouseDown),this.status=be.Running,this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Draw}))},e.prototype.end=function(o){var n,i=this.context;i&&(n=i.getCanvasEl())&&(null!=n&&n.removeEventListener("mousedown",this.onCanvasMouseDown),null!=n&&n.removeEventListener("mousemove",this.onCanvasMouseMove),null!=n&&n.removeEventListener("mouseup",this.onCanvasMouseUp),this.draw(o,!0),this.status=be.End,n={id:L.A.uuid(),type:this.getSelectType(),data:{points:e.transformRealToOrigin(i,this.points)},style:this.style},i.addHistoryData(n),this.startPoint=null,this.points=[],this.isMove=!1,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Draw,data:n})),t.prototype.end.call(this,o)},e.prototype.destroy=function(){var e,o=this.context;o&&(e=o.getCanvasEl())&&(this.status===be.Running&&(o.clearDraw(),o.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.points=[],this.isMove=!1,this.status=be.Destroy,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Draw})),t.prototype.destroy.call(this)},e}(He);const lo=so;var co=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),uo=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.leftTopPoint=null,e.width=0,e.height=0,e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return co(e,t),e.booleanPointInData=function(t,o,n){n=(t=e.transformOriginToReal(t,n.data)).leftTopPoint;var i=t.width;t=t.height,o=V.zx7([o.x,o.y]),i=V.n1([[[n.x,n.y],[n.x+i,n.y],[n.x+i,n.y+t],[n.x,n.y+t],[n.x,n.y]]]);return V.mFO(o,i)},e.prototype.draw=function(t){var e,o=(i=this).context,n=i.startPoint,i=i.style,r=null==o?void 0:o.getCtx();o&&r&&(e=o.getCanvasEl())&&(t=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),o.clearDraw(),o.drawHistoryData(),r.beginPath(),this.leftTopPoint=Fe.getRectLeftTopPoint({startPoint:n,targetPoint:t}),this.width=Math.abs(t.x-((null==n?void 0:n.x)||0)),this.height=Math.abs(t.y-((null==n?void 0:n.y)||0)),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,r.rect((null==(e=this.leftTopPoint)?void 0:e.x)||0,(null==(o=this.leftTopPoint)?void 0:o.y)||0,this.width,this.height),r.stroke(),r.fill())},e.draw=function(t,e,o){e&&o&&(o.style&&(e.lineWidth=o.style.lineWidth,e.lineJoin=o.style.lineJoin,e.lineCap=o.style.lineCap,e.setLineDash(o.style.lineDash),e.lineDashOffset=o.style.lineDashOffset,e.strokeStyle=o.style.strokeStyle,e.fillStyle=o.style.fillStyle,e.globalAlpha=o.style.globalAlpha||1),this.drawHistoryPath(t,e,o.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,o,n){o.save(),o.beginPath(),t=e.transformOriginToReal(t,n),o.rect((null==(n=null==t?void 0:t.leftTopPoint)?void 0:n.x)||0,(null==(n=null==t?void 0:t.leftTopPoint)?void 0:n.y)||0,null==t?void 0:t.width,null==t?void 0:t.height),o.stroke(),o.fill(),o.restore()},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{leftTopPoint:t.pointToPixel(e.leftTopPoint),width:t.actualToDistance(e.width),height:t.actualToDistance(e.height)}},e.transformRealToOrigin=function(t,e){return{leftTopPoint:t.pixelToPoint(e.leftTopPoint),width:t.distanceToActual(e.width),height:t.distanceToActual(e.height)}},e.prototype.getSelectType=function(){return Re.Rectangle},e.prototype.start=function(e){var o;this.context&&![be.Running,be.Destroy].includes(this.status)&&(o=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Draw}),null!=o&&o.addEventListener("mousedown",this.onCanvasMouseDown),this.status=be.Running,this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Draw}))},e.prototype.end=function(o){var n,i=this.context;i&&(n=i.getCanvasEl())&&(null!=n&&n.removeEventListener("mousedown",this.onCanvasMouseDown),null!=n&&n.removeEventListener("mousemove",this.onCanvasMouseMove),null!=n&&n.removeEventListener("mouseup",this.onCanvasMouseUp),o&&this.draw(o),this.status=be.End,n={id:L.A.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{leftTopPoint:this.leftTopPoint,width:this.width,height:this.height}),style:this.style},i.addHistoryData(n),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Draw,data:n})),t.prototype.end.call(this,o)},e.prototype.destroy=function(){var e,o=this.context;o&&(e=o.getCanvasEl())&&(this.status===be.Running&&(o.clearDraw(),o.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.status=be.Destroy,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Draw})),t.prototype.destroy.call(this)},e}(He);const po=uo;var yo=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ho=function(t){function e(){var e=t.call(this)||this;return e.centerPoint=null,e.outRadius=0,e.innerRadius=0,e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return yo(e,t),e.booleanPointInData=function(t,o,n){for(var i=(t=e.transformOriginToReal(t,n.data)).center,r=t.outRadius,a=t.innerRadius,s=(n=V.zx7([o.x,o.y]),[]),l=0;l<5;l++)s.push({x:Math.cos((18+72*l)/180*Math.PI)*r+i.x,y:-Math.sin((18+72*l)/180*Math.PI)*r+i.y}),s.push({x:Math.cos((54+72*l)/180*Math.PI)*a+i.x,y:-Math.sin((54+72*l)/180*Math.PI)*a+i.y});return(t=s.map((function(t){return[t.x,t.y]}))).push(t[0]),o=V.n1([t]),V.mFO(n,o)},e.drawStart=function(t){var o=t.context,n=t.ctx;if((t=t.data)&&n){for(var i=t.style,r=(o=e.transformOriginToReal(o,t.data)).center,a=o.outRadius,s=o.innerRadius,l=(n.save(),n.beginPath(),72),c=0;c<5;c++)i&&(n.lineWidth=i.lineWidth,n.lineJoin=i.lineJoin,n.lineCap=i.lineCap,n.setLineDash(i.lineDash),n.lineDashOffset=i.lineDashOffset,n.strokeStyle=i.strokeStyle,n.fillStyle=i.fillStyle),n.lineTo(Math.cos((18+c*l)/180*Math.PI)*a+r.x,-Math.sin((18+c*l)/180*Math.PI)*a+r.y),n.lineTo(Math.cos((54+c*l)/180*Math.PI)*s+r.x,-Math.sin((54+c*l)/180*Math.PI)*s+r.y);n.stroke(),n.fill(),n.restore()}},e.prototype.draw=function(t){var o,n=this.context,i=this.centerPoint,r=null==n?void 0:n.getCtx();n&&i&&r&&(o=n.getCanvasEl())&&this.centerPoint&&(t=L.A.clientToCtxPoint({event:t,rect:null==o?void 0:o.getBoundingClientRect()}),n.clearDraw(),n.drawHistoryData(),this.outRadius=L.A.getDistanceByBetweenPoint({p1:i,p2:t}),this.innerRadius=this.outRadius/2,e.drawStart({context:n,ctx:r,data:{data:e.transformRealToOrigin(n,{center:this.centerPoint,outRadius:this.outRadius,innerRadius:this.innerRadius}),style:this.style}}))},e.draw=function(t,e,o){e&&o&&(o.style&&(e.lineWidth=o.style.lineWidth,e.lineJoin=o.style.lineJoin,e.lineCap=o.style.lineCap,e.setLineDash(o.style.lineDash),e.lineDashOffset=o.style.lineDashOffset,e.strokeStyle=o.style.strokeStyle,e.fillStyle=o.style.fillStyle,e.globalAlpha=o.style.globalAlpha||1),this.drawHistoryPath(t,e,o.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,o,n){n&&e.drawStart({context:t,ctx:o,data:{data:n}})},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.centerPoint=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{center:t.pointToPixel(e.center),outRadius:t.actualToDistance(e.outRadius),innerRadius:t.actualToDistance(e.innerRadius)}},e.transformRealToOrigin=function(t,e){return{center:t.pixelToPoint(e.center),outRadius:t.distanceToActual(e.outRadius),innerRadius:t.distanceToActual(e.innerRadius)}},e.prototype.getSelectType=function(){return Re.Start},e.prototype.start=function(e){var o;this.context&&![be.Running,be.Destroy].includes(this.status)&&(o=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Draw}),null!=o&&o.addEventListener("mousedown",this.onCanvasMouseDown),this.status=be.Running,this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Draw}))},e.prototype.end=function(o){var n,i=this.context;i&&(n=i.getCanvasEl())&&this.centerPoint&&this.outRadius&&this.innerRadius&&(null!=n&&n.removeEventListener("mousedown",this.onCanvasMouseDown),null!=n&&n.removeEventListener("mousemove",this.onCanvasMouseMove),null!=n&&n.removeEventListener("mouseup",this.onCanvasMouseUp),o&&this.draw(o),this.status=be.End,n={id:L.A.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{center:this.centerPoint,outRadius:this.outRadius,innerRadius:this.innerRadius}),style:this.style},i.addHistoryData(n),this.centerPoint=null,this.outRadius=0,this.innerRadius=0,this.isMove=!1,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Draw,data:n})),t.prototype.end.call(this,o)},e.prototype.destroy=function(){var e,o=this.context;o&&(e=o.getCanvasEl())&&(this.status===be.Running&&(o.clearDraw(),o.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.centerPoint=null,this.outRadius=0,this.innerRadius=0,this.isMove=!1,this.status=be.Destroy,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Draw})),t.prototype.destroy.call(this)},e}(He);const fo=ho;var go=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),xo=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},vo=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.points=[],e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return go(e,t),e.booleanPointInData=function(t,o,n){return(n=xo([],n.data.points||[],!0)).push(n[0]),n=e.transformOriginToReal(t,{points:n}).points,t=V.zx7([o.x,o.y]),o=V.n1([n.map((function(t){return[t.x,t.y]}))]),V.mFO(t,o)},e.prototype.draw=function(t){var e,o=(i=this).context,n=i.startPoint,i=i.style,r=null==o?void 0:o.getCtx();o&&r&&(e=o.getCanvasEl())&&(t=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),o.clearDraw(),o.drawHistoryData(),r.beginPath(),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,this.points=Fe.triangle({startPoint:n,targetPoint:t}),r.moveTo(this.points[0].x,this.points[0].y),r.lineTo(this.points[1].x,this.points[1].y),r.lineTo(this.points[2].x,this.points[2].y),r.closePath(),r.stroke(),r.fill())},e.draw=function(t,e,o){e&&o&&(o.style&&(e.lineWidth=o.style.lineWidth,e.lineJoin=o.style.lineJoin,e.lineCap=o.style.lineCap,e.setLineDash(o.style.lineDash),e.lineDashOffset=o.style.lineDashOffset,e.strokeStyle=o.style.strokeStyle,e.fillStyle=o.style.fillStyle,e.globalAlpha=o.style.globalAlpha||1),this.drawHistoryPath(t,e,o.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,o,n){o.save(),o.beginPath(),t=e.transformOriginToReal(t,{points:n.points}).points,o.moveTo(t[0].x,t[0].y),o.lineTo(t[1].x,t[1].y),o.lineTo(t[2].x,t[2].y),o.stroke(),o.fill(),o.restore()},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{points:e.points.map((function(e){return t.pointToPixel(e)}))}},e.transformRealToOrigin=function(t,e){return{points:e.points.map((function(e){return t.pixelToPoint(e)}))}},e.prototype.getSelectType=function(){return Re.Triangle},e.prototype.start=function(e){var o;this.context&&![be.Running,be.Destroy].includes(this.status)&&(o=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Draw}),null!=o&&o.addEventListener("mousedown",this.onCanvasMouseDown),this.status=be.Running,this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Draw}))},e.prototype.end=function(o){var n,i=this.context;i&&(n=i.getCanvasEl())&&(null!=n&&n.removeEventListener("mousedown",this.onCanvasMouseDown),null!=n&&n.removeEventListener("mousemove",this.onCanvasMouseMove),null!=n&&n.removeEventListener("mouseup",this.onCanvasMouseUp),o&&this.draw(o),this.status=be.End,n={id:L.A.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{points:JSON.parse(JSON.stringify(this.points))}),style:this.style},i.addHistoryData(n),this.startPoint=null,this.points=[],this.isMove=!1,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Draw,data:n})),t.prototype.end.call(this,o)},e.prototype.destroy=function(){var e,o=this.context;o&&(e=o.getCanvasEl())&&(this.status===be.Running&&(o.clearDraw(),o.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.points=[],this.isMove=!1,this.status=be.Destroy,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Draw})),t.prototype.destroy.call(this)},e}(He);const Mo=vo;var To=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Co=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},mo="adhere-ui-interactionlayer",Po=19999,wo=function(t){function e(e,o,n){var i=this;return i.update=i.update.bind(i),(i=t.call(this,{update:i.update,paneName:"markerPane",zIndex:Po})||this).map=null,i.el=null,i.listeners=null,i.curAction=null,i.canvasEl=null,i.ctx=null,i.assistCanvasEl=null,i.assistCtx=null,i.canvasData=[],i.emitter=new E.A.Events,i.isLoad=!1,i.canvasObserver=null,i.typeActionMap=new Map([[Re.Polygon,to],[Re.Distance,ro],[Re.Circle,Ye],[Re.Rectangle,po],[Re.Triangle,Mo],[Re.Diamond,Qe],[Re.Start,fo],[Re.Free,lo]]),i.map=e,i.listeners=n,o&&(i.canvasData=o),i.initListeners(),i}return To(e,t),e.prototype.update=function(){this.isLoad?(this.curAction&&this.curAction.destroy(),this.clearDraw(),this.clearAssistDraw(),this.drawHistoryData()):(this.initCanvas(),this.initEvents(),this.clearDraw(),this.clearAssistDraw(),this.drawHistoryData(),this.isLoad=!0)},e.prototype.initListeners=function(){var t=this,e=this.listeners;e&&Object.keys(e).forEach((function(o){t.emitter.on(o,e[o])}))},e.prototype.initEvents=function(){var t=this;this.el.addEventListener("mouseup",(function(e){if(e&&!(2<=e.detail)){for(var o=t.getHistoryData(),n=L.A.clientToCtxPoint({event:e,rect:t.getCanvasEl().getBoundingClientRect()}),i=[],r=0;r<o.length;r++){var a=o[r],s=t.typeActionMap.get(a.type);"booleanPointInData"in s&&(null==s?void 0:s.booleanPointInData(t,n,a))&&i.push({index:r,data:a})}i.length?t.emitter.trigger(Be.CanvasClickGeometry,JSON.parse(JSON.stringify(i[i.length-1].data))):o.length&&t.emitter.trigger(Be.CanvasClickEmpty)}}))},e.prototype.initCanvas=function(){var t=this;this.el=this.canvas.parentElement,this.canvasEl=this.canvas,this.el.style.width="".concat(this.canvasEl.width,"px"),this.el.style.height="".concat(this.canvasEl.height,"px"),this.canvasEl.className="".concat(mo),this.ctx=this.canvasEl.getContext("2d"),this.assistCanvasEl=document.createElement("canvas"),this.assistCanvasEl.className="".concat(mo,"-assist"),this.assistCanvasEl.style.zIndex="".concat(parseInt(this.canvasEl.style.zIndex)-1),this.assistCanvasEl.width=this.canvasEl.width,this.assistCanvasEl.height=this.canvasEl.height,this.assistCtx=this.assistCanvasEl.getContext("2d"),this.canvasObserver=new MutationObserver((function(e,o){for(var n=0,i=e;n<i.length;n++){var r=i[n];"attributes"===r.type&&"style"===r.attributeName&&(t.assistCanvasEl.style.left=t.canvasEl.style.left,t.assistCanvasEl.style.top=t.canvasEl.style.top)}})),this.canvasObserver.observe(this.canvasEl,{attributes:!0}),this.el.appendChild(this.assistCanvasEl),this.emitter.trigger(Be.CanvasMount)},e.prototype.enableMap=function(){this.map.enableDoubleClickZoom()},e.prototype.disableMap=function(){this.map.disableDoubleClickZoom()},e.prototype.pixelToPoint=function(t){return{x:(t=this.map.pixelToPoint(t)).lng,y:t.lat}},e.prototype.pointToPixel=function(t){return this.map.pointToPixel(new BMap.Point(t.x,t.y))},e.prototype.distanceToActual=function(t){return t/_.default.getScale(this.map)},e.prototype.actualToDistance=function(t){return _.default.getScale(this.map)*t},e.prototype.getCtx=function(){return this.ctx},e.prototype.getCanvasEl=function(){return this.canvasEl},e.prototype.getAssistCanvasEl=function(){return this.assistCanvasEl},e.prototype.getAssistCtx=function(){return this.assistCtx},e.prototype.getWidth=function(){var t;return null==(t=null==this?void 0:this.getCanvasEl())?void 0:t.width},e.prototype.getHeight=function(){var t;return null==(t=null==this?void 0:this.getCanvasEl())?void 0:t.height},e.prototype.addHistoryData=function(t){this.canvasData.push(t)},e.prototype.removeHistoryDataById=function(t){var e=this.canvasData.findIndex((function(e){return e.id===t}));return-1===e?[]:this.canvasData.splice(e,1)},e.prototype.drawHistoryData=function(){var t=this;this.canvasData.forEach((function(e){var o,n=t.ctx;n&&e&&(e.style&&(n.lineWidth=e.style.lineWidth,n.lineJoin=e.style.lineJoin,n.lineCap=e.style.lineCap,n.setLineDash(e.style.lineDash),n.lineDashOffset=e.style.lineDashOffset,n.strokeStyle=e.style.strokeStyle,n.fillStyle=e.style.fillStyle),null!=(o=t.typeActionMap.get(e.type)))&&o.drawHistoryPath(t,n,e.data)}))},e.prototype.getHistoryDataById=function(t){return this.canvasData.find((function(e){return e.id===t}))},e.prototype.getHistoryData=function(){return Co([],this.canvasData,!0)},e.prototype.setHistoryData=function(t){this.canvasData=t},e.prototype.changeAction=function(t){t===this.curAction||t&&t.getStatus()!==be.UnStart||(this.disableMap(),this.curAction&&this.curAction.destroy(),null!=t&&t.setContext(this),this.curAction=t)},e.prototype.getCurAction=function(){return this.curAction},e.prototype.start=function(t){this.curAction&&this.curAction.start(t)},e.prototype.end=function(){this.curAction&&this.curAction.end()},e.prototype.clearDraw=function(){var t=this.ctx;t&&t.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.clearAssistDraw=function(){var t=this.assistCtx;t&&t.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.setFrontCanvas=function(t){t.style.zIndex="".concat(2e4)},e.prototype.setBackCanvas=function(t){t.style.zIndex="".concat(19998)},e.prototype.destroy=function(){this.curAction&&this.curAction.destroy(),this.canvasObserver&&this.canvasObserver.disconnect()},e.prototype.getMap=function(){return this.map},e}(BMap.CanvasLayer);const Do=wo;var So=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Io=function(t){function e(e){var o=t.call(this)||this;return o.context=null,o.data=null,o.status=be.UnStart,o.EmitActions={CONTEXT:"CONTEXT"},o.anchorRadius=5,o.anchorLineWidth=2,o.startPoint=null,o.startIndex=-1,o.moveStartPoint=null,o.canMove=!0,o.isMoved=!1,o.data=e,o.onContext=o.onContext.bind(o),o.onCanvasMousedown=o.onCanvasMousedown.bind(o),o.onCanvasMousemove=o.onCanvasMousemove.bind(o),o.onCanvasMouseup=o.onCanvasMouseup.bind(o),o.onCanvasIsModifyMousemove=o.onCanvasIsModifyMousemove.bind(o),o.onMoveMousedown=o.onMoveMousedown.bind(o),o.onMoveMousemove=o.onMoveMousemove.bind(o),o.onMoveMouseup=o.onMoveMouseup.bind(o),o.on(o.EmitActions.CONTEXT,o.onContext),o}return So(e,t),e.prototype.setAnchorCircleStyle=function(){var t;this.context&&(t=this.context.getCtx())&&(t.strokeStyle=Ae.strokeStyle,t.fillStyle=Ae.fillStyle,t.lineWidth=Ae.lineWidth)},e.prototype.setAnchorLineStyle=function(){var t;this.context&&(t=this.context.getCtx())&&(t.strokeStyle=Ae.strokeStyle,t.lineWidth=Ae.lineWidth,t.setLineDash(Ae.lineDash),t.lineDashOffset=Ae.lineDashOffset)},e.prototype.onContext=function(){this.drawAnchors()},e.prototype.onCanvasMousedown=function(t){var e,o;this.context&&(e=this.context.getCanvasEl())&&this.context.getCtx()&&(o=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),o=this.getPointInAnchor(o))&&(this.startPoint=o.point,this.startIndex=o.index,e.addEventListener("mousemove",this.onCanvasMousemove),e.addEventListener("mouseup",this.onCanvasMouseup),t.stopPropagation())},e.prototype.onCanvasMousemove=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&this.context.getCtx()&&this.startPoint&&(e=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),this.drawModify(e),t.stopPropagation())},e.prototype.onCanvasMouseup=function(t){this.end(t),t.stopPropagation()},e.prototype.onCanvasIsModifyMousemove=function(t){var e,o,n,i;this.context&&(e=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),e)&&o&&(this.startPoint||this.moveStartPoint||(n=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),(i=this.getPointInAnchor(n))?(this.canMove=!1,this.setResizeCursorByIndex(i.index)):(this.canMove=this.isCanMove(n),this.canMove?e.style.cursor=o.style.cursor="move":e.style.cursor=o.style.cursor="default"),t.stopPropagation()))},e.prototype.initMoveEvents=function(){var t,e=this.context;e&&(t=e.getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&t.addEventListener("mousedown",this.onMoveMousedown)},e.prototype.clearMoveEvents=function(){var t,e=this.context;e&&(t=e.getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&(t.removeEventListener("mousedown",this.onMoveMousedown),t.removeEventListener("mousemove",this.onMoveMousemove),e.removeEventListener("mousemove",this.onMoveMousemove),e.removeEventListener("mouseup",this.onMoveMouseup))},e.prototype.onMoveMousedown=function(t){var e,o,n;t&&(e=this.context)&&(o=e.getCanvasEl(),n=e.getAssistCanvasEl(),o)&&n&&this.canMove&&(e.setFrontCanvas(n),this.moveStartPoint=L.A.clientToCtxPoint({event:t,rect:o.getBoundingClientRect()}),this.drawMoveGeometry(),o.addEventListener("mousemove",this.onMoveMousemove),n.addEventListener("mousemove",this.onMoveMousemove),n.addEventListener("mouseup",this.onMoveMouseup),null!=t)&&t.stopPropagation()},e.prototype.onMoveMousemove=function(t){var e,o,n;t&&(e=this.context)&&(o=e.getCanvasEl(),n=e.getAssistCanvasEl(),o)&&n&&(n=L.A.clientToCtxPoint({event:t,rect:o.getBoundingClientRect()}),this.moveStartPoint&&(this.isMoved=!0,e.clearAssistDraw(),this.drawMoveGeometry(this.moveStartPoint,n)),null!=t)&&t.stopPropagation()},e.prototype.onMoveMouseup=function(t){this.endMove(t)},e.prototype.start=function(){var t,e;this.context&&![be.Running,be.Destroy].includes(this.status)&&(t=(e=this.context).getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&(t.style.cursor=e.style.cursor="default",this.trigger(ze.BeforeStart,{selectType:this.getSelectType(),actionType:Ne.Modify}),t.addEventListener("mousedown",this.onCanvasMousedown),t.addEventListener("mousemove",this.onCanvasIsModifyMousemove),this.initMoveEvents(),this.status=be.Running,this.trigger(ze.Start,{selectType:this.getSelectType(),actionType:Ne.Modify}))},e.prototype.end=function(t){var e,o;t&&(o=this.context)&&(e=o.getCanvasEl(),o=o.getAssistCanvasEl(),e)&&o&&(e.style.cursor=o.style.cursor="default",e.removeEventListener("mousedown",this.onCanvasMousedown),e.removeEventListener("mousemove",this.onCanvasMousemove),e.removeEventListener("mouseup",this.onCanvasMouseup),e.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),t=L.A.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),this.drawModify(t),this.status=be.End,this.startPoint=null,this.startPoint=null,this.startIndex=-1,this.moveStartPoint=null,this.canMove=!0,this.isMoved=!1,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Modify,data:t}),e.style.cursor=o.style.cursor="default",null!=(t=null==this?void 0:this.context))&&t.enableMap()},e.prototype.endMove=function(t){var e,o,n,i;t&&(o=this.context)&&(n=o.getCanvasEl(),i=o.getAssistCanvasEl(),n)&&i&&(t=L.A.clientToCtxPoint({event:t,rect:n.getBoundingClientRect()}),this.canMove&&this.isMoved&&this.moveStartPoint?(o.setBackCanvas(i),o.clearAssistDraw(),this.drawMove(this.moveStartPoint,t),this.canMove=!0,this.isMoved=!1,this.moveStartPoint=null,this.startPoint=null,this.startIndex=-1,n.removeEventListener("mousedown",this.onCanvasMousedown),n.removeEventListener("mousemove",this.onCanvasMousemove),n.removeEventListener("mouseup",this.onCanvasMouseup),n.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),this.status=be.End,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Modify,data:t}),null!=(e=null==this?void 0:this.context)&&e.enableMap()):(o.setBackCanvas(i),this.canMove=!0,this.isMoved=!1,this.moveStartPoint=null,this.startPoint=null,this.startIndex=-1,n.removeEventListener("mousedown",this.onCanvasMousedown),n.removeEventListener("mousemove",this.onCanvasMousemove),n.removeEventListener("mouseup",this.onCanvasMouseup),n.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),this.status=be.End,this.trigger(ze.End,{selectType:this.getSelectType(),actionType:Ne.Modify,data:t})))},e.prototype.destroy=function(){var t,e,o=this.context;o&&(t=o.getCanvasEl(),e=o.getAssistCanvasEl(),t)&&e&&(t.style.cursor=e.style.cursor="default",this.remove(this.EmitActions.CONTEXT,this.onContext),t.removeEventListener("mousedown",this.onCanvasMousedown),t.removeEventListener("mousemove",this.onCanvasMousemove),t.removeEventListener("mouseup",this.onCanvasMouseup),t.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),o.clearDraw(),o.drawHistoryData(),this.status=be.Destroy,this.startPoint=null,this.startIndex=-1,this.moveStartPoint=null,this.canMove=!0,this.isMoved=!1,this.trigger(ze.Destroy,{selectType:this.getSelectType(),actionType:Ne.Modify}),t.style.cursor=e.style.cursor="default",null!=(o=null==this?void 0:this.context))&&o.enableMap()},e.prototype.setContext=function(t){this.context=t,this.trigger(this.EmitActions.CONTEXT)},e.prototype.getStatus=function(){return this.status},e}(E.A.Events);const Oo=Io;var jo,Ao=(jo=function(t,e){return(jo=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}jo(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),Lo=function(){return(Lo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Eo=function(t){function e(e){return(e=t.call(this,e)||this).ResizeCursorMapping=new Map([[0,"ns-resize"],[1,"ew-resize"],[2,"ns-resize"],[3,"ew-resize"]]),e}return Ao(e,t),e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t)for(var e=(o=Ye.transformOriginToReal(this.context,null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data)).center,o=o.radius,n=[{x:e.x,y:e.y-o},{x:e.x+o,y:e.y},{x:e.x,y:e.y+o},{x:e.x-o,y:e.y}],i=0;i<n.length;i++){var r=n[i];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(r.x,r.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,o=-1,n=(i=Ye.transformOriginToReal(this.context,null==(i=null==(i=null==this?void 0:this.data)?void 0:i.data)?void 0:i.data)).center,i=i.radius,r=[{x:n.x,y:n.y-i},{x:n.x+i,y:n.y},{x:n.x,y:n.y+i},{x:n.x-i,y:n.y}],a=0;a<r.length;a++){var s=r[a],l=this.anchorRadius+this.anchorLineWidth;if(L.A.isPointInCircle(t,{center:s,radius:l})){e=s,o=a;break}}return e&&-1!==o?{point:e,index:o}:null},e.prototype.setResizeCursorByIndex=function(t){var e,o;this.context&&(e=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),e)&&o&&(e.style.cursor=o.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();o&&n&&this.data&&this.startPoint&&(n=o.getHistoryDataById(this.data.data.id))&&(e=n.data.center,e=o.pointToPixel(e),n.data.radius=o.distanceToActual(L.A.getDistanceByBetweenPoint({p1:e,p2:t})),this.data.data=Lo({},n),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var o,n=this.context,i=null==n?void 0:n.getCtx();n&&i&&this.data&&(i=n.getHistoryDataById(this.data.data.id))&&(t=n.pixelToPoint(t),o=(e=n.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.center.x+=o,i.data.center.y+=e,this.data.data=Lo({},i),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return Re.Circle},e.prototype.isCanMove=function(t){var e,o;return!!this.data&&(e=(o=null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data).center,o=o.radius,L.A.isPointInCircle(t,Ye.transformOriginToReal(this.context,{center:e,radius:o})))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&Ye.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var o,n;this.context&&this.data&&t&&e&&((o=Lo({},this.data.data)).data=Lo(Lo({},o.data),{center:Lo({},o.data.center)}),t=this.context.pixelToPoint(t),n=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,o.data)&&o.data.center&&(o.data.center.x+=n,o.data.center.y+=e,o.style&&(o.style.globalAlpha=Le.globalAlpha,o.style.strokeStyle=Le.strokeStyle,o.style.lineWidth=Le.lineWidth,o.style.lineDash=Le.lineDash,o.style.lineDashOffset=Le.lineDashOffset),Ye.draw(this.context,this.context.getAssistCtx(),o))},e.prototype.setCursor=function(){},e}(Oo);const bo=Eo;var zo=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Bo=function(){return(Bo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Ro=function(t){function e(e){return(e=t.call(this,e)||this).rectangleAnchorPoints=[],e.indexToModifyHandlerMapping=new Map([[0,e.modifyDataByLeftTop],[1,e.modifyDataByCenterTop],[2,e.modifyDataByRightTop],[3,e.modifyDataByRightCenter],[4,e.modifyDataByRightBottom],[5,e.modifyDataByCenterBottom],[6,e.modifyDataByLeftBottom],[7,e.modifyDataByLeftCenter]]),e.ResizeCursorMapping=new Map([[0,"nwse-resize"],[1,"ns-resize"],[2,"nesw-resize"],[3,"ew-resize"],[4,"nwse-resize"],[5,"ns-resize"],[6,"nesw-resize"],[7,"ew-resize"]]),e}return zo(e,t),e.prototype.setCursor=function(){throw new Error("Method not implemented.")},e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t){var e,o=(e=Qe.transformOriginToReal(this.context,null==(e=null==(e=null==this?void 0:this.data)?void 0:e.data)?void 0:e.data)).leftTopPoint,n=e.width,i=n/2,r=(e=e.height)/2;this.rectangleAnchorPoints=[Bo({},o),{x:o.x+i,y:o.y},{x:o.x+n,y:o.y},{x:o.x+n,y:o.y+r},{x:o.x+n,y:o.y+e},{x:o.x+i,y:o.y+e},{x:o.x,y:o.y+e},{x:o.x,y:o.y+r}];for(var a=0;a<this.rectangleAnchorPoints.length;a++){var s=this.rectangleAnchorPoints[a];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(s.x,s.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}t.beginPath(),this.setAnchorLineStyle(),t.moveTo(o.x,o.y),t.lineTo(o.x+n,o.y),t.lineTo(o.x+n,o.y+e),t.lineTo(o.x,o.y+e),t.lineTo(o.x,o.y),t.stroke()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,o=-1,n=0;n<this.rectangleAnchorPoints.length;n++){var i=this.rectangleAnchorPoints[n],r=this.anchorRadius+this.anchorLineWidth;if(L.A.isPointInCircle(t,{center:i,radius:r})){e=i,o=n;break}}return e&&-1!==o?{point:e,index:o}:null},e.prototype.setResizeCursorByIndex=function(t){var e,o;this.context&&(e=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),e)&&o&&(e.style.cursor=o.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();o&&n&&this.data&&this.startPoint&&(n=o.getHistoryDataById(this.data.data.id))&&(e=this.indexToModifyHandlerMapping.get(this.startIndex))&&e.call(this,t)&&(this.data.data=Bo({},n),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var o,n=this.context,i=null==n?void 0:n.getCtx();n&&i&&this.data&&(i=n.getHistoryDataById(this.data.data.id))&&(t=n.pixelToPoint(t),o=(e=n.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.leftTopPoint.x+=o,i.data.leftTopPoint.y+=e,this.data.data=Bo({},i),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return Re.Diamond},e.prototype.getBox=function(){var t,e=this.context,o=null==e?void 0:e.getCtx();return e&&o&&this.data&&(o=e.getHistoryDataById(this.data.data.id))?(o=(e=Qe.transformOriginToReal(e,o.data)).leftTopPoint,t=e.width,e=e.height,{leftTop:Bo({},o),rightTop:{x:o.x+t,y:o.y},rightBottom:{x:o.x+t,y:o.y+e},leftBottom:{x:o.x,y:o.y+e}}):null},e.prototype.modifyDataByLeftTop=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x>e.rightTop.x||t.y>e.rightBottom.y||(n.data.leftTopPoint=o.pixelToPoint(t),n.data.width=o.distanceToActual(e.rightTop.x-t.x),n.data.height=o.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByCenterTop=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y>e.leftBottom.y||(n.data.leftTopPoint=o.pixelToPoint({x:e.leftTop.x,y:t.y}),n.data.height=o.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightTop=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y>e.leftBottom.y||(n.data.leftTopPoint=o.pixelToPoint({x:e.leftTop.x,y:t.y}),n.data.width=o.distanceToActual(t.x-e.leftTop.x),n.data.height=o.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightCenter=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||(n.data.width=o.distanceToActual(t.x-e.leftTop.x),0))},e.prototype.modifyDataByRightBottom=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y<e.leftTop.y||(n.data.width=o.distanceToActual(t.x-e.leftTop.x),n.data.height=o.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByCenterBottom=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y<e.leftTop.y||(n.data.height=o.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByLeftBottom=function(t){var e,o,n=this.context,i=null==n?void 0:n.getCtx();return!(!(n&&i&&this.data&&this.startPoint)||!(i=n.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=n.pointToPixel(e),!(o=this.getBox()))||t.x>o.rightBottom.x||t.y<o.rightTop.y||(i.data.leftTopPoint=n.pixelToPoint({x:t.x,y:e.y}),i.data.width=n.distanceToActual(o.rightBottom.x-t.x),i.data.height=n.distanceToActual(t.y-o.rightTop.y),0))},e.prototype.modifyDataByLeftCenter=function(t){var e,o,n=this.context,i=null==n?void 0:n.getCtx();return!(!(n&&i&&this.data&&this.startPoint)||!(i=n.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=n.pointToPixel(e),!(o=this.getBox()))||t.x>o.rightBottom.x||(i.data.leftTopPoint=n.pixelToPoint({x:t.x,y:e.y}),i.data.width=n.distanceToActual(o.rightBottom.x-t.x),0))},e.prototype.isCanMove=function(t){var e,o,n,i,r,a;return!!this.data&&(e=(o=Qe.transformOriginToReal(this.context,null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data)).leftTopPoint,n=(a=o.width)/2,i=(o=o.height)/2,r=V.zx7([t.x,t.y]),a=V.n1([[[e.x,e.y+i],[e.x+n,e.y],[e.x+a,e.y+i],[e.x+n,e.y+o],[e.x,e.y+i]]]),V.mFO(r,a))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&Qe.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var o,n;this.context&&this.data&&t&&e&&((o=Bo({},this.data.data)).data=Bo(Bo({},o.data),{leftTopPoint:Bo({},o.data.leftTopPoint)}),t=this.context.pixelToPoint(t),n=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,o.data)&&o.data.leftTopPoint&&(o.data.leftTopPoint.x+=n,o.data.leftTopPoint.y+=e,o.style&&(o.style.globalAlpha=Le.globalAlpha,o.style.strokeStyle=Le.strokeStyle,o.style.lineWidth=Le.lineWidth,o.style.lineDash=Le.lineDash,o.style.lineDashOffset=Le.lineDashOffset),Qe.draw(this.context,this.context.getAssistCtx(),o))},e.prototype.destroy=function(){this.startIndex=-1,t.prototype.destroy.call(this)},e}(Oo);const No=Ro;var _o=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ko=function(){return(ko=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Go=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Ho=function(t){function e(e){return(e=t.call(this,e)||this).startIndex=-1,e}return _o(e,t),e.prototype.drawAnchors=function(){var t;if(this.context){var e=this.context.getCtx();if(e)for(var o=to.transformOriginToReal(this.context,(null==(t=null==(t=null==this?void 0:this.data)?void 0:t.data)?void 0:t.data)||[]),n=0;n<o.length;n++){var i=o[n];e.beginPath(),this.setAnchorCircleStyle(),e.ellipse(i.x,i.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),e.stroke(),e.fill()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,o=-1,n=to.transformOriginToReal(this.context,this.data.data.data),i=0;i<n.length;i++){var r=n[i],a=this.anchorRadius+this.anchorLineWidth;if(L.A.isPointInCircle(t,{center:r,radius:a})){e=r,o=i;break}}return e&&-1!==o?{point:e,index:o}:null},e.prototype.setResizeCursorByIndex=function(t){var e,o;this.context&&(e=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),e)&&o&&(e.style.cursor=o.style.cursor="nesw-resize")},e.prototype.drawModify=function(t){var e=this.context,o=null==e?void 0:e.getCtx();e&&o&&this.data&&this.startPoint&&-1!==this.startIndex&&(o=e.getHistoryDataById(this.data.data.id))&&(o.data[this.startIndex]=e.pixelToPoint(t),this.data.data=ko({},o),e.clearDraw(),e.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var o,n,i=this.context,r=null==i?void 0:i.getCtx();i&&r&&this.data&&(r=i.getHistoryDataById(this.data.data.id))&&(t=i.pixelToPoint(t),e=i.pixelToPoint(e),o=e.x-t.x,n=e.y-t.y,r.data.forEach((function(t){t.x+=o,t.y+=n})),this.data.data=ko({},r),i.clearDraw(),i.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return Re.Polygon},e.prototype.isCanMove=function(t){var e,o;return!!this.data&&((o=to.transformOriginToReal(this.context,Go([],null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data,!0))).push(o[0]),e=V.zx7([t.x,t.y]),o=V.n1([o.map((function(t){return[t.x,t.y]}))]),V.mFO(e,o))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&to.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var o,n,i;this.context&&this.data&&t&&e&&((o=ko({},this.data.data)).data=o.data.map((function(t){return ko({},t)})),t=this.context.pixelToPoint(t),e=this.context.pixelToPoint(e),n=e.x-t.x,i=e.y-t.y,o.data)&&o.data.length&&(o.data.forEach((function(t){t.x+=n,t.y+=i})),o.style&&(o.style.globalAlpha=Le.globalAlpha,o.style.strokeStyle=Le.strokeStyle,o.style.lineWidth=Le.lineWidth,o.style.lineDash=Le.lineDash,o.style.lineDashOffset=Le.lineDashOffset),to.draw(this.context,this.context.getAssistCtx(),o))},e.prototype.setCursor=function(){},e}(Oo);const Wo=Ho;var Uo=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Yo=function(){return(Yo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Fo=function(t){function e(e){return(e=t.call(this,e)||this).rectangleAnchorPoints=[],e.indexToModifyHandlerMapping=new Map([[0,e.modifyDataByLeftTop],[1,e.modifyDataByCenterTop],[2,e.modifyDataByRightTop],[3,e.modifyDataByRightCenter],[4,e.modifyDataByRightBottom],[5,e.modifyDataByCenterBottom],[6,e.modifyDataByLeftBottom],[7,e.modifyDataByLeftCenter]]),e.ResizeCursorMapping=new Map([[0,"nwse-resize"],[1,"ns-resize"],[2,"nesw-resize"],[3,"ew-resize"],[4,"nwse-resize"],[5,"ns-resize"],[6,"nesw-resize"],[7,"ew-resize"]]),e}return Uo(e,t),e.prototype.setCursor=function(){throw new Error("Method not implemented.")},e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t){var e,o=(e=po.transformOriginToReal(this.context,null==(e=null==(e=null==this?void 0:this.data)?void 0:e.data)?void 0:e.data)).leftTopPoint,n=e.width,i=n/2,r=(e=e.height)/2;this.rectangleAnchorPoints=[Yo({},o),{x:o.x+i,y:o.y},{x:o.x+n,y:o.y},{x:o.x+n,y:o.y+r},{x:o.x+n,y:o.y+e},{x:o.x+i,y:o.y+e},{x:o.x,y:o.y+e},{x:o.x,y:o.y+r}];for(var a=0;a<this.rectangleAnchorPoints.length;a++){var s=this.rectangleAnchorPoints[a];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(s.x,s.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,o=-1,n=0;n<this.rectangleAnchorPoints.length;n++){var i=this.rectangleAnchorPoints[n],r=this.anchorRadius+this.anchorLineWidth;if(L.A.isPointInCircle(t,{center:i,radius:r})){e=i,o=n;break}}return e&&-1!==o?{point:e,index:o}:null},e.prototype.setResizeCursorByIndex=function(t){var e,o;this.context&&(e=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),e)&&o&&(e.style.cursor=o.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();o&&n&&this.data&&this.startPoint&&(n=o.getHistoryDataById(this.data.data.id))&&(e=this.indexToModifyHandlerMapping.get(this.startIndex))&&e.call(this,t)&&(this.data.data=Yo({},n),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var o,n=this.context,i=null==n?void 0:n.getCtx();n&&i&&this.data&&(i=n.getHistoryDataById(this.data.data.id))&&(t=n.pixelToPoint(t),o=(e=n.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.leftTopPoint.x+=o,i.data.leftTopPoint.y+=e,this.data.data=Yo({},i),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return Re.Rectangle},e.prototype.getBox=function(){var t,e=this.context,o=null==e?void 0:e.getCtx();return e&&o&&this.data&&(o=e.getHistoryDataById(this.data.data.id))?(o=(e=po.transformOriginToReal(e,o.data)).leftTopPoint,t=e.width,e=e.height,{leftTop:Yo({},o),rightTop:{x:o.x+t,y:o.y},rightBottom:{x:o.x+t,y:o.y+e},leftBottom:{x:o.x,y:o.y+e}}):null},e.prototype.modifyDataByLeftTop=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x>e.rightTop.x||t.y>e.rightBottom.y||(n.data.leftTopPoint=o.pixelToPoint(t),n.data.width=o.distanceToActual(e.rightTop.x-t.x),n.data.height=o.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByCenterTop=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y>e.leftBottom.y||(n.data.leftTopPoint=o.pixelToPoint({x:e.leftTop.x,y:t.y}),n.data.height=o.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightTop=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y>e.leftBottom.y||(n.data.leftTopPoint=o.pixelToPoint({x:e.leftTop.x,y:t.y}),n.data.width=o.distanceToActual(t.x-e.leftTop.x),n.data.height=o.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightCenter=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||(n.data.width=o.distanceToActual(t.x-e.leftTop.x),0))},e.prototype.modifyDataByRightBottom=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y<e.leftTop.y||(n.data.width=o.distanceToActual(t.x-e.leftTop.x),n.data.height=o.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByCenterBottom=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();return!(!(o&&n&&this.data&&this.startPoint)||!(n=o.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y<e.leftTop.y||(n.data.height=o.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByLeftBottom=function(t){var e,o,n=this.context,i=null==n?void 0:n.getCtx();return!(!(n&&i&&this.data&&this.startPoint)||!(i=n.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=n.pointToPixel(e),!(o=this.getBox()))||t.x>o.rightBottom.x||t.y<o.rightTop.y||(i.data.leftTopPoint=n.pixelToPoint({x:t.x,y:e.y}),i.data.width=n.distanceToActual(o.rightBottom.x-t.x),i.data.height=n.distanceToActual(t.y-o.rightTop.y),0))},e.prototype.modifyDataByLeftCenter=function(t){var e,o,n=this.context,i=null==n?void 0:n.getCtx();return!(!(n&&i&&this.data&&this.startPoint)||!(i=n.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=n.pointToPixel(e),!(o=this.getBox()))||t.x>o.rightBottom.x||(i.data.leftTopPoint=n.pixelToPoint({x:t.x,y:e.y}),i.data.width=n.distanceToActual(o.rightBottom.x-t.x),0))},e.prototype.isCanMove=function(t){var e,o,n,i;return!!this.data&&(e=(o=po.transformOriginToReal(this.context,null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data)).leftTopPoint,i=o.width,o=o.height,n=V.zx7([t.x,t.y]),i=V.n1([[[e.x,e.y],[e.x+i,e.y],[e.x+i,e.y+o],[e.x,e.y+o],[e.x,e.y]]]),V.mFO(n,i))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&po.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var o,n;this.context&&this.data&&t&&e&&((o=Yo({},this.data.data)).data=Yo(Yo({},o.data),{leftTopPoint:Yo({},o.data.leftTopPoint)}),t=this.context.pixelToPoint(t),n=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,o.data)&&o.data.leftTopPoint&&(o.data.leftTopPoint.x+=n,o.data.leftTopPoint.y+=e,o.style&&(o.style.globalAlpha=Le.globalAlpha,o.style.strokeStyle=Le.strokeStyle,o.style.lineWidth=Le.lineWidth,o.style.lineDash=Le.lineDash,o.style.lineDashOffset=Le.lineDashOffset),po.draw(this.context,this.context.getAssistCtx(),o))},e.prototype.destroy=function(){this.startIndex=-1,t.prototype.destroy.call(this)},e}(Oo);const Zo=Fo;var Jo=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Qo=function(){return(Qo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Vo=function(t){function e(e){return(e=t.call(this,e)||this).ResizeCursorMapping=new Map([[0,"ns-resize"],[1,"ew-resize"],[2,"ns-resize"],[3,"ew-resize"]]),e}return Jo(e,t),e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t){for(var e=(o=fo.transformOriginToReal(this.context,null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data)).center,o=o.outRadius,n=[{x:e.x,y:e.y-o},{x:e.x+o,y:e.y},{x:e.x,y:e.y+o},{x:e.x-o,y:e.y}],i=0;i<n.length;i++){var r=n[i];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(r.x,r.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}t.beginPath(),this.setAnchorLineStyle(),t.ellipse(e.x,e.y,o,o,45*Math.PI/180,0,2*Math.PI),t.closePath(),t.stroke()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,o=-1,n=(i=fo.transformOriginToReal(this.context,null==(i=null==(i=null==this?void 0:this.data)?void 0:i.data)?void 0:i.data)).center,i=i.outRadius,r=[{x:n.x,y:n.y-i},{x:n.x+i,y:n.y},{x:n.x,y:n.y+i},{x:n.x-i,y:n.y}],a=0;a<r.length;a++){var s=r[a],l=this.anchorRadius+this.anchorLineWidth;if(L.A.isPointInCircle(t,{center:s,radius:l})){e=s,o=a;break}}return e&&-1!==o?{point:e,index:o}:null},e.prototype.setResizeCursorByIndex=function(t){var e,o;this.context&&(e=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),e)&&o&&(t=this.ResizeCursorMapping.get(t),e.style.cursor=o.style.cursor=t)},e.prototype.drawModify=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();o&&n&&this.data&&this.startPoint&&(n=o.getHistoryDataById(this.data.data.id))&&(e=n.data.center,e=o.pointToPixel(e),n.data.outRadius=o.distanceToActual(L.A.getDistanceByBetweenPoint({p1:e,p2:t})),n.data.innerRadius=n.data.outRadius/2,this.data.data=Qo({},n),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var o,n=this.context,i=null==n?void 0:n.getCtx();n&&i&&this.data&&(i=n.getHistoryDataById(this.data.data.id))&&(t=n.pixelToPoint(t),o=(e=n.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.center.x+=o,i.data.center.y+=e,this.data.data=Qo({},i),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return Re.Start},e.prototype.isCanMove=function(t){if(!this.data)return!1;for(var e=(i=fo.transformOriginToReal(this.context,null==(i=null==(i=null==this?void 0:this.data)?void 0:i.data)?void 0:i.data)).center,o=i.outRadius,n=i.innerRadius,i=V.zx7([t.x,t.y]),r=[],a=0;a<5;a++)r.push({x:Math.cos((18+72*a)/180*Math.PI)*o+e.x,y:-Math.sin((18+72*a)/180*Math.PI)*o+e.y}),r.push({x:Math.cos((54+72*a)/180*Math.PI)*n+e.x,y:-Math.sin((54+72*a)/180*Math.PI)*n+e.y});var s=r.map((function(t){return[t.x,t.y]}));s.push(s[0]),s=V.n1([s]);return V.mFO(i,s)&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&fo.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var o,n;this.context&&this.data&&t&&e&&((o=Qo({},this.data.data)).data=Qo(Qo({},o.data),{center:Qo({},o.data.center)}),t=this.context.pixelToPoint(t),n=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,o.data)&&o.data.center&&(o.data.center.x+=n,o.data.center.y+=e,o.style&&(o.style.globalAlpha=Le.globalAlpha,o.style.strokeStyle=Le.strokeStyle,o.style.lineWidth=Le.lineWidth,o.style.lineDash=Le.lineDash,o.style.lineDashOffset=Le.lineDashOffset),fo.draw(this.context,this.context.getAssistCtx(),o))},e.prototype.setCursor=function(){},e}(Oo);const Xo=Vo;var Ko=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),qo=function(){return(qo=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},$o=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},tn=function(t){function e(e){return(e=t.call(this,e)||this).rectangleAnchorPoints=[],e.indexToModifyHandlerMapping=new Map([[0,e.modifyDataByLeftTop],[1,e.modifyDataByCenterTop],[2,e.modifyDataByRightTop],[3,e.modifyDataByRightCenter],[4,e.modifyDataByRightBottom],[5,e.modifyDataByCenterBottom],[6,e.modifyDataByLeftBottom],[7,e.modifyDataByLeftCenter]]),e.ResizeCursorMapping=new Map([[0,"nwse-resize"],[1,"ns-resize"],[2,"nesw-resize"],[3,"ew-resize"],[4,"nwse-resize"],[5,"ns-resize"],[6,"nesw-resize"],[7,"ew-resize"]]),e}return Ko(e,t),e.prototype.setCursor=function(){throw new Error("Method not implemented.")},e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t)if((e=Mo.transformOriginToReal(this.context,null==(e=null==(e=null==this?void 0:this.data)?void 0:e.data)?void 0:e.data).points)&&e.length){var e,o={x:e[0].x,y:e[1].y},n=e[2].x-e[0].x,i=n/2,r=(e=e[2].y-e[1].y)/2;this.rectangleAnchorPoints=[qo({},o),{x:o.x+i,y:o.y},{x:o.x+n,y:o.y},{x:o.x+n,y:o.y+r},{x:o.x+n,y:o.y+e},{x:o.x+i,y:o.y+e},{x:o.x,y:o.y+e},{x:o.x,y:o.y+r}];for(var a=0;a<this.rectangleAnchorPoints.length;a++){var s=this.rectangleAnchorPoints[a];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(s.x,s.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}t.beginPath(),this.setAnchorLineStyle(),t.moveTo(o.x,o.y),t.lineTo(o.x+n,o.y),t.lineTo(o.x+n,o.y+e),t.lineTo(o.x,o.y+e),t.lineTo(o.x,o.y),t.stroke()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,o=-1,n=0;n<this.rectangleAnchorPoints.length;n++){var i=this.rectangleAnchorPoints[n],r=this.anchorRadius+this.anchorLineWidth;if(L.A.isPointInCircle(t,{center:i,radius:r})){e=i,o=n;break}}return e&&-1!==o?{point:e,index:o}:null},e.prototype.setResizeCursorByIndex=function(t){var e,o;this.context&&(e=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),e)&&o&&(e.style.cursor=o.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,o=this.context,n=null==o?void 0:o.getCtx();o&&n&&this.data&&this.startPoint&&(n=o.getHistoryDataById(this.data.data.id))&&(e=this.indexToModifyHandlerMapping.get(this.startIndex))&&e.call(this,t)&&(this.data.data=qo({},n),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var o,n,i=this.context,r=null==i?void 0:i.getCtx();i&&r&&this.data&&(r=i.getHistoryDataById(this.data.data.id))&&(t=i.pixelToPoint(t),e=i.pixelToPoint(e),o=e.x-t.x,n=e.y-t.y,r.data.points.forEach((function(t){t.x+=o,t.y+=n})),this.data.data=qo({},r),i.clearDraw(),i.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return Re.Triangle},e.prototype.getBox=function(){var t,e,o=this.context;return o&&this.data&&(t=o.getHistoryDataById(this.data.data.id))&&(o=Mo.transformOriginToReal(o,t.data).points)&&o.length?(t={x:o[0].x,y:o[1].y},e=o[2].x-o[0].x,o=o[2].y-o[1].y,{leftTop:qo({},t),rightTop:{x:t.x+e,y:t.y},rightBottom:{x:t.x+e,y:t.y+o},leftBottom:{x:t.x,y:t.y+o}}):null},e.prototype.modifyDataByLeftTop=function(t){var e,o,n=this.context,i=null==n?void 0:n.getCtx();return!!(n&&i&&this.data&&this.startPoint)&&!!(i=n.getHistoryDataById(this.data.data.id))&&!(!(o=i.data.points)||!o.length||!(o=this.getBox())||t.x>o.rightTop.x||t.y>o.rightBottom.y||(e=o.rightTop.x-t.x,o=o.rightBottom.y-t.y,i.data.points=Mo.transformRealToOrigin(n,{points:[{x:t.x,y:t.y+o},{x:t.x+e/2,y:t.y},{x:t.x+e,y:t.y+o}]}).points,0))},e.prototype.modifyDataByCenterTop=function(t){var e,o,n,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(n=r.data.points)||!n.length||!(n=this.getBox())||t.y>n.leftBottom.y||(e={x:n.leftTop.x,y:t.y},o=n.rightTop.x-n.leftTop.x,n=n.rightBottom.y-t.y,r.data.points=Mo.transformRealToOrigin(i,{points:[{x:e.x,y:e.y+n},{x:e.x+o/2,y:e.y},{x:e.x+o,y:e.y+n}]}).points,0))},e.prototype.modifyDataByRightTop=function(t){var e,o,n,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(n=r.data.points)||!n.length||!(n=this.getBox())||t.x<n.leftTop.x||t.y>n.leftBottom.y||(e={x:n.leftTop.x,y:t.y},o=t.x-n.leftTop.x,n=n.rightBottom.y-t.y,r.data.points=Mo.transformRealToOrigin(i,{points:[{x:e.x,y:e.y+n},{x:e.x+o/2,y:e.y},{x:e.x+o,y:e.y+n}]}).points,0))},e.prototype.modifyDataByRightCenter=function(t){var e,o,n=this.context,i=null==n?void 0:n.getCtx();return!!(n&&i&&this.data&&this.startPoint)&&!!(i=n.getHistoryDataById(this.data.data.id))&&!(!(o=i.data.points)||!o.length||!(o=this.getBox())||t.x<o.leftTop.x||(e={x:o.leftTop.x,y:o.leftTop.y},t=t.x-o.leftTop.x,o=o.rightBottom.y-o.rightTop.y,i.data.points=Mo.transformRealToOrigin(n,{points:[{x:e.x,y:e.y+o},{x:e.x+t/2,y:e.y},{x:e.x+t,y:e.y+o}]}).points,0))},e.prototype.modifyDataByRightBottom=function(t){var e,o,n,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(e=r.data.points)||!e.length||!(e=this.getBox())||t.x<e.leftTop.x||t.y<e.leftTop.y||(o=qo({},e.leftTop),n=t.x-e.leftTop.x,t=t.y-e.leftTop.y,r.data.points=Mo.transformRealToOrigin(i,{points:[{x:o.x,y:o.y+t},{x:o.x+n/2,y:o.y},{x:o.x+n,y:o.y+t}]}).points,0))},e.prototype.modifyDataByCenterBottom=function(t){var e,o,n,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(e=r.data.points)||!e.length||!(e=this.getBox())||t.y<e.leftTop.y||(o=qo({},e.leftTop),n=e.rightTop.x-e.leftTop.x,t=t.y-e.leftTop.y,r.data.points=Mo.transformRealToOrigin(i,{points:[{x:o.x,y:o.y+t},{x:o.x+n/2,y:o.y},{x:o.x+n,y:o.y+t}]}).points,0))},e.prototype.modifyDataByLeftBottom=function(t){var e,o,n,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(e=r.data.points)||!e.length||!(e=this.getBox())||t.x>e.rightBottom.x||t.y<e.rightTop.y||(o={x:t.x,y:e.leftTop.y},n=e.rightBottom.x-t.x,t=t.y-e.rightTop.y,r.data.points=Mo.transformRealToOrigin(i,{points:[{x:o.x,y:o.y+t},{x:o.x+n/2,y:o.y},{x:o.x+n,y:o.y+t}]}).points,0))},e.prototype.modifyDataByLeftCenter=function(t){var e,o,n=this.context,i=null==n?void 0:n.getCtx();return!!(n&&i&&this.data&&this.startPoint)&&!!(i=n.getHistoryDataById(this.data.data.id))&&!(!(o=i.data.points)||!o.length||!(o=this.getBox())||t.x>o.rightBottom.x||(e={x:t.x,y:o.leftTop.y},t=o.rightBottom.x-t.x,o=o.rightBottom.y-o.rightTop.y,i.data.points=Mo.transformRealToOrigin(n,{points:[{x:e.x,y:e.y+o},{x:e.x+t/2,y:e.y},{x:e.x+t,y:e.y+o}]}).points,0))},e.prototype.isCanMove=function(t){var e,o;return!!this.data&&((o=Mo.transformOriginToReal(this.context,{points:$o([],(null==(o=null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data)?void 0:o.points)||[],!0)}).points).push(o[0]),e=V.zx7([t.x,t.y]),o=V.n1([o.map((function(t){return[t.x,t.y]}))]),V.mFO(e,o))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&Mo.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var o,n,i;this.context&&this.data&&t&&e&&((o=qo({},this.data.data)).data=qo(qo({},o.data),{points:o.data.points.map((function(t){return qo({},t)}))}),t=this.context.pixelToPoint(t),e=this.context.pixelToPoint(e),n=e.x-t.x,i=e.y-t.y,o.data)&&o.data.points&&o.data.points.length&&(o.data.points.forEach((function(t){t.x+=n,t.y+=i})),o.style&&(o.style.globalAlpha=Le.globalAlpha,o.style.strokeStyle=Le.strokeStyle,o.style.lineWidth=Le.lineWidth,o.style.lineDash=Le.lineDash,o.style.lineDashOffset=Le.lineDashOffset),Mo.draw(this.context,this.context.getAssistCtx(),o))},e.prototype.destroy=function(){this.startIndex=-1,t.prototype.destroy.call(this)},e}(Oo);const en=tn;const on={fillStyle:"#fff",strokeStyle:"#fff",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:1};const nn={fillStyle:"#fff",strokeStyle:"#fff",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:.6};var rn=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},an=function(){function t(t){var e=t.context,o=t.id,n=t.coordinates,i=t.renderPosition,r=t.renderStep,a=t.renderCap;t=t.duration;this.id="",this.context=null,this.coordinates=[],this.duration=0,this.status=f.UnInit,this.boutTotal=0,this.bout=1,this.loopHeader=-1,this.loopPointEntitys=[],this.stepEntityIndexes=[],this.preLoopPixel=null,this.arrowMarker=null,this.context=e,this.id=o,this.coordinates=n,this.duration=t,this.renderPosition=i,this.renderStep=r,this.renderCap=a}return t.prototype.drawDefaultPosition=function(t,e){var o,n=this.context;n&&(o=n.getCtx())&&(n=n.pointToPixel({x:t.lng,y:t.lat}),o.beginPath(),o.strokeStyle="red",o.fillStyle="#fff",o.lineWidth=3,o.ellipse(n.x,n.y,6,6,45*Math.PI/180,0,2*Math.PI),o.stroke(),o.fill(),o.beginPath(),o.font="8px sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillStyle="#000",o.fillText("".concat(e+1),n.x,n.y,10))},t.prototype.createDefaultCap=function(){var t;if(this.context)return t=new BMap.Icon("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMxNDU2MzQ2NjYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQxMzYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTc4OC40OCA1MTJMMzEyLjMyIDc4Ni45MjM1MlYyMzcuMDk2OTZ6IiBwLWlkPSI0MTM3IiBmaWxsPSIjRkZBNTAwIj48L3BhdGg+PC9zdmc+",new BMap.Size(16,16)),new BMap.Marker(new BMap.Point(90,90),{icon:t})},t.prototype.updateCap=function(t){var e,o,n=(r=this).preLoopPixel,i=r.context,r=r.arrowMarker;i&&n&&r&&(i=i.pixelToPoint(t),e=t.x-n.x,o=t.y-n.y,Math.atan2(o,e),Math.PI,o=L.A.slopToAngle(n,t,"geographic"),r.setPosition(new BMap.Point(i.x,i.y)),r.setRotation(o))},t.prototype.drawPosition=function(){var t,e,o=this,n=(e=this).renderPosition,i=e.coordinates;(e=e.context)&&(t=e.getCtx())&&i.forEach((function(e,i){n?n({ctx:t,coordinate:e}):o.drawDefaultPosition(e,i)}))},t.prototype.drawTrajectory=function(){this.drawPosition(),this.prepareLoopData();for(var t=1;t<this.boutTotal;t++)this.loopBout(t);this.drawLastFrame(),this.finishDeal()},t.prototype.drawLastFrame=function(){var t=this,e=t.loopPointEntitys,o=t.context,n=t.renderStep;t.renderCap,o&&(t=o.getCtx())&&(e=e[e.length-1],o=o.pointToPixel({x:e.point.lng,y:e.point.lat}),t.beginPath(),n?n(t,o):(this.setDrawLoopStyle(),t.lineTo(o.x,o.y),t.stroke(),this.preLoopPixel=null),this.updateCap(o))},t.prototype.setDrawLoopStyle=function(){var t=this.context;t&&(t=t.getCtx())&&(t.strokeStyle="orange",t.lineWidth=3)},t.prototype.finishDeal=function(){var t=this.context;t&&(t=t.getMap())&&(-1!==this.loopHeader&&"undefined"!=typeof window&&window.cancelAnimationFrame(this.loopHeader),this.loopHeader=-1,this.bout=1,this.boutTotal=0,this.loopPointEntitys=[],this.stepEntityIndexes=[],this.preLoopPixel=null,this.arrowMarker&&t.removeOverlay(this.arrowMarker),this.arrowMarker=null)},t.prototype.loopBout=function(t){var e=(l=this).context,o=l.loopPointEntitys,n=l.stepEntityIndexes,i=l.renderStep,r=l.renderCap;if(e){var a=e.getCtx();if(a)for(var s=e.getMap(),l=1===t?0:n[t-2],c=n[t-1],u=l;u<c;u++){var p=o[u].point;p=e.pointToPixel({x:p.lng,y:p.lat});this.preLoopPixel?this.updateCap(p):(this.arrowMarker=r?r():this.createDefaultCap(),s.addOverlay(this.arrowMarker)),i?i(a,p):this.preLoopPixel?(a.lineTo(p.x,p.y),a.stroke(),a.beginPath(),this.setDrawLoopStyle(),a.moveTo(p.x,p.y)):(a.beginPath(),this.setDrawLoopStyle(),a.moveTo(p.x,p.y),this.preLoopPixel=p)}}},t.prototype.loop=function(){var t=this;"undefined"!=typeof window&&(this.loopHeader=window.requestAnimationFrame((function(){var e;t.status===f.Pause?t.loop():(e=t.context)&&e.getCtx()&&(t.loopBout(t.bout),t.bout++,t.bout>=t.boutTotal?(t.drawLastFrame(),t.finishDeal(),t.status=f.End):t.loop())})))},t.prototype.prepareLoopData=function(){for(var t=this,e=this.duration,o=this.coordinates,n=[],i=(o.reduce((function(t,e,i){return i=0===i?0:V.I3T(V.IoC(V.zx7([o[i-1].lng,o[i-1].lat]),V.zx7([e.lng,e.lat]),{units:"kilometers"}),"kilometers","meters"),n.push({point:e,distance:t+i,isStep:!1}),t+i}),0),V.wiw(o.map((function(t){return[t.lng,t.lat]})))),r=V.I3T(V.Bw9(i,{units:"kilometers"}),"kilometers","meters"),a=(this.boutTotal=60*e,r/this.boutTotal),s=[],l=0;l<this.boutTotal;l++){var c=(l+1)*a,u=V.Qwm(i,V.I3T(c,"meters","kilometers"),{units:"kilometers"});s.push({point:{lng:u.geometry.coordinates[0],lat:u.geometry.coordinates[1]},distance:c,isStep:!0})}this.loopPointEntitys=rn(rn([],n,!0),s,!0),this.loopPointEntitys.sort((function(t,e){return t.distance>e.distance?1:t.distance<e.distance?-1:0})),this.stepEntityIndexes=[],this.loopPointEntitys.forEach((function(e,o){e.isStep&&t.stepEntityIndexes.push(o)}))},t.prototype.init=function(){this.status===f.UnInit&&(this.drawPosition(),this.status=f.Init)},t.prototype.start=function(){var t=this.context;t&&t.getCtx()&&[f.Init,f.End,f.Pause].includes(this.status)&&([f.Pause,f.End].includes(this.status)&&(f.Pause===this.status&&this.finishDeal(),t.clear(),t.drawHistory()),this.status=f.Running,this.prepareLoopData(),this.loop())},t.prototype.pause=function(){this.status=f.Pause},t.prototype.resume=function(){this.status=f.Running},t.prototype.finish=function(){this.context&&![f.End,f.Destroy].includes(this.status)&&(this.finishDeal(),this.status=f.End)},t.prototype.destroy=function(){var t;this.status!==f.Destroy&&(t=this.context)&&(this.finishDeal(),t.clear(),this.status=f.Destroy,t.removeTrajectoryById(this.id))},t.prototype.getId=function(){return this.id},t.prototype.getStatus=function(){return this.status},t.prototype.drawHistory=function(){var t=this.status;if(f.Init===t?this.drawPosition():f.End===t&&this.drawTrajectory(),[f.Pause,f.Running].includes(t)){this.drawPosition();for(var e=1;e<this.bout;e++)this.loopBout(e)}},t}();const sn=an;var ln=function(){var t=function(e,o){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}))(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),cn=function(){return(cn=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},un=function(t,e,o){if(o||2===arguments.length)for(var n,i=0,r=e.length;i<r;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},pn=function(t){function e(e,o){var n=this;return n.update=n.update.bind(n),(n=t.call(this,{update:n.update,paneName:o.paneName,zIndex:o.zIndex})||this).emitter=new E.A.Events,n.isLoad=!1,n.source=[],n.el=null,n.canvasEl=null,n.ctx=null,n.map=e,n.config=cn({},o),n}return ln(e,t),e.prototype.initCanvas=function(){this.el=this.canvas.parentElement,this.canvasEl=this.canvas,this.el.style.width="".concat(this.canvasEl.width,"px"),this.el.style.height="".concat(this.canvasEl.height,"px"),this.canvasEl.className="".concat("adhere-ui-trajectoryplaybacklayer"),this.ctx=this.canvasEl.getContext("2d"),this.emitter.trigger(Be.CanvasMount)},e.prototype.firstLoad=function(){this.initCanvas()},e.prototype.update=function(){var t=this.canvas.getContext("2d");t&&(this.isLoad||this.firstLoad(),this.isLoad=!0,t.clearRect(0,0,t.canvas.width,t.canvas.height),this.drawHistory())},e.prototype.getMap=function(){return this.map},e.prototype.getCtx=function(){return this.ctx},e.prototype.getCanvasEl=function(){return this.canvasEl},e.prototype.getEmitter=function(){return this.emitter},e.prototype.pixelToPoint=function(t){return{x:(t=this.map.pixelToPoint(t)).lng,y:t.lat}},e.prototype.pointToPixel=function(t){return this.map.pointToPixel(new BMap.Point(t.x,t.y))},e.prototype.distanceToActual=function(t){return t/_.default.getScale(this.map)},e.prototype.actualToDistance=function(t){return _.default.getScale(this.map)*t},e.prototype.addTrajectory=function(t){this.hasTrajectoryById(t.getId())||(this.source.push(t),t.init())},e.prototype.removeTrajectory=function(t){this.removeTrajectoryById(t.getId())},e.prototype.removeTrajectoryById=function(t){var e=this.source.findIndex((function(e){return e.getId()===t}));-1!==e&&(this.source[e].destroy(),this.source.splice(e,1))},e.prototype.clean=function(){this.source.forEach((function(t){return t.destroy()})),this.source=[]},e.prototype.getTrajectoryById=function(t){return this.source.find((function(e){return e.getId()===t}))},e.prototype.getTrajectorys=function(){return un([],this.source,!0)},e.prototype.hasTrajectoryById=function(t){return!!this.getTrajectoryById(t)},e.prototype.clear=function(){var t=this.getCtx(),e=this.getCanvasEl();t&&e&&t.clearRect(0,0,e.width,e.height)},e.prototype.drawHistory=function(){this.source.filter((function(t){return t.getStatus()!==f.Destroy})).forEach((function(t){t.drawHistory()}))},e}(BMap.CanvasLayer);const yn=pn}}]);