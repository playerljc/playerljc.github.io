"use strict";(self.webpackChunk_ctsj_build=self.webpackChunk_ctsj_build||[]).push([[6343,9881],{63027:function(t,e,n){n.r(e);var o=n(33240),i=function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};e.default={flyToChina:function(t){t.centerAndZoom(new BMap.Point(106.638754,34.842904),2)},fillCityBoundary:function(t,e,n){var o=[],r=[];return new Promise((function(a){(new BMap.Boundary).get(t,(function(t){for(var s=0;s<t.boundaries.length;s++){var l=((l=t.boundaries[s]).split(";").forEach((function(t){t=t.trim().split(","),r.push(new BMap.Point(parseFloat(t[0].trim()),parseFloat(t[1].trim())))})),new BMap.Polygon(l,i({},e)));o.push(l),n.addOverlay(l)}a({cityOverlays:o,cityPoints:r})}))}))},fit:function(t,e,n){return new Promise((function(o){var i=t.getViewport(e,null!=n?n:{});t.centerAndZoom(i.center,i.zoom),setTimeout((function(){o(null)}),200)}))},pixelToPoint:function(t,e){return t.pixelToPoint(e)},pointToPixel:function(t,e){return t.pointToPixel(e)},getBound:function(t){var e=(t=t.getBounds()).getSouthWest();t=t.getNorthEast();return{leftTopLon:e.lng,leftTopLat:t.lat,rightBottomLon:t.lng,rightBottomLat:e.lat}},getScale:function(t){var e=t.getCenter(),n=t.pointToPixel(e),o=new BMap.Point(e.lng,e.lat+.001),i=t.pointToPixel(o);return((i=Math.abs(i.y-n.y))<=0?1:i)/t.getDistance(e,o)},getUnitPixelToM:function(t){return Math.pow(2,18-t)},getArrowPoints:function(t){var e=t.from,n=t.to,o=void 0===(o=t.scale)?1:o,i=void 0===(i=t.width)?5:i,r=(t=void 0===(t=t.theta)?35:t,e.x),a=(e=e.y,n.x);n=n.y,r=((e=180*Math.atan2(e-n,r-a)/Math.PI)+t)*Math.PI/180,e=(e-t)*Math.PI/180;return{A:{x:(t=a+i*Math.cos(r))*o,y:(r=n+i*Math.sin(r))*o},B:{x:a*o,y:n*o},C:{x:(a+i*Math.cos(e))*o,y:(n+i*Math.sin(e))*o}}},clientToCtxPointToEl:function(t){var e=t.event,n=t.rect,o=(t=t.offsetEl,(t="undefined"!=typeof window?window.getComputedStyle(t,null):{left:"0",top:"0"}).left);t=t.top,o=parseInt(o.replace("px","")),t=parseInt(t.replace("px",""));return this.clientToCtxPoint({event:e,rect:n,offsetLeft:o,offsetTop:t})},clientToCtxPoint:function(t){var e=t.event,n=t.rect,i=t.offsetLeft;t=t.offsetTop;return(e=o.Z.clientToCtxPoint({event:e,rect:n})).x-=i,e.y-=t,e}}},66343:function(t,e,n){n.r(e),n.d(e,{Feature:function(){return O},Format:function(){return i},Geom:function(){return r},ImageCache:function(){return E},InnerTextFeature:function(){return _},Interaction:function(){return s},Styles:function(){return l},Trajectory:function(){return c},Types:function(){return o},VectorLayer:function(){return Y},VectorSource:function(){return ne}});var o={};n.r(o),n.d(o,{GeoJSONType:function(){return h},GeometryType:function(){return u},TrajectoryStatus:function(){return d},VectorActions:function(){return y},VectorEventActions:function(){return p}});var i={};n.r(i),n.d(i,{GeoJSONFormat:function(){return qt}});var r={};n.r(r),n.d(r,{CircleGeometry:function(){return ut},Geometry:function(){return V},LeafGeometry:function(){return dt},LineStringGeometry:function(){return tt},MulitCircleGeometry:function(){return se},MulitLeafGeometry:function(){return pe},MulitLineStringGeometry:function(){return at},MulitPointGeometry:function(){return Wt},MulitPolygonGeometry:function(){return Kt},MulitRadiusRectGeometry:function(){return ve},MulitRectGeometry:function(){return fe},MulitRegularPolygonGeometry:function(){return me},MulitSectorGeometry:function(){return Se},MulitStartGeometry:function(){return Le},PointGeometry:function(){return _t},PolygonGeometry:function(){return Jt},RadiusRectGeometry:function(){return mt},RectGeometry:function(){return vt},RegularPolygonGeometry:function(){return St},SectorGeometry:function(){return Lt},StartGeometry:function(){return zt},TextGeometry:function(){return ze}});var a={};n.r(a),n.d(a,{ActionEvents:function(){return P},ActionStatus:function(){return m},ActionType:function(){return S},InteractionLayerActions:function(){return w},SelectType:function(){return D}});var s={};n.r(s),n.d(s,{CircleDrawAction:function(){return Ye},CircleModifyAction:function(){return bn},DefaultAnchorStyle:function(){return Be},DefaultMoveGemStyle:function(){return Re},DefaultStyle:function(){return Ne},DiamondDrawAction:function(){return Ve},DiamondModifyAction:function(){return Nn},DistanceDrawAction:function(){return sn},DrawAction:function(){return We},FreeDrawAction:function(){return un},InteractionLayer:function(){return Sn},ModifyAction:function(){return jn},PolygonDrawAction:function(){return en},PolygonModifyAction:function(){return Wn},RectangleDrawAction:function(){return hn},RectangleModifyAction:function(){return Fn},StartDrawAction:function(){return gn},StartModifyAction:function(){return Xn},TriangleDrawAction:function(){return Tn},TriangleModifyAction:function(){return eo},Types:function(){return a},Util:function(){return Fe}});var l={};n.r(l),n.d(l,{AnchorStyle:function(){return no},DistancePointStyle:function(){return Ke},GeometryStyle:function(){return g},MoveGeomStyle:function(){return oo},TextStyle:function(){return b}});var c={};n.r(c),n.d(c,{Trajectory:function(){return ao},TrajectoryPlayBackLayer:function(){return po}});var u,p,y,h,d,f,g={fillStyle:"rgb(91,155,213,1)",strokeStyle:"rgba(0,0,0,.8)",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[],lineDashOffset:-1,globalAlpha:1};(f=u=u||{}).Point="Point",f.MulitPoint="MulitPoint",f.Circle="Circle",f.MulitCircle="MulitCircle",f.LineString="LineString",f.MulitLineString="MulitLineString",f.Polygon="Polygon",f.MulitPolygon="MulitPolygon",f.Rect="Rect",f.RadiusRect="RadiusRect",f.MulitRadiusRect="MulitRadiusRect",f.Leaf="Leaf",f.MulitLeaf="MulitLeaf",f.MulitRect="MulitRect",f.Text="Text",f.RegularPolygon="RegularPolygon",f.MulitRegularPolygon="MulitRegularPolygon",f.Start="Start",f.MulitStart="MulitStart",f.Sector="Sector",f.MulitSector="MulitSector",function(t){t.FEATURE_CLICK="feature:click",t.VECTOR_CLICK="vector:click"}(p=p||{}),function(t){t.UPDATE="UPDATE",t.APPEND="APPEND"}(y=y||{}),function(t){t.Point="Point",t.MultiPoint="MultiPoint",t.LineString="LineString",t.MultiLineString="MultiLineString",t.Polygon="Polygon",t.MultiPolygon="MultiPolygon",t.GeometryCollection="GeometryCollection",t.Feature="Feature",t.FeatureCollection="FeatureCollection"}(h=h||{}),function(t){t[t.UnInit=0]="UnInit",t[t.Init=1]="Init",t[t.Running=2]="Running",t[t.Pause=3]="Pause",t[t.End=4]="End",t[t.Destroy=5]="Destroy"}(d=d||{});var x,v,M,T,C,m,P,w,D,S,I=function(){function t(t){this.name="",this.id="",this.style=g,this.zIndex=1,this.properties={},this.name=null==t?void 0:t.name,this.id=null==t?void 0:t.id,this.properties=null==t?void 0:t.properties,this.style=null==t?void 0:t.style,this.geometry=null==t?void 0:t.geometry,this.setGeometryContext()}return t.prototype.setGeometryContext=function(){this.geometry&&this.geometry.setContext(this)},t.prototype.draw=function(t){this.geometry.draw(t,this.style)},t.prototype.getGeometry=function(){return this.geometry},t.prototype.getId=function(){return this.id},t.prototype.getName=function(){return this.name},t.prototype.getStyle=function(){return this.style},t.prototype.getZIndex=function(){return this.zIndex},t.prototype.getProperties=function(){return this.properties},t.prototype.setGeometry=function(t){this.geometry=t,this.setGeometryContext(),null!=(t=null==(t=this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},t.prototype.setStyle=function(t){this.style=t,null!=(t=null==(t=this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},t.prototype.setId=function(t){this.id=t},t.prototype.setName=function(t){this.name=t},t.prototype.setZIndex=function(t){this.zIndex=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},t.prototype.setProperties=function(t){this.properties=t},t.prototype.getContext=function(){return this.context},t.prototype.setContext=function(t){this.context=t},t.prototype.getLayer=function(){var t;return null==(t=null==this?void 0:this.getContext())?void 0:t.getContext()},t.prototype.getMap=function(){var t;return null==(t=null==this?void 0:this.getLayer())?void 0:t.getMap()},t.prototype.isPointInFeature=function(t,e){return this.geometry.isPixelInGeometry(t,e)},t}(),O=I,j=new Map,L={add:function(t,e){return j.set(JSON.stringify(t),e)},get:function(t){return j.get(JSON.stringify(t))},delete:function(t){return j.delete(JSON.stringify(t))},clear:function(){j.clear()},values:function(){return Array.from(j.values())},keys:function(){return Array.from(j.keys()).map((function(t){return JSON.parse(t)}))}},E=L,A=function(){return(A=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},b=A({font:"10px sans-serif",textAlign:"start",textBaseline:"middle",direction:"inherit"},g),z=(x=function(t,e){return(x=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),B=function(){return(B=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},R=function(t,e){var n={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,i=Object.getOwnPropertySymbols(t);o<i.length;o++)e.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(n[i[o]]=t[i[o]]);return n},N=function(t){function e(e){var n=this,o=(e.text,e.textStyle,R(e,["text","textStyle"]));return(n=t.call(this,o)||this).text=e.text,n.textStyle=e.textStyle,n}return z(e,t),e.prototype.getText=function(){return this.text},e.prototype.getTextStyle=function(){return this.textStyle},e.prototype.setText=function(t){this.text=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},e.prototype.setTextStyle=function(t){this.textStyle=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},e.prototype.draw=function(e){t.prototype.draw.call(this,e),this.geometry.drawText({ctx:e,text:this.text,style:this.style,textStyle:this.textStyle||B({},b)})},e}(O),_=N,k=n(33240),G=n(77646),Z=(v=function(t,e){return(v=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),W=function(){return(W=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},H=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},U=function(t){function e(e,n){var o=this;return o.update=o.update.bind(o),(o=t.call(this,{update:o.update,paneName:n.paneName,zIndex:n.zIndex})||this).isLoad=!1,o.emitter=new G.Z.Events,o.map=e,o.config=W({},n),o.source=n.source,o.source&&o.source.setContext(o),o.onUpdate=o.onUpdate.bind(o),o.initEvents(),o}return Z(e,t),e.prototype.getSource=function(){return this.source},e.prototype.getZIndex=function(){return this.config.zIndex},e.prototype.setSource=function(t){this.source=t,this.source&&this.source.setContext(this),this.update()},e.prototype.drawSource=function(){var t=this.source.getFeatures(),e=(t.sort((function(t,e){return t.getZIndex()>e.getZIndex()?1:t.getZIndex()<e.getZIndex()?-1:0})),this.canvas.getContext("2d"));e&&(t||[]).forEach((function(t){t.draw(e)}))},e.prototype.firstLoad=function(){this.initCanvasEvents()},e.prototype.update=function(){var t=this.canvas.getContext("2d");t&&(this.isLoad||this.firstLoad(),this.isLoad=!0,t.clearRect(0,0,t.canvas.width,t.canvas.height),this.drawSource())},e.prototype.getMap=function(){return this.map},e.prototype.getEmitter=function(){return this.emitter},e.prototype.addEventListener=function(t,e){this.emitter.on(t,e)},e.prototype.removeEventListener=function(t,e){this.emitter.remove(t,e)},e.prototype.initCanvasEvents=function(){var t=this;this.canvas.addEventListener("click",(function(e){var n=k.Z.clientToCtxPoint({event:e,rect:t.canvas.getBoundingClientRect()});(e=t.source.getFeatures().filter((function(t){return t.isPointInFeature(n,t.getStyle())}))).length?t.emitter.trigger(p.FEATURE_CLICK,{features:H([],e,!0),pixel:n}):t.emitter.trigger(p.VECTOR_CLICK)}))},e.prototype.initEvents=function(){this.emitter.on(y.UPDATE,this.onUpdate)},e.prototype.onUpdate=function(){this.update()},e}(BMap.CanvasLayer),Y=U,F=n(63027),J=function(){return(J=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Q=function(){function t(){this.context=null}return t.prototype.setContext=function(t){this.context=t},t.prototype.getContext=function(){return this.context},t.prototype.drawText=function(t){var e=t.ctx,n=t.text,o=t.style;t=t.textStyle,e.beginPath(),e.save(),t=J(J({},b),null!=t?t:{}),e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.direction=t.direction,e.strokeStyle=t.strokeStyle,e.fillStyle=t.fillStyle,t=J(J({},g),null!=o?o:{}),e.lineWidth=t.lineWidth,e.lineJoin=t.lineJoin,e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.strokeStyle=t.strokeStyle,t=this.getCenterCoordinate({ctx:e,style:o,isScale:!0});e.fillText(n||"",t.x,t.y),e.restore()},t.prototype.getMap=function(){var t;return null==(t=null==this?void 0:this.getLayer())?void 0:t.getMap()},t.prototype.getLayer=function(){var t=this.getContext();return t?t.getContext().getContext():null},t}(),V=Q,X=(M=function(t,e){return(M=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}M(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),K=function(){return(K=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},q=new Map([["small",3],["normal",10],["large",20]]),$=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return X(e,t),e.drawStartArrow=function(t){var e=t.ctx,n=t.style,o=t.coordinates,i=(t=t.map,e.save(),e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,t.pointToPixel(new BMap.Point(o.point1.lng,o.point1.lat)));t=t.pointToPixel(new BMap.Point(o.point2.lng,o.point2.lat)),t=(o=F.default.getArrowPoints({from:t,to:i,scale:1,width:q.get(n.arrow.size)})).A,i=o.B,n=o.C;e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(n.x,n.y),e.closePath(),e.stroke(),e.fill(),e.restore()},e.drawEndArrow=function(t){var e=t.ctx,n=t.style,o=t.coordinates,i=(t=t.map,e.save(),e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,t.pointToPixel(new BMap.Point(o.point1.lng,o.point1.lat)));t=t.pointToPixel(new BMap.Point(o.point2.lng,o.point2.lat)),i=(o=F.default.getArrowPoints({from:i,to:t,scale:1,width:q.get(n.arrow.size)})).A,t=o.B,n=o.C;e.moveTo(i.x,i.y),e.lineTo(t.x,t.y),e.lineTo(n.x,n.y),e.closePath(),e.stroke(),e.fill(),e.restore()},e.drawLineString=function(t){var n=t.ctx,o=t.style,i=t.coordinates,r=(t=t.map,n.save(),K(K(K({},g),null!=o?o:{}),{arrow:{draw:!1,direction:"end",type:"normal",size:"normal"}})),a=(n.beginPath(),n.lineWidth=r.lineWidth,n.lineJoin=r.lineJoin,n.lineCap=r.lineCap,n.setLineDash(r.lineDash),n.lineDashOffset=r.lineDashOffset,n.strokeStyle=r.strokeStyle,i.point1),s=i.point2;a=t.pointToPixel(new BMap.Point(a.lng,a.lat)),s=t.pointToPixel(new BMap.Point(s.lng,s.lat));n.moveTo(a.x,a.y),n.lineTo(s.x,s.y),n.stroke(),n.restore(),o.arrow.draw&&("start"===o.arrow.direction?e.drawStartArrow({ctx:n,style:r,coordinates:i,map:t}):"end"===o.arrow.direction?e.drawEndArrow({ctx:n,style:r,coordinates:i,map:t}):"bothEnds"===o.arrow.direction&&(e.drawStartArrow({ctx:n,style:r,coordinates:i,map:t}),e.drawEndArrow({ctx:n,style:r,coordinates:i,map:t})))},e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return K({},this.coordinates)},e.prototype.getType=function(){return u.LineString},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map;t.style,t.isScale,t=e.point1,e=e.point2,t=n.pointToPixel(new BMap.Point(t.lng,t.lat)),n=n.pointToPixel(new BMap.Point(e.lng,e.lat));return k.Z.midpoint(t,n)},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({ctx:n,coordinates:this.coordinates,map:this.getMap(),style:o,isScale:t})},e.prototype.draw=function(t,n){e.drawLineString({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap()})},e.prototype.drawText=function(t){var e=t.ctx,n=t.text,o=t.style,i=(t=t.textStyle,e.save(),e.beginPath(),this.getMap()),r=this.getCenterCoordinate({ctx:e,style:o,isScale:!0}),a=(r=(e.translate(r.x,r.y),this.coordinates)).point1;r=r.point2,a=i.pointToPixel(new BMap.Point(a.lng,a.lat)),i=i.pointToPixel(new BMap.Point(r.lng,r.lat)),r=k.Z.slopToRadian(a,i),e.rotate(r),a=K(K({},b),null!=t?t:{}),e.font=a.font,e.textAlign=a.textAlign,e.textBaseline=a.textBaseline,e.direction=a.direction,e.strokeStyle=a.strokeStyle,e.fillStyle=a.fillStyle,i=K(K({},g),null!=o?o:{});e.lineWidth=i.lineWidth,e.lineJoin=i.lineJoin,e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.strokeStyle=i.strokeStyle,e.fillText(n||"",0,0),e.restore()},e.isPixelInGeometry=function(t){var e=t.pixel,n=(t.style,t.coordinates),o=(t=t.map,document.createElement("canvas").getContext("2d"));if(!o)return!1;o.beginPath();var i=n.point1;n=n.point2,i=t.pointToPixel(new BMap.Point(i.lng,i.lat)),t=t.pointToPixel(new BMap.Point(n.lng,n.lat));return o.moveTo(i.x,i.y),o.lineTo(t.x,t.y),o.isPointInPath(e.x,e.y)},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({pixel:t,style:n,coordinates:this.coordinates,map:this.getMap()})},e}(V),tt=$,et=n(17234),nt=(T=function(t,e){return(T=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ot=function(){return(ot=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},it=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},rt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return nt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return it([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitLineString},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap(),n=[];t.forEach((function(t){var o=e.pointToPixel(new BMap.Point(t.point1.lng,t.point1.lat));t=e.pointToPixel(new BMap.Point(t.point2.lng,t.point2.lat));n.push(et.xmu([o.x,o.y])),n.push(et.xmu([t.x,t.y]))})),t=et.uf4(n);return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this,o=this.coordinates,i=ot(ot(ot({},g),null!=e?e:{}),{arrow:{draw:!1,direction:"end",type:"normal",size:"normal"}});o.forEach((function(e){tt.drawLineString({ctx:t,style:i,coordinates:e,map:n.getMap()})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return tt.isPixelInGeometry({pixel:t,style:e,coordinates:o,map:n.getMap()})}))},e}(V),at=rt,st=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),lt=function(){return(lt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ct=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return st(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return lt({},this.coordinates)},e.prototype.getType=function(){return u.Circle},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map;t.style,t.isScale,t=n.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return lt({},t)},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:t})},e.drawCircle=function(t){var e=t.ctx,n=t.style,o=t.coordinates,i=t.map;t=t.isScale,e.save(),e.beginPath(),n=lt(lt({},g),null!=n?n:{}),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,n=o.center,o=o.radius,n=i.pointToPixel(new BMap.Point(n.lng,n.lat)),i=F.default.getScale(i),t=t?i*o:o;e.ellipse(n.x,n.y,t,t,45*Math.PI/180,0,2*Math.PI),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawCircle({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var n=t.coordinates,o=t.map,i=t.style,r=t.pixel,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawCircle({ctx:a,coordinates:n,style:i,map:o,isScale:t}),a.isPointInPath(r.x,r.y))},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:n,pixel:t,isScale:!0})},e}(V),ut=ct,pt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),yt=function(){return(yt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},ht=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return pt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return yt({},this.coordinates)},e.prototype.getType=function(){return u.Leaf},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map;t.style,t.isScale,t=n.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return yt({},t)},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:t})},e.drawLeaf=function(t){for(var e=t.ctx,n=t.style,o=t.coordinates,i=t.map,r=(t=t.isScale,n=(e.save(),yt(yt({},g),null!=n?n:{})),e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,o.n),a=(n=o.center,o.size),s=a,l=o=o.length,c=(t&&(s=(t=F.default.getScale(i))*a,l=t*o),i.pointToPixel(new BMap.Point(n.lng,n.lat))),u=(e.moveTo(c.x,c.y+s),2*Math.PI/r),p=1;p<r+1;p++){var y=Math.sin((p-1)*u)*l+c.x,h=Math.cos((p-1)*u)*l+c.y,d=Math.sin(p*u)*l+c.x,f=Math.cos(p*u)*l+c.y,x=Math.sin(p*u)*s+c.x,v=Math.cos(p*u)*s+c.y;e.bezierCurveTo(y,h,d,f,x,v)}e.closePath(),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawLeaf({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var n=t.coordinates,o=t.map,i=t.pixel,r=t.style,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawLeaf({ctx:a,coordinates:n,style:r,map:o,isScale:t}),a.isPointInPath(i.x,i.y))},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:n,isScale:!0,pixel:t})},e}(V),dt=ht,ft=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),gt=function(){return(gt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},xt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return ft(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return gt({},this.coordinates)},e.prototype.getType=function(){return u.Rect},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map,o=(t=(t.style,t.isScale),e.leftTop),i=e.width,r=(e=e.height,o=n.pointToPixel(new BMap.Point(o.lng,o.lat)),n=F.default.getScale(n),i),a=e;t&&(r=n*i,a=n*e),t=et.uf4([et.xmu([o.x,o.y]),et.xmu([o.x+r,o.y]),et.xmu([o.x+r,o.y+a]),et.xmu([o.x,o.y+a])]);return{x:(i=et.beQ(t)).geometry.coordinates[0],y:i.geometry.coordinates[1]}},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:t})},e.drawRect=function(t){var e=t.ctx,n=t.style,o=t.coordinates,i=t.map,r=(t=t.isScale,n=(e.save(),gt(gt({},g),null!=n?n:{})),n=(e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,o.leftTop),o.width),a=(o=o.height,n=i.pointToPixel(new BMap.Point(n.lng,n.lat)),i=F.default.getScale(i),r),s=o;t&&(a=i*r,s=i*o),e.rect(n.x,n.y,a,s),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawRect({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var n=t.coordinates,o=t.map,i=t.style,r=t.pixel,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawRect({ctx:a,coordinates:n,style:i,map:o,isScale:t}),a.isPointInPath(r.x,r.y))},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:n,isScale:!0,pixel:t})},e}(V),vt=xt,Mt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Tt=function(){return(Tt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Ct=function(t){function e(e){var n=t.call(this,e)||this;return n.coordinates=e,n}return Mt(e,t),e.prototype.getType=function(){return u.RadiusRect},e.drawRadiusRect=function(t){var e=t.ctx,n=t.style,o=t.coordinates,i=t.map,r=(t=t.isScale,n=Tt(Tt({},g),null!=n?n:{}),n=(e.save(),e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,o.leftTop),o.width),a=o.height,s=(o=o.radius,n=i.pointToPixel(new BMap.Point(n.lng,n.lat)),i=F.default.getScale(i),r),l=a,c=o;t&&(s=i*r,l=i*a,c=i*o),e.moveTo(n.x,n.y+c),e.arcTo(n.x,n.y,n.x+c,n.y,c),e.lineTo(n.x+s-c,n.y),t={x:n.x+s-c,y:n.y},e.arcTo(t.x+c,n.y,t.x+c,n.y+c,c),t={x:t.x+c,y:n.y+c},e.lineTo(t.x,t.y+(l-2*c)),e.arcTo((t={x:t.x,y:t.y+(l-2*c)}).x,t.y+c,t.x-c,t.y+c,c),e.lineTo((t={x:t.x-c,y:t.y+c}).x-(s-2*c),t.y),e.arcTo((t={x:t.x-(s-2*c),y:t.y}).x-c,t.y,t.x-c,t.y-c,c),e.lineTo((t={x:t.x-c,y:t.y-c}).x,t.y-(l-2*c)),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawRadiusRect({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e}(vt),mt=Ct,Pt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),wt=function(){return(wt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Dt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Pt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return wt({},this.coordinates)},e.prototype.getType=function(){return u.RegularPolygon},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map;t.style,t.isScale,t=n.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return wt({},t)},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:t})},e.drawRegularPolygon=function(t){for(var e=t.ctx,n=t.style,o=t.coordinates,i=t.map,r=(t=t.isScale,n=(e.save(),wt(wt({},g),null!=n?n:{})),e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,o.n),a=(n=o.center,o=o.size),s=(t&&(a=F.default.getScale(i)*o),i.pointToPixel(new BMap.Point(n.lng,n.lat))),l=2*Math.PI/r,c=0;c<r;c++){var u=Math.cos(c*l),p=Math.sin(c*l);e.lineTo(u*a+s.x,p*a+s.y)}e.closePath(),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawRegularPolygon({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var n=t.coordinates,o=t.map,i=t.pixel,r=t.style,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawRegularPolygon({ctx:a,coordinates:n,style:r,map:o,isScale:t}),a.isPointInPath(i.x,i.y))},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:n,isScale:!0,pixel:t})},e}(V),St=Dt,It=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ot=function(){return(Ot=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},jt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return It(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Ot({},this.coordinates)},e.prototype.getType=function(){return u.Sector},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map;t.style,t.isScale,t=n.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return Ot({},t)},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:t})},e.drawSector=function(t){var e=t.ctx,n=t.style,o=t.coordinates,i=t.map,r=(t=t.isScale,n=(e.save(),Ot(Ot({},g),null!=n?n:{})),n=(e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,o.center),o.radius),a=o.angle1,s=(o=o.angle2,r);t&&(s=F.default.getScale(i)*r),t=i.pointToPixel(new BMap.Point(n.lng,n.lat));e.moveTo(t.x,t.y),e.arc(t.x,t.y,s,a*Math.PI/180,o*Math.PI/180,!1),e.closePath(),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawSector({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var n=t.coordinates,o=t.map,i=t.style,r=t.pixel,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawSector({ctx:a,coordinates:n,style:i,map:o,isScale:t}),a.isPointInPath(r.x,r.y))},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),style:n,pixel:t,isScale:!0})},e}(V),Lt=jt,Et=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),At=function(){return(At=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},bt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Et(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return At({},this.coordinates)},e.prototype.getType=function(){return u.Start},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map;t.style,t.isScale,t=n.pointToPixel(new BMap.Point(e.center.lng,e.center.lat));return At({},t)},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:t})},e.drawStart=function(t){for(var e=t.ctx,n=t.style,o=t.coordinates,i=t.map,r=(t=t.isScale,n=(e.save(),At(At({},g),null!=n?n:{})),n=(e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle,o.center),o.innerRadius),a=r,s=o=o.outRadius,l=(t&&(a=(t=F.default.getScale(i))*r,s=t*o),i.pointToPixel(new BMap.Point(n.lng,n.lat))),c=0;c<5;c++)e.lineTo(Math.cos((18+72*c)/180*Math.PI)*s+l.x,-Math.sin((18+72*c)/180*Math.PI)*s+l.y),e.lineTo(Math.cos((54+72*c)/180*Math.PI)*a+l.x,-Math.sin((54+72*c)/180*Math.PI)*a+l.y);e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawStart({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap(),isScale:!0})},e.isPixelInGeometry=function(t){var n=t.coordinates,o=t.map,i=t.pixel,r=t.style,a=(t=t.isScale,document.createElement("canvas").getContext("2d"));return!!a&&(e.drawStart({ctx:a,coordinates:n,style:r,map:o,isScale:t}),a.isPointInPath(i.x,i.y))},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({coordinates:this.coordinates,map:this.getMap(),isScale:!0,style:n,pixel:t})},e}(V),zt=bt,Bt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Rt=function(){return(Rt=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Nt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Bt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Rt({},this.coordinates)},e.prototype.getType=function(){return u.Point},e.getCenterCoordinate=function(t){var n=t.ctx,o=t.coordinates,i=t.map,r=t.style;t=t.isScale;return e.centerCoordinateMapping.get(r.pointType)({ctx:n,coordinates:o,map:i,style:r,isScale:t})},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;return t.isScale,e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:!1})},e.drawCirclePoint=function(t){var e=t.ctx,n=t.style,o=t.coordinates;t=t.map;ut.drawCircle({ctx:e,style:n,coordinates:{radius:n.radius,center:o},map:t,isScale:!1})},e.drawImagePoint=function(t){var e,n=t.ctx,o=t.style,i=t.coordinates,r=t.map.pointToPixel(new BMap.Point(i.lng,i.lat));(i=E.get({src:(null==(t=null==o?void 0:o.img)?void 0:t.src)||"",width:(null==(i=null==o?void 0:o.img)?void 0:i.width)||0,height:(null==(t=null==o?void 0:o.img)?void 0:t.height)||0}))?n.drawImage(i,r.x,r.y,o.img.width,o.img.height):((e=new Image(o.img.width,o.img.height)).onload=function(){var t;E.add({src:(null==(t=null==o?void 0:o.img)?void 0:t.src)||"",width:(null==(t=null==o?void 0:o.img)?void 0:t.width)||0,height:(null==(t=null==o?void 0:o.img)?void 0:t.height)||0},e),n.drawImage(e,r.x,r.y,o.img.width,o.img.height)},e.src=o.img.src)},e.drawRegularPolygon=function(t){var e=t.ctx,n=t.style,o=t.coordinates;t=t.map;St.drawRegularPolygon({ctx:e,style:n,coordinates:Rt(Rt({},n.regularPolygon),{center:o}),map:t,isScale:!1})},e.drawStart=function(t){var e=t.ctx,n=t.style,o=t.coordinates;t=t.map;zt.drawStart({ctx:e,style:n,coordinates:Rt(Rt({},n.start),{center:o}),map:t,isScale:!1})},e.drawSector=function(t){var e=t.ctx,n=t.style,o=t.coordinates;t=t.map;Lt.drawSector({ctx:e,style:n,coordinates:Rt(Rt({},n.sector),{center:o}),map:t,isScale:!1})},e.drawRect=function(t){var e=t.ctx,n=t.style,o=t.coordinates;t=t.map;vt.drawRect({ctx:e,style:n,coordinates:Rt(Rt({},n.rect),{leftTop:o}),map:t,isScale:!1})},e.drawRadiusRect=function(t){var e=t.ctx,n=t.style,o=t.coordinates;t=t.map;mt.drawRadiusRect({ctx:e,style:n,coordinates:Rt(Rt({},n.radiusRect),{leftTop:o}),map:t,isScale:!1})},e.drawLeaf=function(t){var e=t.ctx,n=t.style,o=t.coordinates;t=t.map;dt.drawLeaf({ctx:e,style:n,coordinates:Rt(Rt({},n.leaf),{center:o}),map:t,isScale:!1})},e.drawPoint=function(t){var n=t.ctx,o=t.style,i=t.coordinates;t=t.map,o=Rt(Rt(Rt({},g),{radius:5,pointType:"circle"}),null!=o?o:{});e.drawMapping.get(null==o?void 0:o.pointType)({ctx:n,style:o,coordinates:i,map:t})},e.prototype.draw=function(t,n){e.drawPoint({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap()})},e.isPixelInGeometry=function(t){var n=t.coordinates,o=t.map,i=t.pixel;t=t.style;return e.isPixelInGeometryMapping.get(null==t?void 0:t.pointType)({coordinates:e.pointTypeToCoordinatesMapping.get(null==t?void 0:t.pointType)(n,t),isScale:!1,map:o,style:t,pixel:i})},e.prototype.isPixelInGeometry=function(t,n){return e.isPixelInGeometry({coordinates:this.coordinates,pixel:t,map:this.getMap(),style:n})},e.drawMapping=new Map([["circle",e.drawCirclePoint],["image",e.drawImagePoint],["regularPolygon",e.drawRegularPolygon],["start",e.drawStart],["sector",e.drawSector],["rect",e.drawRect],["radiusRect",e.drawRadiusRect],["leaf",e.drawLeaf]]),e.isPixelInGeometryMapping=new Map([["circle",ut.isPixelInGeometry],["image",vt.isPixelInGeometry],["regularPolygon",St.isPixelInGeometry],["start",zt.isPixelInGeometry],["sector",Lt.isPixelInGeometry],["rect",vt.isPixelInGeometry],["radiusRect",mt.isPixelInGeometry],["leaf",dt.isPixelInGeometry]]),e.centerCoordinateMapping=new Map([["circle",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return ut.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:{center:n,radius:i.radius}})}],["image",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return vt.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:Rt({leftTop:n},i.img)})}],["regularPolygon",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return St.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:Rt({center:n},i.regularPolygon)})}],["start",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return zt.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:Rt({center:n},i.start)})}],["sector",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return Lt.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:Rt({center:n},i.sector)})}],["rect",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return vt.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:Rt({leftTop:n},i.rect)})}],["radiusRect",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return mt.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:Rt({leftTop:n},i.radiusRect)})}],["leaf",function(t){var e=t.ctx,n=t.coordinates,o=t.map,i=t.style;t=t.isScale;return dt.getCenterCoordinate({ctx:e,map:o,style:i,isScale:t,coordinates:Rt({center:n},i.leaf)})}]]),e.pointTypeToCoordinatesMapping=new Map([["circle",function(t,e){return{center:t,radius:e.radius}}],["image",function(t,e){return{leftTop:t,width:e.img.width,height:e.img.height}}],["regularPolygon",function(t,e){return Rt({center:t},e.regularPolygon)}],["start",function(t,e){return Rt({center:t},e.start)}],["sector",function(t,e){return Rt({center:t},e.sector)}],["rect",function(t,e){return Rt({leftTop:t},e.rect)}],["radiusRect",function(t,e){return Rt({leftTop:t},e.radiusRect)}],["leaf",function(t,e){return Rt({center:t},e.leaf)}]]),e}(V),_t=Nt,kt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Gt=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Zt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return kt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Gt([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitPoint},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap();t=et.uf4(t.map((function(t){return t=e.pointToPixel(new BMap.Point(t.lng,t.lat)),et.xmu([t.x,t.y])})));return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){_t.drawPoint({ctx:t,style:e,coordinates:n,map:o})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return _t.isPixelInGeometry({coordinates:o,map:n.getMap(),pixel:t,style:e})}))},e}(V),Wt=Zt,Ht=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ut=function(){return(Ut=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Yt=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Ft=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Ht(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Yt([],this.coordinates,!0)},e.prototype.getType=function(){return u.Polygon},e.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map;t.style,t.isScale,t=et.yue([e.map((function(t){return[(t=n.pointToPixel(new BMap.Point(t.lng,t.lat))).x,t.y]}))]);return{x:(e=et.MqI(t)).geometry.coordinates[0],y:e.geometry.coordinates[1]}},e.prototype.getCenterCoordinate=function(t){var n=t.ctx,o=t.style;t=t.isScale;return e.getCenterCoordinate({coordinates:this.coordinates,ctx:n,map:this.getMap(),style:o,isScale:t})},e.drawPolygon=function(t){var e=t.ctx,n=t.style,o=t.coordinates,i=t.map;e.save(),t=Ut(Ut({},g),null!=n?n:{});e.beginPath(),e.lineWidth=t.lineWidth,e.lineJoin=t.lineJoin,e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.strokeStyle=t.strokeStyle,e.fillStyle=t.fillStyle,o.forEach((function(t,n){t=i.pointToPixel(new BMap.Point(t.lng,t.lat)),0===n?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.stroke(),e.fill(),e.restore()},e.prototype.draw=function(t,n){e.drawPolygon({ctx:t,style:n,coordinates:this.coordinates,map:this.getMap()})},e.isPixelInGeometry=function(t){var e=t.coordinates,n=t.map;t=t.pixel,t=et.xmu([t.x,t.y]),e=et.yue([e.map((function(t){return[(t=n.pointToPixel(new BMap.Point(t.lng,t.lat))).x,t.y]}))]);return et.FWy(t,e)},e.prototype.isPixelInGeometry=function(t){return e.isPixelInGeometry({coordinates:this.coordinates,pixel:t,map:this.getMap()})},e}(V),Jt=Ft,Qt=(C=function(t,e){return(C=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Vt=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Xt=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Qt(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Vt([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitPolygon},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap();t=t.map((function(t){return t.map((function(t){return[(t=e.pointToPixel(new BMap.Point(t.lng,t.lat))).x,t.y]}))})),t=et.yue(t);return{x:(t=et.MqI(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){Jt.drawPolygon({ctx:t,style:e,coordinates:n,map:o})}))},e.prototype.isPixelInGeometry=function(t){var e=this;return this.coordinates.some((function(n){return Jt.isPixelInGeometry({coordinates:n,map:e.getMap(),pixel:t})}))},e}(V),Kt=Xt,qt={parse:function(t,e){var n=[];return function t(n,o,i){var r=null;n.type===h.Point?((r=o(new _t({lng:n.coordinates[0],lat:n.coordinates[1]}))).setId(k.Z.uuid()),i.push(r)):n.type===h.MultiPoint?((r=o(new Wt(n.coordinates.map((function(t){return{lng:t[0],lat:t[1]}}))))).setId(k.Z.uuid()),i.push(r)):n.type===h.LineString?((r=o(new tt({point1:{lng:n.coordinates[0][0],lat:n.coordinates[0][1]},point2:{lng:n.coordinates[1][0],lat:n.coordinates[1][1]}}))).setId(k.Z.uuid()),i.push(r)):n.type===h.MultiLineString?((r=o(new at(n.coordinates.map((function(t){return{point1:{lng:t[0][0],lat:t[0][1]},point2:{lng:t[1][0],lat:t[1][1]}}}))))).setId(k.Z.uuid()),i.push(r)):n.type===h.Polygon?((r=o(new Jt(n.coordinates.map((function(t){return{lng:t[0],lat:t[1]}}))))).setId(k.Z.uuid()),i.push(r)):n.type===h.MultiPolygon?((r=o(new Kt(n.coordinates.map((function(t){return t.map((function(t){return{lng:t[0],lat:t[1]}}))}))))).setId(k.Z.uuid()),i.push(r)):n.type===h.GeometryCollection?n.geometries.forEach((function(n){t(n,e,i)})):n.type===h.Feature?t(n.geometry,(function(t){return(t=e(t)).setId(n.id),t.setProperties(n.properties),t}),i):n.type===h.FeatureCollection&&n.features.forEach((function(n){t(n,e,i)}))}(t,e,n),n},stringify:function(t){function e(t){return[(t=t.getCoordinates()).lng,t.lat]}function n(t){return t.getCoordinates().map((function(t){return[t.lng,t.lat]}))}function o(t){return[[(t=t.getCoordinates()).point1.lng,t.point1.lat],[t.point2.lng,t.point2.lat]]}function i(t){return t.getCoordinates().map((function(t){return[[t.point1.lng,t.point1.lat],[t.point2.lng,t.point2.lat]]}))}function r(t){return t.getCoordinates().map((function(t){return[t.lng,t.lat]}))}function a(t){return t.getCoordinates().map((function(t){return t.map((function(t){return[t.lng,t.lat]}))}))}var s,l={type:h.FeatureCollection,features:[]},c=[];for(s in h)c.push(s);return t.forEach((function(t){var s,u,p=t.getGeometry().getType();c.includes(p)&&l.features.push({type:h.Feature,geometry:{type:p,coordinates:(p=t.getGeometry(),s=new Map([[h.Point,e],[h.MultiPoint,n],[h.LineString,o],[h.MultiLineString,i],[h.Polygon,r],[h.MultiPolygon,a]]),u=p.getType(),s.get(u)(p))},id:t.getId(),properties:t.getProperties()})})),l}},$t=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),te=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},ee=function(t){function e(e){var n=t.call(this)||this;return n.context=null,n.features=[],n.features=e,n.setFeaturesContext(),n}return $t(e,t),e.prototype.setFeaturesContext=function(){var t=this;this.features.forEach((function(e){e.setContext(t)}))},e.prototype.addFeature=function(t){this.hasFeatureById(t.getId())||(this.features.push(t),this.setFeaturesContext(),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(y.UPDATE))},e.prototype.addFeatures=function(t){var e=this;t=t.filter((function(t){return!e.hasFeatureById(t.getId())}));this.features=te(te([],this.features,!0),t,!0),this.setFeaturesContext(),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.addFirstFeature=function(t){this.hasFeatureById(t.getId())||(this.features.unshift(t),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(y.UPDATE))},e.prototype.insertFeature=function(t,e){this.hasFeatureById(t.getId())||(this.features.splice(e,0,t),this.setFeaturesContext(),null!=(e=null==this?void 0:this.getContext())&&e.getEmitter().trigger(y.UPDATE))},e.prototype.removeFeature=function(t){this.removeFeatureById(t.getId())},e.prototype.removeFeatureById=function(t){var e;this.hasFeatureById(t)&&(e=this.features.findIndex((function(e){return e.getId()===t})),this.features.splice(e,1),null!=(e=null==this?void 0:this.getContext()))&&e.getEmitter().trigger(y.UPDATE)},e.prototype.clear=function(){var t;this.features=[],null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getFeatureById=function(t){return this.features.find((function(e){return e.getId()===t}))},e.prototype.getFeatures=function(){return te([],this.features,!0)},e.prototype.hasFeature=function(t){return-1!==this.features.indexOf(t)},e.prototype.hasFeatureById=function(t){return!!this.features.find((function(e){return e.getId()===t}))},e.prototype.readGeoJSON=function(t,e){var n=this;this.features=qt.parse(t,e),this.features.forEach((function(t){t.setContext(n)})),null!=(t=null==this?void 0:this.getContext())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.appendGeoJSON=function(t,e){var n=this;(t=qt.parse(t,e)).forEach((function(t){t.setContext(n)})),this.features=te(te([],this.features,!0),t,!0),null!=(e=null==this?void 0:this.getContext())&&e.getEmitter().trigger(y.UPDATE)},e.prototype.featuresToGeoJSON=function(){return qt.stringify(this.features)},e.prototype.setContext=function(t){this.context=t},e.prototype.getContext=function(){return this.context},e}(G.Z.Events),ne=ee,oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ie=function(){return(ie=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},re=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},ae=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return oe(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return re([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitCircle},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap(),n=[];t.forEach((function(t){t=e.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),n.push(et.xmu([t.x,t.y]))})),t=et.uf4(n);return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this,o=this.coordinates,i=ie(ie({},g),null!=e?e:{});o.forEach((function(e){ut.drawCircle({ctx:t,style:i,coordinates:e,map:n.getMap(),isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return ut.isPixelInGeometry({coordinates:o,map:n.getMap(),style:e,pixel:t,isScale:!0})}))},e}(V),se=ae,le=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ce=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},ue=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return le(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return ce([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitLeaf},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],n=this.getMap();t.forEach((function(t){t=n.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(et.xmu([t.x,t.y]))})),t=et.uf4(e);return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){dt.drawLeaf({ctx:t,style:e,coordinates:n,map:o,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return dt.isPixelInGeometry({coordinates:o,map:n.getMap(),pixel:t,style:e,isScale:!0})}))},e}(V),pe=ue,ye=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),he=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},de=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return ye(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return he([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitRect},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=this.getMap();t=t.map((function(t){return t=e.pointToPixel(new BMap.Point(t.leftTop.lng,t.leftTop.lat)),et.xmu([t.x,t.y])})),t=et.uf4(t);return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){vt.drawRect({ctx:t,style:e,coordinates:n,map:o,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return vt.isPixelInGeometry({coordinates:o,map:n.getMap(),pixel:t,style:e,isScale:!0})}))},e}(V),fe=de,ge=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),xe=function(t){function e(e){var n=t.call(this,e)||this;return n.coordinates=e,n}return ge(e,t),e.prototype.getType=function(){return u.MulitRadiusRect},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){mt.drawRadiusRect({ctx:t,style:e,coordinates:n,map:o,isScale:!0})}))},e}(fe),ve=xe,Me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Te=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Ce=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Me(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Te([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitRegularPolygon},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],n=this.getMap();t.forEach((function(t){t=n.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(et.xmu([t.x,t.y]))})),t=et.uf4(e);return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){St.drawRegularPolygon({ctx:t,style:e,coordinates:n,map:o,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return St.isPixelInGeometry({coordinates:o,map:n.getMap(),pixel:t,style:e,isScale:!0})}))},e}(V),me=Ce,Pe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),we=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},De=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Pe(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return we([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitSector},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],n=this.getMap();t.forEach((function(t){t=n.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(et.xmu([t.x,t.y]))})),t=et.uf4(e);return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){Lt.drawSector({ctx:t,style:e,coordinates:n,map:o,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return Lt.isPixelInGeometry({coordinates:o,map:n.getMap(),pixel:t,style:e,isScale:!0})}))},e}(V),Se=De,Ie=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Oe=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},je=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Ie(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Oe([],this.coordinates,!0)},e.prototype.getType=function(){return u.MulitStart},e.prototype.getCenterCoordinate=function(t){t.ctx,t.style,t.isScale;t=this.coordinates;var e=[],n=this.getMap();t.forEach((function(t){t=n.pointToPixel(new BMap.Point(t.center.lng,t.center.lat)),e.push(et.xmu([t.x,t.y]))})),t=et.uf4(e);return{x:(t=et.beQ(t)).geometry.coordinates[0],y:t.geometry.coordinates[1]}},e.prototype.draw=function(t,e){var n=this.coordinates,o=this.getMap();n.forEach((function(n){zt.drawStart({ctx:t,style:e,coordinates:n,map:o,isScale:!0})}))},e.prototype.isPixelInGeometry=function(t,e){var n=this;return this.coordinates.some((function(o){return zt.isPixelInGeometry({coordinates:o,map:n.getMap(),pixel:t,style:e,isScale:!0})}))},e}(V),Le=je,Ee=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ae=function(){return(Ae=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},be=function(t){function e(e){var n=t.call(this)||this;return n.coordinates=e,n}return Ee(e,t),e.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==this?void 0:this.getLayer())&&t.getEmitter().trigger(y.UPDATE)},e.prototype.getCoordinates=function(){return Ae({},this.coordinates)},e.prototype.getType=function(){return u.Text},e.getCenterCoordinate=function(t){return Ae({},t.point)},e.prototype.getCenterCoordinate=function(){return e.getCenterCoordinate(this.coordinates)},e.prototype.draw=function(t,e){t.save();e=Ae(Ae({},b),null!=e?e:{}),t.beginPath(),t.font=e.font,t.textAlign=e.textAlign,t.textBaseline=e.textBaseline,t.direction=e.direction,t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,e=this.getMap();var n=(o=this.coordinates).text,o=o.point;e=e.pointToPixel(new BMap.Point(o.lng,o.lat));t.fillText(n,e.x,e.y),t.restore()},e.prototype.isPixelInGeometry=function(t){return!1},e}(V),ze=be,Be={fillStyle:"#fff",strokeStyle:"#fff",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1},Re={strokeStyle:"#fff",lineWidth:1,lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:.6},Ne={fillStyle:"rgb(91,155,213,1)",strokeStyle:"rgba(0,0,0,.8)",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[],lineDashOffset:-1};!function(t){t[t.UnStart=0]="UnStart",t[t.Running=1]="Running",t[t.End=2]="End",t[t.Destroy=3]="Destroy"}(m=m||{}),function(t){t.BeforeStart="BeforeStart",t.Start="Start",t.End="End",t.Destroy="Destroy"}(P=P||{}),function(t){t.CanvasMount="CanvasMount",t.CanvasClickEmpty="CanvasClickEmpty",t.CanvasClickGeometry="CanvasClickGeometry"}(w=w||{}),function(t){t.Polygon="Polygon",t.Circle="Circle",t.Rectangle="Rectangle",t.Triangle="Triangle",t.Diamond="Diamond",t.Start="Start",t.Free="Free",t.Distance="Distance"}(D=D||{}),function(t){t.Draw="Draw",t.Modify="Modify",t.Move="Move"}(S=S||{});var _e,ke=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ge=function(){return(Ge=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Ze=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.context=null,e.style=Ge({},Ne),e.status=m.UnStart,e}return ke(e,t),e.prototype.destroy=function(){var t,e;this.context&&![m.Running,m.Destroy].includes(this.status)&&(t=(e=this.context).getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&(t.style.cursor=e.style.cursor="default",this.context.enableMap())},e.prototype.end=function(t){var e,n;this.context&&![m.Running,m.Destroy].includes(this.status)&&(e=(n=this.context).getCanvasEl(),n=n.getAssistCanvasEl(),e)&&n&&(e.style.cursor=n.style.cursor="default",this.context.enableMap())},e.prototype.start=function(t){this.context&&![m.Running,m.Destroy].includes(this.status)&&this.setCursor()},e.prototype.setCursor=function(){var t=this.context;t&&(t=t.getCanvasEl())&&(t.style.cursor="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjI3OTEzNjM1NDc3IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQzMDgiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxMi4wMDIgODg3QzMwNC44OTIgODg3IDEzNyA3MTkuMTA4IDEzNyA1MTIuMDAyIDEzNyAzMDQuODkyIDMwNC44OTIgMTM3IDUxMi4wMDIgMTM3IDcxOS4xMDggMTM3IDg4NyAzMDQuODkyIDg4NyA1MTIuMDAyIDg4NyA3MTkuMTA4IDcxOS4xMDggODg3IDUxMi4wMDIgODg3ek01MTIgNzg3YzE1MS44NzggMCAyNzUtMTIzLjEyMiAyNzUtMjc1UzY2My44NzggMjM3IDUxMiAyMzcgMjM3IDM2MC4xMjIgMjM3IDUxMnMxMjMuMTIyIDI3NSAyNzUgMjc1eiIgZmlsbD0iIzFBQTVGRiIgcC1pZD0iNDMwOSI+PC9wYXRoPjxwYXRoIGQ9Ik01MTIgNTEybS0yMjUgMGEyMjUgMjI1IDAgMSAwIDQ1MCAwIDIyNSAyMjUgMCAxIDAtNDUwIDBaIiBmaWxsPSIjMUFBNUZGIiBwLWlkPSI0MzEwIj48L3BhdGg+PC9zdmc+), auto")},e.prototype.setContext=function(t){this.context=t},e.prototype.getStatus=function(){return this.status},e}(G.Z.Events),We=Ze,He=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ue=function(t){function e(){var e=t.call(this)||this;return e.centerPoint=null,e.isMove=!1,e.radius=0,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return He(e,t),e.booleanPointInData=function(t,n,o){return k.Z.isPointInCircle(n,e.transformOriginToReal(t,o.data))},e.prototype.draw=function(t){var e,n=(i=this).context,o=i.centerPoint,i=i.style,r=null==n?void 0:n.getCtx();n&&r&&o&&(e=n.getCanvasEl())&&(t=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}))&&(n.clearDraw(),n.drawHistoryData(),r.beginPath(),this.radius=k.Z.getDistanceByBetweenPoint({p1:o,p2:t}),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,r.ellipse((null==o?void 0:o.x)||0,(null==o?void 0:o.y)||0,this.radius,this.radius,45*Math.PI/180,0,2*Math.PI),r.stroke(),r.fill())},e.draw=function(t,n,o){n&&o&&(o.style&&(n.lineWidth=o.style.lineWidth,n.lineJoin=o.style.lineJoin,n.lineCap=o.style.lineCap,n.setLineDash(o.style.lineDash),n.lineDashOffset=o.style.lineDashOffset,n.strokeStyle=o.style.strokeStyle,n.fillStyle=o.style.fillStyle,n.globalAlpha=o.style.globalAlpha||1),e.drawHistoryPath(t,n,o.data),n.stroke(),n.fill())},e.drawHistoryPath=function(t,e,n){var o=t.pointToPixel(n.center);t=t.actualToDistance(n.radius);e.save(),e.beginPath(),e.ellipse(o.x,o.y,t,t,45*Math.PI/180,0,2*Math.PI),e.stroke(),e.fill(),e.restore()},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.centerPoint=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){var e=this.context;e&&e.getCtx()&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformRealToOrigin=function(t,e){return{center:t.pixelToPoint(e.center),radius:t.distanceToActual(e.radius)}},e.transformOriginToReal=function(t,e){return{center:t.pointToPixel(e.center),radius:t.actualToDistance(e.radius)}},e.prototype.getSelectType=function(){return D.Circle},e.prototype.start=function(e){var n;this.context&&![m.Running,m.Destroy].includes(this.status)&&(n=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Draw}),null!=n&&n.addEventListener("mousedown",this.onCanvasMouseDown),this.status=m.Running,this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Draw}))},e.prototype.end=function(n){var o,i=this.context;i&&(o=i.getCanvasEl())&&(null!=o&&o.removeEventListener("mousedown",this.onCanvasMouseDown),null!=o&&o.removeEventListener("mousemove",this.onCanvasMouseMove),null!=o&&o.removeEventListener("mouseup",this.onCanvasMouseUp),n&&this.draw(n),this.status=m.End,o={id:k.Z.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{center:this.centerPoint,radius:this.radius}),style:this.style},i.addHistoryData(o),this.centerPoint=null,this.radius=0,this.isMove=!1,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Draw,data:o})),t.prototype.end.call(this,n)},e.prototype.destroy=function(){var e,n=this.context;n&&(e=n.getCanvasEl())&&(this.status===m.Running&&(n.clearDraw(),n.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.centerPoint=null,this.radius=0,this.isMove=!1,this.status=m.Destroy,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Draw})),t.prototype.destroy.call(this)},e}(We),Ye=Ue,Fe={getRectLeftTopPoint:function(t){var e=t.startPoint;return(t=t.targetPoint).x<=e.x&&t.y<=e.y?t:t.x<=e.x&&t.y>=e.y?{x:t.x,y:e.y}:t.x>=e.x&&t.y<=e.y?{x:e.x,y:t.y}:t.x>=e.x&&t.y>=e.y?e:null},triangle:function(t){var e,n=t.startPoint,o=(t=t.targetPoint,this.getRectLeftTopPoint({startPoint:n,targetPoint:t}));return o?(e=Math.abs(t.x-n.x),t=Math.abs(t.y-n.y),[{x:o.x,y:o.y+t},{x:o.x+e/2,y:o.y},{x:o.x+e,y:o.y+t}]):[]}},Je=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Qe=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.leftTopPoint=null,e.width=0,e.height=0,e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return Je(e,t),e.booleanPointInData=function(t,n,o){o=(t=e.transformOriginToReal(t,o.data)).leftTopPoint;var i=(a=t.width)/2,r=(t=t.height)/2,a=(n=et.xmu([n.x,n.y]),et.yue([[[o.x,o.y+r],[o.x+i,o.y],[o.x+a,o.y+r],[o.x+i,o.y+t],[o.x,o.y+r]]]));return et.FWy(n,a)},e.prototype.draw=function(t){var e,n=(i=this).context,o=i.startPoint,i=i.style,r=null==n?void 0:n.getCtx();n&&r&&(e=n.getCanvasEl())&&(t=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),n.clearDraw(),n.drawHistoryData(),r.beginPath(),this.leftTopPoint=Fe.getRectLeftTopPoint({startPoint:o,targetPoint:t}),this.leftTopPoint)&&(this.width=Math.abs(t.x-((null==o?void 0:o.x)||0)),this.height=Math.abs(t.y-((null==o?void 0:o.y)||0)),e=this.width/2,n=this.height/2,r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,r.moveTo(this.leftTopPoint.x,this.leftTopPoint.y+n),r.lineTo(this.leftTopPoint.x+e,this.leftTopPoint.y),r.lineTo(this.leftTopPoint.x+this.width,this.leftTopPoint.y+n),r.lineTo(this.leftTopPoint.x+e,this.leftTopPoint.y+this.height),r.stroke(),r.fill())},e.draw=function(t,e,n){e&&n&&(n.style&&(e.lineWidth=n.style.lineWidth,e.lineJoin=n.style.lineJoin,e.lineCap=n.style.lineCap,e.setLineDash(n.style.lineDash),e.lineDashOffset=n.style.lineDashOffset,e.strokeStyle=n.style.strokeStyle,e.fillStyle=n.style.fillStyle,e.globalAlpha=n.style.globalAlpha||1),this.drawHistoryPath(t,e,n.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,n,o){var i;n.save(),n.beginPath(),o&&o.leftTopPoint&&(o=(t=e.transformOriginToReal(t,o)).width/2,i=t.height/2,n.moveTo(t.leftTopPoint.x,t.leftTopPoint.y+i),n.lineTo(t.leftTopPoint.x+o,t.leftTopPoint.y),n.lineTo(t.leftTopPoint.x+t.width,t.leftTopPoint.y+i),n.lineTo(t.leftTopPoint.x+o,t.leftTopPoint.y+t.height),n.stroke(),n.fill(),n.restore())},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{leftTopPoint:t.pointToPixel(e.leftTopPoint),width:t.actualToDistance(e.width),height:t.actualToDistance(e.height)}},e.transformRealToOrigin=function(t,e){return{leftTopPoint:t.pixelToPoint(e.leftTopPoint),width:t.distanceToActual(e.width),height:t.distanceToActual(e.height)}},e.prototype.getSelectType=function(){return D.Diamond},e.prototype.start=function(e){var n;this.context&&![m.Running,m.Destroy].includes(this.status)&&(n=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Draw}),null!=n&&n.addEventListener("mousedown",this.onCanvasMouseDown),this.status=m.Running,this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Draw}))},e.prototype.end=function(n){var o,i=this.context;i&&(o=i.getCanvasEl())&&(null!=o&&o.removeEventListener("mousedown",this.onCanvasMouseDown),null!=o&&o.removeEventListener("mousemove",this.onCanvasMouseMove),null!=o&&o.removeEventListener("mouseup",this.onCanvasMouseUp),n&&this.draw(n),this.status=m.End,o={id:k.Z.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{leftTopPoint:this.leftTopPoint,width:this.width,height:this.height}),style:this.style},i.addHistoryData(o),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Draw,data:o})),t.prototype.end.call(this,n)},e.prototype.destroy=function(){var e,n=this.context;n&&(e=n.getCanvasEl())&&(this.status===m.Running&&(n.clearDraw(),n.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.status=m.Destroy,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Draw})),t.prototype.destroy.call(this)},e}(We),Ve=Qe,Xe=n(20725),Ke={fillStyle:"#fff",strokeStyle:"red",lineWidth:6,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:1},qe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),$e=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},tn=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.pointStack=[],e.isMove=!1,e.onCanvasClick=e.onCanvasClick.bind(e),e.onCanvasMousemove=e.onCanvasMousemove.bind(e),e.onCanvasDbClick=e.onCanvasDbClick.bind(e),e}return qe(e,t),e.booleanPointInData=function(t,n,o){return(o=$e([],o.data,!0)).push(o[0]),o=e.transformOriginToReal(t,o),t=et.xmu([n.x,n.y]),n=et.yue([o.map((function(t){return[t.x,t.y]}))]),et.FWy(t,n)},e.draw=function(t,e,n){e&&n&&(n.style&&(e.lineWidth=n.style.lineWidth,e.lineJoin=n.style.lineJoin,e.lineCap=n.style.lineCap,e.setLineDash(n.style.lineDash),e.lineDashOffset=n.style.lineDashOffset,e.strokeStyle=n.style.strokeStyle,e.fillStyle=n.style.fillStyle,e.globalAlpha=n.style.globalAlpha||1),this.drawHistoryPath(t,e,n.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,n,o){void 0===o&&(o=[]),n.save(),n.beginPath(),(e.transformOriginToReal(t,o)||[]).forEach((function(t,e){0===e?n.moveTo(t.x,t.y):n.lineTo(t.x,t.y)})),n.closePath(),n.stroke(),n.fill(),n.restore()},e.transformOriginToReal=function(t,e){return e.map((function(e){return t.pointToPixel(e)}))},e.transformRealToOrigin=function(t,e){return e.map((function(e){return t.pixelToPoint(e)}))},e.prototype.fill=function(){if(this.context){var t=this.pointStack,e=this.context.getCtx();if(e&&!(t.length<=1)){e.save(),e.beginPath();for(var n=0;n<t.length;n++){var o=t[n];0===n?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y)}e.closePath(),e.fillStyle=this.style.fillStyle,e.fill(),e.restore()}}},e.prototype.drawLine=function(t,e){var n,o=this.context;o&&(n=this.style,o=o.getCtx())&&(o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(e.x,e.y),o.strokeStyle=n.strokeStyle,o.fillStyle=n.fillStyle,o.lineWidth=n.lineWidth,o.lineCap=n.lineCap,o.lineJoin=n.lineJoin,o.lineDashOffset=n.lineDashOffset,o.setLineDash(n.lineDash),o.stroke())},e.prototype.drawStack=function(){var t=this.pointStack;if(!(t.length<=1))for(var e=0;this.drawLine(t[e],t[e+1]),++e!=t.length-1;);},e.prototype.getCanvasClick=function(){return this.onCanvasClick},e.prototype.getCanvasMousemove=function(){return this.onCanvasMousemove},e.prototype.getCanvasDbClick=function(){return this.onCanvasDbClick},e.prototype.onCanvasClick=function(t){if(this.context){var e=this.context.getCanvasEl();if(e&&!(2<=t.detail)){if(this.startPoint){var n=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()});this.drawLine(this.startPoint,n),this.startPoint=n,this.startPoint&&this.pointStack.push(this.startPoint)}else{if(null!=e&&e.addEventListener("mousemove",this.getCanvasMousemove()),null!=e&&e.addEventListener("dblclick",this.getCanvasDbClick()),this.startPoint=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),!this.startPoint)return;this.pointStack.push(this.startPoint),this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Draw})}t.stopPropagation()}}},e.prototype.onCanvasMousemove=function(t){var e,n=this.context,o=this.startPoint;n&&o&&(e=n.getCanvasEl())&&(this.isMove=!0,n.clearDraw(),n.drawHistoryData(),this.drawStack(),this.drawLine(o,k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()})),t.stopPropagation())},e.prototype.onCanvasDbClick=function(t){this.isMove&&(this.end(),t.stopPropagation())},e.prototype.getSelectType=function(){return D.Polygon},e.prototype.start=function(e){var n=this.context,o=this.status;n&&![m.Running,m.Destroy].includes(o)&&n&&(o=n.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Draw}),null!=o&&o.addEventListener("mouseup",this.getCanvasClick()),this.status=m.Running)},e.prototype.end=function(){var n=this.context;if(n){var o,i=n.getCanvasEl();if(i)return null!=i&&i.removeEventListener("mouseup",this.getCanvasClick()),null!=i&&i.removeEventListener("mousemove",this.getCanvasMousemove()),null!=i&&i.removeEventListener("dblclick",this.getCanvasDbClick()),n.clearDraw(),n.drawHistoryData(),this.fill(),this.status=m.End,o={id:i=k.Z.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(n,this.pointStack),style:this.style},this.startPoint=null,this.pointStack=[],this.isMove=!1,n.addHistoryData(o),this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Draw,data:o}),t.prototype.end.call(this),i}t.prototype.end.call(this)},e.prototype.destroy=function(){var e,n=this.context;n&&(e=n.getCanvasEl())&&(this.status===m.Running&&(n.clearDraw(),n.drawHistoryData()),null!=e&&e.removeEventListener("mouseup",this.onCanvasClick),null!=e&&e.removeEventListener("mousemove",this.onCanvasMousemove),null!=e&&e.removeEventListener("dblclick",this.onCanvasDbClick),this.startPoint=null,this.pointStack=[],this.isMove=!1,this.status=m.Destroy,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Draw})),t.prototype.destroy.call(this)},e}(We),en=tn,nn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),on=function(){return(on=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},rn=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},an=function(t){function e(){var e=t.call(this)||this;return e.style=on(on({},Ne),{strokeStyle:"red"}),e.onCanvasClick=e.onCanvasClick.bind(e),e.onCanvasMousemove=e.onCanvasMousemove.bind(e),e.onCanvasDbClick=e.onCanvasDbClick.bind(e),e.onCursorMouseMove=e.onCursorMouseMove.bind(e),e.onDelete=e.onDelete.bind(e),e}return nn(e,t),e.prototype.onCursorMouseMove=function(t){var e=this.context,n=this.pointStack;if(e){var o=e.getCanvasEl(),i=(t=k.Z.clientToCtxPoint({event:t,rect:null==o?void 0:o.getBoundingClientRect()}),0);if(n.length){for(var r=0;r<n.length-1;r++){var a=n[r],s=n[r+1];i+=k.Z.getDistanceByBetweenPoint({p1:a,p2:s})}o=k.Z.getDistanceByBetweenPoint({p1:n[n.length-1],p2:t}),i=e.distanceToActual(i+o),o=e.getCtx(),t={x:t.x+10,y:t.y-25};var l=e.pixelToPoint(t),c=(l=(mt.drawRadiusRect({ctx:o,style:on(on({},g),{lineWidth:1,strokeStyle:"red",fillStyle:"#fff"}),coordinates:{leftTop:{lng:l.x,lat:l.y},width:120,height:50,radius:2},map:e.getMap(),isScale:!1}),""),e="",e=i<1e3?(l="".concat(i.toFixed(2)),Xe.ZP.v("米")):(l="".concat(k.Z.distance(i,"kilometer").toFixed(2)),Xe.ZP.v("公里")),"10px sans-serif"),u="bottom",p=t.x+60,y=t.y+25,h=o.measureText(l).width/2;o.beginPath(),o.font=c,o.textAlign="right",o.textBaseline=u,o.fillStyle="#000",o.fillText("".concat(Xe.ZP.v("总长"),"："),p-h,y,o.measureText("".concat(Xe.ZP.v("总长"),"：")).width),o.beginPath(),o.font=c,o.textAlign="center",o.textBaseline=u,o.fillStyle="red",o.fillText(l,p,y,o.measureText(l).width),o.beginPath(),o.font=c,o.textAlign="left",o.textBaseline=u,o.fillStyle="#000",o.fillText(e,p+h,y,o.measureText(e).width),o.beginPath(),o.font=c,o.textAlign="center",o.textBaseline=u,o.fillStyle="#000",o.fillText(Xe.ZP.v("单击确定地点，双击结束"),p,t.y+37.5+3,o.measureText(Xe.ZP.v("单击确定地点，双击结束")).width)}}},e.drawHistoryPath=function(t,e,n){var o=this;void 0===n&&(n=[]),e.save(),e.beginPath(),(en.transformOriginToReal(t,n)||[]).forEach((function(t,n){0===n?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.stroke(),e.restore(),n.forEach((function(i){o.drawStartPoint({context:t,ctx:e,style:Ke,pointStack:n,toPoint:i})}))},e.drawStartPoint=function(t){var e=t.context,n=t.ctx,o=t.style,i=t.pointStack,r=t.toPoint,a=(t=e.pointToPixel(r),i.findIndex((function(t){return JSON.stringify(t)===JSON.stringify(r)})));n.save(),n.beginPath(),n.fillStyle=o.fillStyle,n.strokeStyle=o.strokeStyle,n.lineWidth=o.lineWidth,n.ellipse(t.x,t.y,6,6,45*Math.PI/180,0,2*Math.PI),n.stroke(),n.fill(),n.restore(),n.save(),n.beginPath(),n.font="9px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle="blue",n.fillText("".concat(a+1),t.x,t.y),n.restore(),o={x:t.x+10,y:t.y-10},t=e.pixelToPoint(o),mt.drawRadiusRect({ctx:n,style:on(on({},g),{lineWidth:1,strokeStyle:"#000",fillStyle:"#fff"}),coordinates:{leftTop:{lng:t.x,lat:t.y},width:50,height:20,radius:2},map:e.getMap(),isScale:!1}),t="";if(0===a)t=Xe.ZP.v("起点");else{for(var s=0,l=0;l<a;l++){var c=e.pointToPixel(i[l]),u=e.pointToPixel(i[l+1]);s+=k.Z.getDistanceByBetweenPoint({p1:c,p2:u})}t=(s=e.distanceToActual(s))<1e3?"".concat(s.toFixed(2)).concat(Xe.ZP.v("米")):"".concat(k.Z.distance(s,"kilometer").toFixed(2)).concat(Xe.ZP.v("公里"))}n.save(),n.beginPath(),n.font="10px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle="#000",n.fillText(t,o.x+25,o.y+10),n.restore()},e.prototype.drawStartPoint=function(){var t,n,o=this.context,i=this.startPoint;o&&(t=o.getCtx())&&(n=this.pointStack,e.drawStartPoint({context:o,ctx:t,style:Ke,pointStack:en.transformRealToOrigin(o,rn([],n,!0)),toPoint:o.pixelToPoint(i)}))},e.prototype.fill=function(){var t=this.context;if(t){var n=this.pointStack,o=t.getCtx();if(o)if(n.length<=1)1===n.length&&e.drawStartPoint({context:t,ctx:t.getCtx(),style:Ke,pointStack:en.transformRealToOrigin(t,n),toPoint:t.pixelToPoint(n[0])});else{o.fillStyle=this.style.fillStyle,o.save(),o.beginPath();for(var i=0;i<n.length;i++){var r=n[i];0===i?o.moveTo(r.x,r.y):o.lineTo(r.x,r.y)}o.stroke(),o.restore();var a=en.transformRealToOrigin(t,n);a.forEach((function(n,i){e.drawStartPoint({context:t,ctx:o,style:Ke,pointStack:a,toPoint:a[i]})}))}}},e.prototype.drawStack=function(){var t=this.pointStack,n=this.context;if(n)if(t.length<=1)1===t.length&&e.drawStartPoint({context:n,ctx:n.getCtx(),style:Ke,pointStack:en.transformRealToOrigin(n,t),toPoint:n.pixelToPoint(t[0])});else for(var o=0;o!==t.length-1&&this.drawLine(t[o],t[o+1]),e.drawStartPoint({context:n,ctx:n.getCtx(),style:Ke,pointStack:en.transformRealToOrigin(n,t),toPoint:n.pixelToPoint(t[o])}),++o<t.length;);},e.prototype.getCanvasClick=function(){return this.onCanvasClick},e.prototype.getCanvasMousemove=function(){return this.onCanvasMousemove},e.prototype.getCanvasDbClick=function(){return this.onCanvasDbClick},e.prototype.onCanvasClick=function(e){2<=e.detail||(t.prototype.onCanvasClick.call(this,e),this.drawStartPoint())},e.prototype.onCanvasMousemove=function(e){t.prototype.onCanvasMousemove.call(this,e),this.onCursorMouseMove(e)},e.prototype.onCanvasDbClick=function(e){t.prototype.onCanvasDbClick.call(this,e)},e.prototype.onDelete=function(t,e){var n,o,i,r=this.context;r&&(n=r.getMap(),-1!==(i=null==(o=null==r?void 0:r.getHistoryData())?void 0:o.findIndex((function(t){return t.id===e}))))&&(null!=o&&o.splice(i,1),r.setHistoryData(o),r.clearDraw(),r.drawHistoryData(),n.removeOverlay(t))},e.drawDeleteMark=function(t){var e,n=t.context,o=t.point,i=t.onDelete,r=(t=n.getMap(),new BMap.Icon("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMxMTk1MDc3NjM5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjExMjQ1IiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik0xNTkuMjE1NDg0IDI4NC43MzgwNjVoNzE1LjQ3ODcxYzEzLjIxMjkwMyAwIDIzLjc4MzIyNi0xMC41NzAzMjMgMjMuNzgzMjI1LTIzLjc4MzIyNnMtMTAuNTcwMzIzLTIzLjc4MzIyNi0yMy43ODMyMjUtMjMuNzgzMjI2SDE1OS4yMTU0ODRjLTEzLjIxMjkwMyAwLTIzLjc4MzIyNiAxMC41NzAzMjMtMjMuNzgzMjI2IDIzLjc4MzIyNnMxMC41NzAzMjMgMjMuNzgzMjI2IDIzLjc4MzIyNiAyMy43ODMyMjYiIHAtaWQ9IjExMjQ2IiBmaWxsPSIjZDgxZTA2Ij48L3BhdGg+PHBhdGggZD0iTTM1Ny40MDkwMzIgMzU2LjA4Nzc0MnY0MTMuNTYzODcxYzAgMTMuMjEyOTAzIDEwLjU3MDMyMyAyMy43ODMyMjYgMjMuNzgzMjI2IDIzLjc4MzIyNnMyMy43ODMyMjYtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjZWMzU2LjA4Nzc0MmMwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjYtMTIuNTUyMjU4IDAtMjMuNzgzMjI2IDEwLjU3MDMyMy0yMy43ODMyMjYgMjMuNzgzMjI2IiBwLWlkPSIxMTI0NyIgZmlsbD0iI2Q4MWUwNiI+PC9wYXRoPjxwYXRoIGQ9Ik01MDAuNzY5MDMyIDM1Ni4wODc3NDJ2NDEzLjU2Mzg3MWMwIDEzLjIxMjkwMyAxMC41NzAzMjMgMjMuNzgzMjI2IDIzLjc4MzIyNiAyMy43ODMyMjZzMjMuNzgzMjI2LTEwLjU3MDMyMyAyMy43ODMyMjYtMjMuNzgzMjI2VjM1Ni4wODc3NDJjMC0xMy4yMTI5MDMtMTAuNTcwMzIzLTIzLjc4MzIyNi0yMy43ODMyMjYtMjMuNzgzMjI2cy0yMy43ODMyMjYgMTAuNTcwMzIzLTIzLjc4MzIyNiAyMy43ODMyMjYiIHAtaWQ9IjExMjQ4IiBmaWxsPSIjZDgxZTA2Ij48L3BhdGg+PHBhdGggZD0iTTYyNy42MTI5MDMgMzU2LjA4Nzc0MnY0MTMuNTYzODcxYzAgMTMuMjEyOTAzIDEwLjU3MDMyMyAyMy43ODMyMjYgMjMuNzgzMjI2IDIzLjc4MzIyNnMyMy43ODMyMjYtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjZWMzU2LjA4Nzc0MmMwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjZTNjI3LjYxMjkwMyAzNDIuODc0ODM5IDYyNy42MTI5MDMgMzU2LjA4Nzc0MiIgcC1pZD0iMTEyNDkiIGZpbGw9IiNkODFlMDYiPjwvcGF0aD48cGF0aCBkPSJNNzU1LjExNzQxOSAyNzYuODEwMzIzdjU0MC40MDc3NDJjMCAxMy4yMTI5MDMtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjUgMjMuNzgzMjI1aC00MjkuNDE5MzU1Yy0xMy4yMTI5MDMgMC0yMy43ODMyMjYtMTAuNTcwMzIzLTIzLjc4MzIyNi0yMy43ODMyMjVWMjc2LjgxMDMyM2MwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjZzLTIzLjc4MzIyNiAxMC41NzAzMjMtMjMuNzgzMjI2IDIzLjc4MzIyNnY1NDAuNDA3NzQyYzAgMzkuNjM4NzEgMzEuNzEwOTY4IDcxLjM0OTY3NyA3MS4zNDk2NzggNzEuMzQ5Njc3aDQyOS40MTkzNTVjMzkuNjM4NzEgMCA3MS4zNDk2NzctMzEuNzEwOTY4IDcxLjM0OTY3Ny03MS4zNDk2NzdWMjc2LjgxMDMyM2MwLTEzLjIxMjkwMy0xMC41NzAzMjMtMjMuNzgzMjI2LTIzLjc4MzIyNi0yMy43ODMyMjZzLTIzLjc4MzIyNiAxMC41NzAzMjMtMjMuNzgzMjI2IDIzLjc4MzIyNnoiIHAtaWQ9IjExMjUwIiBmaWxsPSIjZDgxZTA2Ij48L3BhdGg+PHBhdGggZD0iTTM4OS43ODA2NDUgMjQ1LjA5OTM1NXYtNDcuNTY2NDUyYzAtMjEuODAxMjkgMTcuODM3NDE5LTM5LjYzODcxIDM5LjYzODcxLTM5LjYzODcwOWgxNzUuMDcwOTY4YzIxLjgwMTI5IDAgMzkuNjM4NzEgMTcuODM3NDE5IDM5LjYzODcwOSAzOS42Mzg3MDl2NDcuNTY2NDUyYzAgMTMuMjEyOTAzIDEwLjU3MDMyMyAyMy43ODMyMjYgMjMuNzgzMjI2IDIzLjc4MzIyNnMyMy43ODMyMjYtMTAuNTcwMzIzIDIzLjc4MzIyNi0yMy43ODMyMjZ2LTQ3LjU2NjQ1MmMwLTQ4LjIyNzA5Ny0zOC45NzgwNjUtODcuMjA1MTYxLTg3LjIwNTE2MS04Ny4yMDUxNjFINDI5LjQxOTM1NWMtNDguMjI3MDk3IDAtODcuMjA1MTYxIDM4Ljk3ODA2NS04Ny4yMDUxNjEgODcuMjA1MTYxdjQ3LjU2NjQ1MmMwIDEzLjIxMjkwMyAxMC41NzAzMjMgMjMuNzgzMjI2IDIzLjc4MzIyNSAyMy43ODMyMjYgMTIuNTUyMjU4IDAgMjMuNzgzMjI2LTEwLjU3MDMyMyAyMy43ODMyMjYtMjMuNzgzMjI2eiIgcC1pZD0iMTEyNTEiIGZpbGw9IiNkODFlMDYiPjwvcGF0aD48L3N2Zz4=",new BMap.Size(30,30)));(e=n.pointToPixel(o)).x+=22,e.y+=30,o=n.pixelToPoint(e),n=new BMap.Point(o.x,o.y);return(e=new BMap.Marker(n,{icon:r})).addEventListener("click",(function(){i&&i()})),t.addOverlay(e),e},e.prototype.getSelectType=function(){return D.Distance},e.prototype.start=function(e){var n=null==(n=null==this?void 0:this.context)?void 0:n.getMap();n.disableDragging(),n.disableScrollWheelZoom(),n.disableDoubleClickZoom(),n.disableContinuousZoom(),n.disablePinchToZoom(),t.prototype.start.call(this,e)},e.prototype.end=function(){var n,o,i,r=this,a=this.context;a&&((n=a.getMap()).enableDragging(),n.enableScrollWheelZoom(),n.enableDoubleClickZoom(),n.enableContinuousZoom(),n.enablePinchToZoom(),o=e.drawDeleteMark({context:a,point:a.pixelToPoint(this.pointStack[this.pointStack.length-1]),onDelete:function(){r.onDelete(o,i)}}),i=t.prototype.end.call(this))},e.prototype.destroy=function(){t.prototype.destroy.call(this);var e=null==(e=null==this?void 0:this.context)?void 0:e.getMap();e.enableDragging(),e.enableScrollWheelZoom(),e.enableDoubleClickZoom(),e.enableContinuousZoom(),e.enablePinchToZoom()},e.prototype.setCursor=function(){var t=this.context;t&&(t=t.getCanvasEl())&&(t.style.cursor="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMxMDY4ODUyOTU4IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5ODAiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTQxNiA4MjQuNkwyMjUuMSA2NjguNyA3MTYgOTYuMSA5MDYuOSAyNTJ6IiBmaWxsPSIjZDgxZTA2IiBwLWlkPSIyOTgxIj48L3BhdGg+PHBhdGggZD0iTTc4NiA5MjcuM2MtNC41IDAtOC44LTEuNi0xMi4yLTQuNEw1MjQuNSA3MTMuOGMtOC4xLTYuOC05LjEtMTguOC0yLjQtMjYuOCA2LjgtOCAxOC44LTkuMSAyNi44LTIuNGwyMzQuNyAxOTYuOEw5MTUgNzI0LjggNjc0LjYgNTIzLjJjLTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjggNi44LTggMTguOC05LjEgMjYuOC0yLjRsMjU1IDIxMy45YzguMSA2LjggOS4xIDE4LjggMi40IDI2LjhMODAwLjYgOTIwLjVjLTMuMyAzLjktNy45IDYuMy0xMi45IDYuNy0wLjYgMC4xLTEuMiAwLjEtMS43IDAuMXpNMzQwLjIgNTUzLjVjLTQuMyAwLTguNi0xLjUtMTIuMi00LjRMNzEgMzMzLjZjLTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhMMjI0LjQgMTIxYzYuOC04IDE4LjgtOS4xIDI2LjgtMi40bDI1My41IDIxMi42YzguMSA2LjggOS4xIDE4LjggMi40IDI2LjgtNi44IDguMS0xOC43IDkuMS0yNi44IDIuNEwyNDEuNCAxNjAgMTEwLjEgMzE2LjZsMjQyLjMgMjAzLjJjOC4xIDYuOCA5LjEgMTguOCAyLjQgMjYuOC0zLjggNC42LTkuMiA2LjktMTQuNiA2Ljl6IiBmaWxsPSIjZDgxZTA2IiBwLWlkPSIyOTgyIj48L3BhdGg+PHBhdGggZD0iTTIzOC44IDMxOC4yYy00LjMgMC04LjYtMS41LTEyLjItNC40LTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhsNzcuOS05Mi45YzYuOC04IDE4LjgtOS4xIDI2LjgtMi40IDguMSA2LjggOS4xIDE4LjggMi40IDI2LjhsLTc3LjkgOTIuOWMtMy43IDQuNS05LjEgNi44LTE0LjYgNi44ek0zNzkuMyAzNjQuOGMtNC4zIDAtOC42LTEuNS0xMi4yLTQuNC04LjEtNi44LTkuMS0xOC44LTIuNC0yNi44bDQyLjktNTEuMWM2LjgtOC4xIDE4LjgtOS4xIDI2LjgtMi40IDguMSA2LjggOS4xIDE4LjggMi40IDI2LjhMMzkzLjkgMzU4Yy0zLjggNC41LTkuMiA2LjgtMTQuNiA2Ljh6TTgwMC45IDcxOC4zYy00LjMgMC04LjYtMS41LTEyLjItNC40LTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhsNDIuOS01MS4xYzYuOC04LjEgMTguOC05LjEgMjYuOC0yLjQgOC4xIDYuOCA5LjEgMTguOCAyLjQgMjYuOGwtNDIuOSA1MS4xYy0zLjcgNC41LTkuMSA2LjgtMTQuNiA2Ljh6TTY2MC41IDY3MS43Yy00LjMgMC04LjYtMS41LTEyLjItNC40LTguMS02LjgtOS4xLTE4LjgtMi40LTI2LjhsNzcuOS05Mi45YzYuOC04LjEgMTguOC05LjEgMjYuOC0yLjQgOC4xIDYuOCA5LjEgMTguOCAyLjQgMjYuOGwtNzcuOSA5Mi45Yy0zLjggNC41LTkuMiA2LjgtMTQuNiA2Ljh6TTQxNiA4NDMuNmMtNC4yIDAtOC41LTEuNC0xMi00LjNMMjEzIDY4My41Yy00LTMuMi02LjUtOC02LjktMTMuMS0wLjQtNS4xIDEuMi0xMC4yIDQuNS0xNC4xTDcwMS41IDgzLjdjNi43LTcuOCAxOC41LTguOSAyNi41LTIuNGwxOTAuOSAxNTUuOWM0IDMuMiA2LjUgOCA2LjkgMTMuMSAwLjQgNS4xLTEuMiAxMC4yLTQuNSAxNC4xTDQzMC40IDgzN2MtMy43IDQuNC05LjEgNi42LTE0LjQgNi42ek0yNTIuMiA2NjYuM2wxNjEuNCAxMzEuOCA0NjYuMS01NDMuNy0xNjEuNC0xMzEuOC00NjYuMSA1NDMuN3oiIGZpbGw9IiNkODFlMDYiIHAtaWQ9IjI5ODMiPjwvcGF0aD48cGF0aCBkPSJNMTY4LjEgOTUyLjRjLTQuMyAwLTguNi0xLjUtMTIuMS00LjMtNS4zLTQuMy03LjgtMTEuMS02LjgtMTcuOGw0MC45LTI1MS40YzEuNy0xMC40IDExLjYtMTcuNCAyMS45LTE1LjggMTAuNCAxLjcgMTcuNCAxMS41IDE1LjggMjEuOWwtMzUuNiAyMTguOSAyMDcuMy03OC42YzkuOC0zLjggMjAuOCAxLjIgMjQuNiAxMSAzLjcgOS44LTEuMiAyMC44LTExIDI0LjZMMTc1IDk1MS4yYy0yLjQgMC44LTQuNyAxLjItNi45IDEuMnoiIGZpbGw9IiNkODFlMDYiIHAtaWQ9IjI5ODQiPjwvcGF0aD48L3N2Zz4=), auto")},e}(en),sn=an,ln=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),cn=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.isMove=!1,e.points=[],e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return ln(e,t),e.prototype.draw=function(t,e){void 0===e&&(e=!1);var n,o=this.context,i=this.style,r=null==o?void 0:o.getCtx();o&&r&&(n=o.getCanvasEl())&&(t=k.Z.clientToCtxPoint({event:t,rect:null==n?void 0:n.getBoundingClientRect()}))&&(this.points.push(t),o.clearDraw(),o.drawHistoryData(),r.beginPath(),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,this.points.forEach((function(t,e){0===e?r.moveTo(t.x,t.y):r.lineTo(t.x,t.y)})),e&&r.closePath(),r.stroke(),r.fill())},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),this.startPoint)&&(this.points.push(this.startPoint),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.draw=function(t,e,n){e&&n&&(n.style&&(e.lineWidth=n.style.lineWidth,e.lineJoin=n.style.lineJoin,e.lineCap=n.style.lineCap,e.setLineDash(n.style.lineDash),e.lineDashOffset=n.style.lineDashOffset,e.strokeStyle=n.style.strokeStyle,e.fillStyle=n.style.fillStyle,e.globalAlpha=n.style.globalAlpha||1),this.drawHistoryPath(t,e,n.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,n,o){n.save(),n.beginPath(),o=o.points,(e.transformOriginToReal(t,void 0===o?[]:o)||[]).forEach((function(t,e){0===e?n.moveTo(t.x,t.y):n.lineTo(t.x,t.y)})),n.closePath(),n.stroke(),n.fill(),n.restore()},e.transformRealToOrigin=function(t,e){return e.map((function(e){return t.pixelToPoint(e)}))},e.transformOriginToReal=function(t,e){return e.map((function(e){return t.pointToPixel(e)}))},e.prototype.getSelectType=function(){return D.Free},e.prototype.start=function(e){var n;this.context&&![m.Running,m.Destroy].includes(this.status)&&(n=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Draw}),null!=n&&n.addEventListener("mousedown",this.onCanvasMouseDown),this.status=m.Running,this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Draw}))},e.prototype.end=function(n){var o,i=this.context;i&&(o=i.getCanvasEl())&&(null!=o&&o.removeEventListener("mousedown",this.onCanvasMouseDown),null!=o&&o.removeEventListener("mousemove",this.onCanvasMouseMove),null!=o&&o.removeEventListener("mouseup",this.onCanvasMouseUp),this.draw(n,!0),this.status=m.End,o={id:k.Z.uuid(),type:this.getSelectType(),data:{points:e.transformRealToOrigin(i,this.points)},style:this.style},i.addHistoryData(o),this.startPoint=null,this.points=[],this.isMove=!1,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Draw,data:o})),t.prototype.end.call(this,n)},e.prototype.destroy=function(){var e,n=this.context;n&&(e=n.getCanvasEl())&&(this.status===m.Running&&(n.clearDraw(),n.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.points=[],this.isMove=!1,this.status=m.Destroy,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Draw})),t.prototype.destroy.call(this)},e}(We),un=cn,pn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),yn=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.leftTopPoint=null,e.width=0,e.height=0,e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return pn(e,t),e.booleanPointInData=function(t,n,o){o=(t=e.transformOriginToReal(t,o.data)).leftTopPoint;var i=t.width;t=t.height,n=et.xmu([n.x,n.y]),i=et.yue([[[o.x,o.y],[o.x+i,o.y],[o.x+i,o.y+t],[o.x,o.y+t],[o.x,o.y]]]);return et.FWy(n,i)},e.prototype.draw=function(t){var e,n=(i=this).context,o=i.startPoint,i=i.style,r=null==n?void 0:n.getCtx();n&&r&&(e=n.getCanvasEl())&&(t=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),n.clearDraw(),n.drawHistoryData(),r.beginPath(),this.leftTopPoint=Fe.getRectLeftTopPoint({startPoint:o,targetPoint:t}),this.width=Math.abs(t.x-((null==o?void 0:o.x)||0)),this.height=Math.abs(t.y-((null==o?void 0:o.y)||0)),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,r.rect((null==(e=this.leftTopPoint)?void 0:e.x)||0,(null==(n=this.leftTopPoint)?void 0:n.y)||0,this.width,this.height),r.stroke(),r.fill())},e.draw=function(t,e,n){e&&n&&(n.style&&(e.lineWidth=n.style.lineWidth,e.lineJoin=n.style.lineJoin,e.lineCap=n.style.lineCap,e.setLineDash(n.style.lineDash),e.lineDashOffset=n.style.lineDashOffset,e.strokeStyle=n.style.strokeStyle,e.fillStyle=n.style.fillStyle,e.globalAlpha=n.style.globalAlpha||1),this.drawHistoryPath(t,e,n.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,n,o){n.save(),n.beginPath(),t=e.transformOriginToReal(t,o),n.rect((null==(o=null==t?void 0:t.leftTopPoint)?void 0:o.x)||0,(null==(o=null==t?void 0:t.leftTopPoint)?void 0:o.y)||0,null==t?void 0:t.width,null==t?void 0:t.height),n.stroke(),n.fill(),n.restore()},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{leftTopPoint:t.pointToPixel(e.leftTopPoint),width:t.actualToDistance(e.width),height:t.actualToDistance(e.height)}},e.transformRealToOrigin=function(t,e){return{leftTopPoint:t.pixelToPoint(e.leftTopPoint),width:t.distanceToActual(e.width),height:t.distanceToActual(e.height)}},e.prototype.getSelectType=function(){return D.Rectangle},e.prototype.start=function(e){var n;this.context&&![m.Running,m.Destroy].includes(this.status)&&(n=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Draw}),null!=n&&n.addEventListener("mousedown",this.onCanvasMouseDown),this.status=m.Running,this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Draw}))},e.prototype.end=function(n){var o,i=this.context;i&&(o=i.getCanvasEl())&&(null!=o&&o.removeEventListener("mousedown",this.onCanvasMouseDown),null!=o&&o.removeEventListener("mousemove",this.onCanvasMouseMove),null!=o&&o.removeEventListener("mouseup",this.onCanvasMouseUp),n&&this.draw(n),this.status=m.End,o={id:k.Z.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{leftTopPoint:this.leftTopPoint,width:this.width,height:this.height}),style:this.style},i.addHistoryData(o),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Draw,data:o})),t.prototype.end.call(this,n)},e.prototype.destroy=function(){var e,n=this.context;n&&(e=n.getCanvasEl())&&(this.status===m.Running&&(n.clearDraw(),n.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.leftTopPoint=null,this.width=0,this.height=0,this.isMove=!1,this.status=m.Destroy,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Draw})),t.prototype.destroy.call(this)},e}(We),hn=yn,dn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),fn=function(t){function e(){var e=t.call(this)||this;return e.centerPoint=null,e.outRadius=0,e.innerRadius=0,e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return dn(e,t),e.booleanPointInData=function(t,n,o){for(var i=(t=e.transformOriginToReal(t,o.data)).center,r=t.outRadius,a=t.innerRadius,s=(o=et.xmu([n.x,n.y]),[]),l=0;l<5;l++)s.push({x:Math.cos((18+72*l)/180*Math.PI)*r+i.x,y:-Math.sin((18+72*l)/180*Math.PI)*r+i.y}),s.push({x:Math.cos((54+72*l)/180*Math.PI)*a+i.x,y:-Math.sin((54+72*l)/180*Math.PI)*a+i.y});return(t=s.map((function(t){return[t.x,t.y]}))).push(t[0]),n=et.yue([t]),et.FWy(o,n)},e.drawStart=function(t){var n=t.context,o=t.ctx;if((t=t.data)&&o){for(var i=t.style,r=(n=e.transformOriginToReal(n,t.data)).center,a=n.outRadius,s=n.innerRadius,l=(o.save(),o.beginPath(),72),c=0;c<5;c++)i&&(o.lineWidth=i.lineWidth,o.lineJoin=i.lineJoin,o.lineCap=i.lineCap,o.setLineDash(i.lineDash),o.lineDashOffset=i.lineDashOffset,o.strokeStyle=i.strokeStyle,o.fillStyle=i.fillStyle),o.lineTo(Math.cos((18+c*l)/180*Math.PI)*a+r.x,-Math.sin((18+c*l)/180*Math.PI)*a+r.y),o.lineTo(Math.cos((54+c*l)/180*Math.PI)*s+r.x,-Math.sin((54+c*l)/180*Math.PI)*s+r.y);o.stroke(),o.fill(),o.restore()}},e.prototype.draw=function(t){var n,o=this.context,i=this.centerPoint,r=null==o?void 0:o.getCtx();o&&i&&r&&(n=o.getCanvasEl())&&this.centerPoint&&(t=k.Z.clientToCtxPoint({event:t,rect:null==n?void 0:n.getBoundingClientRect()}),o.clearDraw(),o.drawHistoryData(),this.outRadius=k.Z.getDistanceByBetweenPoint({p1:i,p2:t}),this.innerRadius=this.outRadius/2,e.drawStart({context:o,ctx:r,data:{data:e.transformRealToOrigin(o,{center:this.centerPoint,outRadius:this.outRadius,innerRadius:this.innerRadius}),style:this.style}}))},e.draw=function(t,e,n){e&&n&&(n.style&&(e.lineWidth=n.style.lineWidth,e.lineJoin=n.style.lineJoin,e.lineCap=n.style.lineCap,e.setLineDash(n.style.lineDash),e.lineDashOffset=n.style.lineDashOffset,e.strokeStyle=n.style.strokeStyle,e.fillStyle=n.style.fillStyle,e.globalAlpha=n.style.globalAlpha||1),this.drawHistoryPath(t,e,n.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,n,o){o&&e.drawStart({context:t,ctx:n,data:{data:o}})},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.centerPoint=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{center:t.pointToPixel(e.center),outRadius:t.actualToDistance(e.outRadius),innerRadius:t.actualToDistance(e.innerRadius)}},e.transformRealToOrigin=function(t,e){return{center:t.pixelToPoint(e.center),outRadius:t.distanceToActual(e.outRadius),innerRadius:t.distanceToActual(e.innerRadius)}},e.prototype.getSelectType=function(){return D.Start},e.prototype.start=function(e){var n;this.context&&![m.Running,m.Destroy].includes(this.status)&&(n=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Draw}),null!=n&&n.addEventListener("mousedown",this.onCanvasMouseDown),this.status=m.Running,this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Draw}))},e.prototype.end=function(n){var o,i=this.context;i&&(o=i.getCanvasEl())&&this.centerPoint&&this.outRadius&&this.innerRadius&&(null!=o&&o.removeEventListener("mousedown",this.onCanvasMouseDown),null!=o&&o.removeEventListener("mousemove",this.onCanvasMouseMove),null!=o&&o.removeEventListener("mouseup",this.onCanvasMouseUp),n&&this.draw(n),this.status=m.End,o={id:k.Z.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{center:this.centerPoint,outRadius:this.outRadius,innerRadius:this.innerRadius}),style:this.style},i.addHistoryData(o),this.centerPoint=null,this.outRadius=0,this.innerRadius=0,this.isMove=!1,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Draw,data:o})),t.prototype.end.call(this,n)},e.prototype.destroy=function(){var e,n=this.context;n&&(e=n.getCanvasEl())&&(this.status===m.Running&&(n.clearDraw(),n.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.centerPoint=null,this.outRadius=0,this.innerRadius=0,this.isMove=!1,this.status=m.Destroy,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Draw})),t.prototype.destroy.call(this)},e}(We),gn=fn,xn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),vn=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Mn=function(t){function e(){var e=t.call(this)||this;return e.startPoint=null,e.points=[],e.isMove=!1,e.onCanvasMouseDown=e.onCanvasMouseDown.bind(e),e.onCanvasMouseMove=e.onCanvasMouseMove.bind(e),e.onCanvasMouseUp=e.onCanvasMouseUp.bind(e),e}return xn(e,t),e.booleanPointInData=function(t,n,o){return(o=vn([],o.data.points||[],!0)).push(o[0]),o=e.transformOriginToReal(t,{points:o}).points,t=et.xmu([n.x,n.y]),n=et.yue([o.map((function(t){return[t.x,t.y]}))]),et.FWy(t,n)},e.prototype.draw=function(t){var e,n=(i=this).context,o=i.startPoint,i=i.style,r=null==n?void 0:n.getCtx();n&&r&&(e=n.getCanvasEl())&&(t=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),n.clearDraw(),n.drawHistoryData(),r.beginPath(),r.lineWidth=i.lineWidth,r.lineJoin=i.lineJoin,r.lineCap=i.lineCap,r.setLineDash(i.lineDash),r.lineDashOffset=i.lineDashOffset,r.strokeStyle=i.strokeStyle,r.fillStyle=i.fillStyle,this.points=Fe.triangle({startPoint:o,targetPoint:t}),r.moveTo(this.points[0].x,this.points[0].y),r.lineTo(this.points[1].x,this.points[1].y),r.lineTo(this.points[2].x,this.points[2].y),r.closePath(),r.stroke(),r.fill())},e.draw=function(t,e,n){e&&n&&(n.style&&(e.lineWidth=n.style.lineWidth,e.lineJoin=n.style.lineJoin,e.lineCap=n.style.lineCap,e.setLineDash(n.style.lineDash),e.lineDashOffset=n.style.lineDashOffset,e.strokeStyle=n.style.strokeStyle,e.fillStyle=n.style.fillStyle,e.globalAlpha=n.style.globalAlpha||1),this.drawHistoryPath(t,e,n.data),e.stroke(),e.fill())},e.drawHistoryPath=function(t,n,o){n.save(),n.beginPath(),t=e.transformOriginToReal(t,{points:o.points}).points,n.moveTo(t[0].x,t[0].y),n.lineTo(t[1].x,t[1].y),n.lineTo(t[2].x,t[2].y),n.stroke(),n.fill(),n.restore()},e.prototype.onCanvasMouseDown=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&(this.startPoint=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),null!=e&&e.addEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.addEventListener("mouseup",this.onCanvasMouseUp),t.stopPropagation())},e.prototype.onCanvasMouseMove=function(t){this.context&&(this.isMove=!0,this.draw(t),t.stopPropagation())},e.prototype.onCanvasMouseUp=function(t){this.isMove&&(this.end(t),t.stopPropagation())},e.transformOriginToReal=function(t,e){return{points:e.points.map((function(e){return t.pointToPixel(e)}))}},e.transformRealToOrigin=function(t,e){return{points:e.points.map((function(e){return t.pixelToPoint(e)}))}},e.prototype.getSelectType=function(){return D.Triangle},e.prototype.start=function(e){var n;this.context&&![m.Running,m.Destroy].includes(this.status)&&(n=this.context.getCanvasEl())&&(t.prototype.start.call(this,e),e&&(this.style=e),this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Draw}),null!=n&&n.addEventListener("mousedown",this.onCanvasMouseDown),this.status=m.Running,this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Draw}))},e.prototype.end=function(n){var o,i=this.context;i&&(o=i.getCanvasEl())&&(null!=o&&o.removeEventListener("mousedown",this.onCanvasMouseDown),null!=o&&o.removeEventListener("mousemove",this.onCanvasMouseMove),null!=o&&o.removeEventListener("mouseup",this.onCanvasMouseUp),n&&this.draw(n),this.status=m.End,o={id:k.Z.uuid(),type:this.getSelectType(),data:e.transformRealToOrigin(i,{points:JSON.parse(JSON.stringify(this.points))}),style:this.style},i.addHistoryData(o),this.startPoint=null,this.points=[],this.isMove=!1,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Draw,data:o})),t.prototype.end.call(this,n)},e.prototype.destroy=function(){var e,n=this.context;n&&(e=n.getCanvasEl())&&(this.status===m.Running&&(n.clearDraw(),n.drawHistoryData()),null!=e&&e.removeEventListener("mousedown",this.onCanvasMouseDown),null!=e&&e.removeEventListener("mousemove",this.onCanvasMouseMove),null!=e&&e.removeEventListener("mouseup",this.onCanvasMouseUp),this.startPoint=null,this.points=[],this.isMove=!1,this.status=m.Destroy,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Draw})),t.prototype.destroy.call(this)},e}(We),Tn=Mn,Cn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),mn=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Pn="adhere-ui-interactionlayer",wn=19999,Dn=function(t){function e(e,n,o){var i=this;return i.update=i.update.bind(i),(i=t.call(this,{update:i.update,paneName:"markerPane",zIndex:wn})||this).map=null,i.el=null,i.listeners=null,i.curAction=null,i.canvasEl=null,i.ctx=null,i.assistCanvasEl=null,i.assistCtx=null,i.canvasData=[],i.emitter=new G.Z.Events,i.isLoad=!1,i.canvasObserver=null,i.typeActionMap=new Map([[D.Polygon,en],[D.Distance,sn],[D.Circle,Ye],[D.Rectangle,hn],[D.Triangle,Tn],[D.Diamond,Ve],[D.Start,gn],[D.Free,un]]),i.map=e,i.listeners=o,n&&(i.canvasData=n),i.initListeners(),i}return Cn(e,t),e.prototype.update=function(){this.isLoad?(this.curAction&&this.curAction.destroy(),this.clearDraw(),this.clearAssistDraw(),this.drawHistoryData()):(this.initCanvas(),this.initEvents(),this.clearDraw(),this.clearAssistDraw(),this.drawHistoryData(),this.isLoad=!0)},e.prototype.initListeners=function(){var t=this,e=this.listeners;e&&Object.keys(e).forEach((function(n){t.emitter.on(n,e[n])}))},e.prototype.initEvents=function(){var t=this;this.el.addEventListener("mouseup",(function(e){if(e&&!(2<=e.detail)){for(var n=t.getHistoryData(),o=k.Z.clientToCtxPoint({event:e,rect:t.getCanvasEl().getBoundingClientRect()}),i=[],r=0;r<n.length;r++){var a=n[r],s=t.typeActionMap.get(a.type);"booleanPointInData"in s&&(null==s?void 0:s.booleanPointInData(t,o,a))&&i.push({index:r,data:a})}i.length?t.emitter.trigger(w.CanvasClickGeometry,JSON.parse(JSON.stringify(i[i.length-1].data))):n.length&&t.emitter.trigger(w.CanvasClickEmpty)}}))},e.prototype.initCanvas=function(){var t=this;this.el=this.canvas.parentElement,this.canvasEl=this.canvas,this.el.style.width="".concat(this.canvasEl.width,"px"),this.el.style.height="".concat(this.canvasEl.height,"px"),this.canvasEl.className="".concat(Pn),this.ctx=this.canvasEl.getContext("2d"),this.assistCanvasEl=document.createElement("canvas"),this.assistCanvasEl.className="".concat(Pn,"-assist"),this.assistCanvasEl.style.zIndex="".concat(parseInt(this.canvasEl.style.zIndex)-1),this.assistCanvasEl.width=this.canvasEl.width,this.assistCanvasEl.height=this.canvasEl.height,this.assistCtx=this.assistCanvasEl.getContext("2d"),this.canvasObserver=new MutationObserver((function(e,n){for(var o=0,i=e;o<i.length;o++){var r=i[o];"attributes"===r.type&&"style"===r.attributeName&&(t.assistCanvasEl.style.left=t.canvasEl.style.left,t.assistCanvasEl.style.top=t.canvasEl.style.top)}})),this.canvasObserver.observe(this.canvasEl,{attributes:!0}),this.el.appendChild(this.assistCanvasEl),this.emitter.trigger(w.CanvasMount)},e.prototype.enableMap=function(){this.map.enableDoubleClickZoom()},e.prototype.disableMap=function(){this.map.disableDoubleClickZoom()},e.prototype.pixelToPoint=function(t){return{x:(t=this.map.pixelToPoint(t)).lng,y:t.lat}},e.prototype.pointToPixel=function(t){return this.map.pointToPixel(new BMap.Point(t.x,t.y))},e.prototype.distanceToActual=function(t){return t/F.default.getScale(this.map)},e.prototype.actualToDistance=function(t){return F.default.getScale(this.map)*t},e.prototype.getCtx=function(){return this.ctx},e.prototype.getCanvasEl=function(){return this.canvasEl},e.prototype.getAssistCanvasEl=function(){return this.assistCanvasEl},e.prototype.getAssistCtx=function(){return this.assistCtx},e.prototype.getWidth=function(){var t;return null==(t=null==this?void 0:this.getCanvasEl())?void 0:t.width},e.prototype.getHeight=function(){var t;return null==(t=null==this?void 0:this.getCanvasEl())?void 0:t.height},e.prototype.addHistoryData=function(t){this.canvasData.push(t)},e.prototype.removeHistoryDataById=function(t){var e=this.canvasData.findIndex((function(e){return e.id===t}));return-1===e?[]:this.canvasData.splice(e,1)},e.prototype.drawHistoryData=function(){var t=this;this.canvasData.forEach((function(e){var n,o=t.ctx;o&&e&&(e.style&&(o.lineWidth=e.style.lineWidth,o.lineJoin=e.style.lineJoin,o.lineCap=e.style.lineCap,o.setLineDash(e.style.lineDash),o.lineDashOffset=e.style.lineDashOffset,o.strokeStyle=e.style.strokeStyle,o.fillStyle=e.style.fillStyle),null!=(n=t.typeActionMap.get(e.type)))&&n.drawHistoryPath(t,o,e.data)}))},e.prototype.getHistoryDataById=function(t){return this.canvasData.find((function(e){return e.id===t}))},e.prototype.getHistoryData=function(){return mn([],this.canvasData,!0)},e.prototype.setHistoryData=function(t){this.canvasData=t},e.prototype.changeAction=function(t){t===this.curAction||t&&t.getStatus()!==m.UnStart||(this.disableMap(),this.curAction&&this.curAction.destroy(),null!=t&&t.setContext(this),this.curAction=t)},e.prototype.getCurAction=function(){return this.curAction},e.prototype.start=function(t){this.curAction&&this.curAction.start(t)},e.prototype.end=function(){this.curAction&&this.curAction.end()},e.prototype.clearDraw=function(){var t=this.ctx;t&&t.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.clearAssistDraw=function(){var t=this.assistCtx;t&&t.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.setFrontCanvas=function(t){t.style.zIndex="".concat(2e4)},e.prototype.setBackCanvas=function(t){t.style.zIndex="".concat(19998)},e.prototype.destroy=function(){this.curAction&&this.curAction.destroy(),this.canvasObserver&&this.canvasObserver.disconnect()},e.prototype.getMap=function(){return this.map},e}(BMap.CanvasLayer),Sn=Dn,In=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),On=function(t){function e(e){var n=t.call(this)||this;return n.context=null,n.data=null,n.status=m.UnStart,n.EmitActions={CONTEXT:"CONTEXT"},n.anchorRadius=5,n.anchorLineWidth=2,n.startPoint=null,n.startIndex=-1,n.moveStartPoint=null,n.canMove=!0,n.isMoved=!1,n.data=e,n.onContext=n.onContext.bind(n),n.onCanvasMousedown=n.onCanvasMousedown.bind(n),n.onCanvasMousemove=n.onCanvasMousemove.bind(n),n.onCanvasMouseup=n.onCanvasMouseup.bind(n),n.onCanvasIsModifyMousemove=n.onCanvasIsModifyMousemove.bind(n),n.onMoveMousedown=n.onMoveMousedown.bind(n),n.onMoveMousemove=n.onMoveMousemove.bind(n),n.onMoveMouseup=n.onMoveMouseup.bind(n),n.on(n.EmitActions.CONTEXT,n.onContext),n}return In(e,t),e.prototype.setAnchorCircleStyle=function(){var t;this.context&&(t=this.context.getCtx())&&(t.strokeStyle=Be.strokeStyle,t.fillStyle=Be.fillStyle,t.lineWidth=Be.lineWidth)},e.prototype.setAnchorLineStyle=function(){var t;this.context&&(t=this.context.getCtx())&&(t.strokeStyle=Be.strokeStyle,t.lineWidth=Be.lineWidth,t.setLineDash(Be.lineDash),t.lineDashOffset=Be.lineDashOffset)},e.prototype.onContext=function(){this.drawAnchors()},e.prototype.onCanvasMousedown=function(t){var e,n;this.context&&(e=this.context.getCanvasEl())&&this.context.getCtx()&&(n=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),n=this.getPointInAnchor(n))&&(this.startPoint=n.point,this.startIndex=n.index,e.addEventListener("mousemove",this.onCanvasMousemove),e.addEventListener("mouseup",this.onCanvasMouseup),t.stopPropagation())},e.prototype.onCanvasMousemove=function(t){var e;this.context&&(e=this.context.getCanvasEl())&&this.context.getCtx()&&this.startPoint&&(e=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),this.drawModify(e),t.stopPropagation())},e.prototype.onCanvasMouseup=function(t){this.end(t),t.stopPropagation()},e.prototype.onCanvasIsModifyMousemove=function(t){var e,n,o,i;this.context&&(e=this.context.getCanvasEl(),n=this.context.getAssistCanvasEl(),e)&&n&&(this.startPoint||this.moveStartPoint||(o=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),(i=this.getPointInAnchor(o))?(this.canMove=!1,this.setResizeCursorByIndex(i.index)):(this.canMove=this.isCanMove(o),this.canMove?e.style.cursor=n.style.cursor="move":e.style.cursor=n.style.cursor="default"),t.stopPropagation()))},e.prototype.initMoveEvents=function(){var t,e=this.context;e&&(t=e.getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&t.addEventListener("mousedown",this.onMoveMousedown)},e.prototype.clearMoveEvents=function(){var t,e=this.context;e&&(t=e.getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&(t.removeEventListener("mousedown",this.onMoveMousedown),t.removeEventListener("mousemove",this.onMoveMousemove),e.removeEventListener("mousemove",this.onMoveMousemove),e.removeEventListener("mouseup",this.onMoveMouseup))},e.prototype.onMoveMousedown=function(t){var e,n,o;t&&(e=this.context)&&(n=e.getCanvasEl(),o=e.getAssistCanvasEl(),n)&&o&&this.canMove&&(e.setFrontCanvas(o),this.moveStartPoint=k.Z.clientToCtxPoint({event:t,rect:n.getBoundingClientRect()}),this.drawMoveGeometry(),n.addEventListener("mousemove",this.onMoveMousemove),o.addEventListener("mousemove",this.onMoveMousemove),o.addEventListener("mouseup",this.onMoveMouseup),null!=t)&&t.stopPropagation()},e.prototype.onMoveMousemove=function(t){var e,n,o;t&&(e=this.context)&&(n=e.getCanvasEl(),o=e.getAssistCanvasEl(),n)&&o&&(o=k.Z.clientToCtxPoint({event:t,rect:n.getBoundingClientRect()}),this.moveStartPoint&&(this.isMoved=!0,e.clearAssistDraw(),this.drawMoveGeometry(this.moveStartPoint,o)),null!=t)&&t.stopPropagation()},e.prototype.onMoveMouseup=function(t){this.endMove(t)},e.prototype.start=function(){var t,e;this.context&&![m.Running,m.Destroy].includes(this.status)&&(t=(e=this.context).getCanvasEl(),e=e.getAssistCanvasEl(),t)&&e&&(t.style.cursor=e.style.cursor="default",this.trigger(P.BeforeStart,{selectType:this.getSelectType(),actionType:S.Modify}),t.addEventListener("mousedown",this.onCanvasMousedown),t.addEventListener("mousemove",this.onCanvasIsModifyMousemove),this.initMoveEvents(),this.status=m.Running,this.trigger(P.Start,{selectType:this.getSelectType(),actionType:S.Modify}))},e.prototype.end=function(t){var e,n;t&&(n=this.context)&&(e=n.getCanvasEl(),n=n.getAssistCanvasEl(),e)&&n&&(e.style.cursor=n.style.cursor="default",e.removeEventListener("mousedown",this.onCanvasMousedown),e.removeEventListener("mousemove",this.onCanvasMousemove),e.removeEventListener("mouseup",this.onCanvasMouseup),e.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),t=k.Z.clientToCtxPoint({event:t,rect:null==e?void 0:e.getBoundingClientRect()}),this.drawModify(t),this.status=m.End,this.startPoint=null,this.startPoint=null,this.startIndex=-1,this.moveStartPoint=null,this.canMove=!0,this.isMoved=!1,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Modify,data:t}),e.style.cursor=n.style.cursor="default",null!=(t=null==this?void 0:this.context))&&t.enableMap()},e.prototype.endMove=function(t){var e,n,o,i;t&&(n=this.context)&&(o=n.getCanvasEl(),i=n.getAssistCanvasEl(),o)&&i&&(t=k.Z.clientToCtxPoint({event:t,rect:o.getBoundingClientRect()}),this.canMove&&this.isMoved&&this.moveStartPoint?(n.setBackCanvas(i),n.clearAssistDraw(),this.drawMove(this.moveStartPoint,t),this.canMove=!0,this.isMoved=!1,this.moveStartPoint=null,this.startPoint=null,this.startIndex=-1,o.removeEventListener("mousedown",this.onCanvasMousedown),o.removeEventListener("mousemove",this.onCanvasMousemove),o.removeEventListener("mouseup",this.onCanvasMouseup),o.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),this.status=m.End,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Modify,data:t}),null!=(e=null==this?void 0:this.context)&&e.enableMap()):(n.setBackCanvas(i),this.canMove=!0,this.isMoved=!1,this.moveStartPoint=null,this.startPoint=null,this.startIndex=-1,o.removeEventListener("mousedown",this.onCanvasMousedown),o.removeEventListener("mousemove",this.onCanvasMousemove),o.removeEventListener("mouseup",this.onCanvasMouseup),o.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),this.status=m.End,this.trigger(P.End,{selectType:this.getSelectType(),actionType:S.Modify,data:t})))},e.prototype.destroy=function(){var t,e,n=this.context;n&&(t=n.getCanvasEl(),e=n.getAssistCanvasEl(),t)&&e&&(t.style.cursor=e.style.cursor="default",this.remove(this.EmitActions.CONTEXT,this.onContext),t.removeEventListener("mousedown",this.onCanvasMousedown),t.removeEventListener("mousemove",this.onCanvasMousemove),t.removeEventListener("mouseup",this.onCanvasMouseup),t.removeEventListener("mousemove",this.onCanvasIsModifyMousemove),this.clearMoveEvents(),n.clearDraw(),n.drawHistoryData(),this.status=m.Destroy,this.startPoint=null,this.startIndex=-1,this.moveStartPoint=null,this.canMove=!0,this.isMoved=!1,this.trigger(P.Destroy,{selectType:this.getSelectType(),actionType:S.Modify}),t.style.cursor=e.style.cursor="default",null!=(n=null==this?void 0:this.context))&&n.enableMap()},e.prototype.setContext=function(t){this.context=t,this.trigger(this.EmitActions.CONTEXT)},e.prototype.getStatus=function(){return this.status},e}(G.Z.Events),jn=On,Ln=(_e=function(t,e){return(_e=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}_e(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),En=function(){return(En=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},An=function(t){function e(e){return(e=t.call(this,e)||this).ResizeCursorMapping=new Map([[0,"ns-resize"],[1,"ew-resize"],[2,"ns-resize"],[3,"ew-resize"]]),e}return Ln(e,t),e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t)for(var e=(n=Ye.transformOriginToReal(this.context,null==(n=null==(n=null==this?void 0:this.data)?void 0:n.data)?void 0:n.data)).center,n=n.radius,o=[{x:e.x,y:e.y-n},{x:e.x+n,y:e.y},{x:e.x,y:e.y+n},{x:e.x-n,y:e.y}],i=0;i<o.length;i++){var r=o[i];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(r.x,r.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,n=-1,o=(i=Ye.transformOriginToReal(this.context,null==(i=null==(i=null==this?void 0:this.data)?void 0:i.data)?void 0:i.data)).center,i=i.radius,r=[{x:o.x,y:o.y-i},{x:o.x+i,y:o.y},{x:o.x,y:o.y+i},{x:o.x-i,y:o.y}],a=0;a<r.length;a++){var s=r[a],l=this.anchorRadius+this.anchorLineWidth;if(k.Z.isPointInCircle(t,{center:s,radius:l})){e=s,n=a;break}}return e&&-1!==n?{point:e,index:n}:null},e.prototype.setResizeCursorByIndex=function(t){var e,n;this.context&&(e=this.context.getCanvasEl(),n=this.context.getAssistCanvasEl(),e)&&n&&(e.style.cursor=n.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();n&&o&&this.data&&this.startPoint&&(o=n.getHistoryDataById(this.data.data.id))&&(e=o.data.center,e=n.pointToPixel(e),o.data.radius=n.distanceToActual(k.Z.getDistanceByBetweenPoint({p1:e,p2:t})),this.data.data=En({},o),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var n,o=this.context,i=null==o?void 0:o.getCtx();o&&i&&this.data&&(i=o.getHistoryDataById(this.data.data.id))&&(t=o.pixelToPoint(t),n=(e=o.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.center.x+=n,i.data.center.y+=e,this.data.data=En({},i),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return D.Circle},e.prototype.isCanMove=function(t){var e,n;return!!this.data&&(e=(n=null==(n=null==(n=null==this?void 0:this.data)?void 0:n.data)?void 0:n.data).center,n=n.radius,k.Z.isPointInCircle(t,Ye.transformOriginToReal(this.context,{center:e,radius:n})))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&Ye.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var n,o;this.context&&this.data&&t&&e&&((n=En({},this.data.data)).data=En(En({},n.data),{center:En({},n.data.center)}),t=this.context.pixelToPoint(t),o=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,n.data)&&n.data.center&&(n.data.center.x+=o,n.data.center.y+=e,n.style&&(n.style.globalAlpha=Re.globalAlpha,n.style.strokeStyle=Re.strokeStyle,n.style.lineWidth=Re.lineWidth,n.style.lineDash=Re.lineDash,n.style.lineDashOffset=Re.lineDashOffset),Ye.draw(this.context,this.context.getAssistCtx(),n))},e.prototype.setCursor=function(){},e}(jn),bn=An,zn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Bn=function(){return(Bn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Rn=function(t){function e(e){return(e=t.call(this,e)||this).rectangleAnchorPoints=[],e.indexToModifyHandlerMapping=new Map([[0,e.modifyDataByLeftTop],[1,e.modifyDataByCenterTop],[2,e.modifyDataByRightTop],[3,e.modifyDataByRightCenter],[4,e.modifyDataByRightBottom],[5,e.modifyDataByCenterBottom],[6,e.modifyDataByLeftBottom],[7,e.modifyDataByLeftCenter]]),e.ResizeCursorMapping=new Map([[0,"nwse-resize"],[1,"ns-resize"],[2,"nesw-resize"],[3,"ew-resize"],[4,"nwse-resize"],[5,"ns-resize"],[6,"nesw-resize"],[7,"ew-resize"]]),e}return zn(e,t),e.prototype.setCursor=function(){throw new Error("Method not implemented.")},e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t){var e,n=(e=Ve.transformOriginToReal(this.context,null==(e=null==(e=null==this?void 0:this.data)?void 0:e.data)?void 0:e.data)).leftTopPoint,o=e.width,i=o/2,r=(e=e.height)/2;this.rectangleAnchorPoints=[Bn({},n),{x:n.x+i,y:n.y},{x:n.x+o,y:n.y},{x:n.x+o,y:n.y+r},{x:n.x+o,y:n.y+e},{x:n.x+i,y:n.y+e},{x:n.x,y:n.y+e},{x:n.x,y:n.y+r}];for(var a=0;a<this.rectangleAnchorPoints.length;a++){var s=this.rectangleAnchorPoints[a];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(s.x,s.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}t.beginPath(),this.setAnchorLineStyle(),t.moveTo(n.x,n.y),t.lineTo(n.x+o,n.y),t.lineTo(n.x+o,n.y+e),t.lineTo(n.x,n.y+e),t.lineTo(n.x,n.y),t.stroke()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,n=-1,o=0;o<this.rectangleAnchorPoints.length;o++){var i=this.rectangleAnchorPoints[o],r=this.anchorRadius+this.anchorLineWidth;if(k.Z.isPointInCircle(t,{center:i,radius:r})){e=i,n=o;break}}return e&&-1!==n?{point:e,index:n}:null},e.prototype.setResizeCursorByIndex=function(t){var e,n;this.context&&(e=this.context.getCanvasEl(),n=this.context.getAssistCanvasEl(),e)&&n&&(e.style.cursor=n.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();n&&o&&this.data&&this.startPoint&&(o=n.getHistoryDataById(this.data.data.id))&&(e=this.indexToModifyHandlerMapping.get(this.startIndex))&&e.call(this,t)&&(this.data.data=Bn({},o),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var n,o=this.context,i=null==o?void 0:o.getCtx();o&&i&&this.data&&(i=o.getHistoryDataById(this.data.data.id))&&(t=o.pixelToPoint(t),n=(e=o.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.leftTopPoint.x+=n,i.data.leftTopPoint.y+=e,this.data.data=Bn({},i),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return D.Diamond},e.prototype.getBox=function(){var t,e=this.context,n=null==e?void 0:e.getCtx();return e&&n&&this.data&&(n=e.getHistoryDataById(this.data.data.id))?(n=(e=Ve.transformOriginToReal(e,n.data)).leftTopPoint,t=e.width,e=e.height,{leftTop:Bn({},n),rightTop:{x:n.x+t,y:n.y},rightBottom:{x:n.x+t,y:n.y+e},leftBottom:{x:n.x,y:n.y+e}}):null},e.prototype.modifyDataByLeftTop=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x>e.rightTop.x||t.y>e.rightBottom.y||(o.data.leftTopPoint=n.pixelToPoint(t),o.data.width=n.distanceToActual(e.rightTop.x-t.x),o.data.height=n.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByCenterTop=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y>e.leftBottom.y||(o.data.leftTopPoint=n.pixelToPoint({x:e.leftTop.x,y:t.y}),o.data.height=n.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightTop=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y>e.leftBottom.y||(o.data.leftTopPoint=n.pixelToPoint({x:e.leftTop.x,y:t.y}),o.data.width=n.distanceToActual(t.x-e.leftTop.x),o.data.height=n.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightCenter=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||(o.data.width=n.distanceToActual(t.x-e.leftTop.x),0))},e.prototype.modifyDataByRightBottom=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y<e.leftTop.y||(o.data.width=n.distanceToActual(t.x-e.leftTop.x),o.data.height=n.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByCenterBottom=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y<e.leftTop.y||(o.data.height=n.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByLeftBottom=function(t){var e,n,o=this.context,i=null==o?void 0:o.getCtx();return!(!(o&&i&&this.data&&this.startPoint)||!(i=o.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=o.pointToPixel(e),!(n=this.getBox()))||t.x>n.rightBottom.x||t.y<n.rightTop.y||(i.data.leftTopPoint=o.pixelToPoint({x:t.x,y:e.y}),i.data.width=o.distanceToActual(n.rightBottom.x-t.x),i.data.height=o.distanceToActual(t.y-n.rightTop.y),0))},e.prototype.modifyDataByLeftCenter=function(t){var e,n,o=this.context,i=null==o?void 0:o.getCtx();return!(!(o&&i&&this.data&&this.startPoint)||!(i=o.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=o.pointToPixel(e),!(n=this.getBox()))||t.x>n.rightBottom.x||(i.data.leftTopPoint=o.pixelToPoint({x:t.x,y:e.y}),i.data.width=o.distanceToActual(n.rightBottom.x-t.x),0))},e.prototype.isCanMove=function(t){var e,n,o,i,r,a;return!!this.data&&(e=(n=Ve.transformOriginToReal(this.context,null==(n=null==(n=null==this?void 0:this.data)?void 0:n.data)?void 0:n.data)).leftTopPoint,o=(a=n.width)/2,i=(n=n.height)/2,r=et.xmu([t.x,t.y]),a=et.yue([[[e.x,e.y+i],[e.x+o,e.y],[e.x+a,e.y+i],[e.x+o,e.y+n],[e.x,e.y+i]]]),et.FWy(r,a))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&Ve.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var n,o;this.context&&this.data&&t&&e&&((n=Bn({},this.data.data)).data=Bn(Bn({},n.data),{leftTopPoint:Bn({},n.data.leftTopPoint)}),t=this.context.pixelToPoint(t),o=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,n.data)&&n.data.leftTopPoint&&(n.data.leftTopPoint.x+=o,n.data.leftTopPoint.y+=e,n.style&&(n.style.globalAlpha=Re.globalAlpha,n.style.strokeStyle=Re.strokeStyle,n.style.lineWidth=Re.lineWidth,n.style.lineDash=Re.lineDash,n.style.lineDashOffset=Re.lineDashOffset),Ve.draw(this.context,this.context.getAssistCtx(),n))},e.prototype.destroy=function(){this.startIndex=-1,t.prototype.destroy.call(this)},e}(jn),Nn=Rn,_n=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),kn=function(){return(kn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Gn=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Zn=function(t){function e(e){return(e=t.call(this,e)||this).startIndex=-1,e}return _n(e,t),e.prototype.drawAnchors=function(){var t;if(this.context){var e=this.context.getCtx();if(e)for(var n=en.transformOriginToReal(this.context,(null==(t=null==(t=null==this?void 0:this.data)?void 0:t.data)?void 0:t.data)||[]),o=0;o<n.length;o++){var i=n[o];e.beginPath(),this.setAnchorCircleStyle(),e.ellipse(i.x,i.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),e.stroke(),e.fill()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,n=-1,o=en.transformOriginToReal(this.context,this.data.data.data),i=0;i<o.length;i++){var r=o[i],a=this.anchorRadius+this.anchorLineWidth;if(k.Z.isPointInCircle(t,{center:r,radius:a})){e=r,n=i;break}}return e&&-1!==n?{point:e,index:n}:null},e.prototype.setResizeCursorByIndex=function(t){var e,n;this.context&&(e=this.context.getCanvasEl(),n=this.context.getAssistCanvasEl(),e)&&n&&(e.style.cursor=n.style.cursor="nesw-resize")},e.prototype.drawModify=function(t){var e=this.context,n=null==e?void 0:e.getCtx();e&&n&&this.data&&this.startPoint&&-1!==this.startIndex&&(n=e.getHistoryDataById(this.data.data.id))&&(n.data[this.startIndex]=e.pixelToPoint(t),this.data.data=kn({},n),e.clearDraw(),e.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var n,o,i=this.context,r=null==i?void 0:i.getCtx();i&&r&&this.data&&(r=i.getHistoryDataById(this.data.data.id))&&(t=i.pixelToPoint(t),e=i.pixelToPoint(e),n=e.x-t.x,o=e.y-t.y,r.data.forEach((function(t){t.x+=n,t.y+=o})),this.data.data=kn({},r),i.clearDraw(),i.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return D.Polygon},e.prototype.isCanMove=function(t){var e,n;return!!this.data&&((n=en.transformOriginToReal(this.context,Gn([],null==(n=null==(n=null==this?void 0:this.data)?void 0:n.data)?void 0:n.data,!0))).push(n[0]),e=et.xmu([t.x,t.y]),n=et.yue([n.map((function(t){return[t.x,t.y]}))]),et.FWy(e,n))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&en.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var n,o,i;this.context&&this.data&&t&&e&&((n=kn({},this.data.data)).data=n.data.map((function(t){return kn({},t)})),t=this.context.pixelToPoint(t),e=this.context.pixelToPoint(e),o=e.x-t.x,i=e.y-t.y,n.data)&&n.data.length&&(n.data.forEach((function(t){t.x+=o,t.y+=i})),n.style&&(n.style.globalAlpha=Re.globalAlpha,n.style.strokeStyle=Re.strokeStyle,n.style.lineWidth=Re.lineWidth,n.style.lineDash=Re.lineDash,n.style.lineDashOffset=Re.lineDashOffset),en.draw(this.context,this.context.getAssistCtx(),n))},e.prototype.setCursor=function(){},e}(jn),Wn=Zn,Hn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Un=function(){return(Un=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Yn=function(t){function e(e){return(e=t.call(this,e)||this).rectangleAnchorPoints=[],e.indexToModifyHandlerMapping=new Map([[0,e.modifyDataByLeftTop],[1,e.modifyDataByCenterTop],[2,e.modifyDataByRightTop],[3,e.modifyDataByRightCenter],[4,e.modifyDataByRightBottom],[5,e.modifyDataByCenterBottom],[6,e.modifyDataByLeftBottom],[7,e.modifyDataByLeftCenter]]),e.ResizeCursorMapping=new Map([[0,"nwse-resize"],[1,"ns-resize"],[2,"nesw-resize"],[3,"ew-resize"],[4,"nwse-resize"],[5,"ns-resize"],[6,"nesw-resize"],[7,"ew-resize"]]),e}return Hn(e,t),e.prototype.setCursor=function(){throw new Error("Method not implemented.")},e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t){var e,n=(e=hn.transformOriginToReal(this.context,null==(e=null==(e=null==this?void 0:this.data)?void 0:e.data)?void 0:e.data)).leftTopPoint,o=e.width,i=o/2,r=(e=e.height)/2;this.rectangleAnchorPoints=[Un({},n),{x:n.x+i,y:n.y},{x:n.x+o,y:n.y},{x:n.x+o,y:n.y+r},{x:n.x+o,y:n.y+e},{x:n.x+i,y:n.y+e},{x:n.x,y:n.y+e},{x:n.x,y:n.y+r}];for(var a=0;a<this.rectangleAnchorPoints.length;a++){var s=this.rectangleAnchorPoints[a];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(s.x,s.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,n=-1,o=0;o<this.rectangleAnchorPoints.length;o++){var i=this.rectangleAnchorPoints[o],r=this.anchorRadius+this.anchorLineWidth;if(k.Z.isPointInCircle(t,{center:i,radius:r})){e=i,n=o;break}}return e&&-1!==n?{point:e,index:n}:null},e.prototype.setResizeCursorByIndex=function(t){var e,n;this.context&&(e=this.context.getCanvasEl(),n=this.context.getAssistCanvasEl(),e)&&n&&(e.style.cursor=n.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();n&&o&&this.data&&this.startPoint&&(o=n.getHistoryDataById(this.data.data.id))&&(e=this.indexToModifyHandlerMapping.get(this.startIndex))&&e.call(this,t)&&(this.data.data=Un({},o),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var n,o=this.context,i=null==o?void 0:o.getCtx();o&&i&&this.data&&(i=o.getHistoryDataById(this.data.data.id))&&(t=o.pixelToPoint(t),n=(e=o.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.leftTopPoint.x+=n,i.data.leftTopPoint.y+=e,this.data.data=Un({},i),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return D.Rectangle},e.prototype.getBox=function(){var t,e=this.context,n=null==e?void 0:e.getCtx();return e&&n&&this.data&&(n=e.getHistoryDataById(this.data.data.id))?(n=(e=hn.transformOriginToReal(e,n.data)).leftTopPoint,t=e.width,e=e.height,{leftTop:Un({},n),rightTop:{x:n.x+t,y:n.y},rightBottom:{x:n.x+t,y:n.y+e},leftBottom:{x:n.x,y:n.y+e}}):null},e.prototype.modifyDataByLeftTop=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x>e.rightTop.x||t.y>e.rightBottom.y||(o.data.leftTopPoint=n.pixelToPoint(t),o.data.width=n.distanceToActual(e.rightTop.x-t.x),o.data.height=n.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByCenterTop=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y>e.leftBottom.y||(o.data.leftTopPoint=n.pixelToPoint({x:e.leftTop.x,y:t.y}),o.data.height=n.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightTop=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y>e.leftBottom.y||(o.data.leftTopPoint=n.pixelToPoint({x:e.leftTop.x,y:t.y}),o.data.width=n.distanceToActual(t.x-e.leftTop.x),o.data.height=n.distanceToActual(e.rightBottom.y-t.y),0))},e.prototype.modifyDataByRightCenter=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||(o.data.width=n.distanceToActual(t.x-e.leftTop.x),0))},e.prototype.modifyDataByRightBottom=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.x<e.leftTop.x||t.y<e.leftTop.y||(o.data.width=n.distanceToActual(t.x-e.leftTop.x),o.data.height=n.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByCenterBottom=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();return!(!(n&&o&&this.data&&this.startPoint)||!(o=n.getHistoryDataById(this.data.data.id))||!(e=this.getBox())||t.y<e.leftTop.y||(o.data.height=n.distanceToActual(t.y-e.leftTop.y),0))},e.prototype.modifyDataByLeftBottom=function(t){var e,n,o=this.context,i=null==o?void 0:o.getCtx();return!(!(o&&i&&this.data&&this.startPoint)||!(i=o.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=o.pointToPixel(e),!(n=this.getBox()))||t.x>n.rightBottom.x||t.y<n.rightTop.y||(i.data.leftTopPoint=o.pixelToPoint({x:t.x,y:e.y}),i.data.width=o.distanceToActual(n.rightBottom.x-t.x),i.data.height=o.distanceToActual(t.y-n.rightTop.y),0))},e.prototype.modifyDataByLeftCenter=function(t){var e,n,o=this.context,i=null==o?void 0:o.getCtx();return!(!(o&&i&&this.data&&this.startPoint)||!(i=o.getHistoryDataById(this.data.data.id))||(e=i.data.leftTopPoint,e=o.pointToPixel(e),!(n=this.getBox()))||t.x>n.rightBottom.x||(i.data.leftTopPoint=o.pixelToPoint({x:t.x,y:e.y}),i.data.width=o.distanceToActual(n.rightBottom.x-t.x),0))},e.prototype.isCanMove=function(t){var e,n,o,i;return!!this.data&&(e=(n=hn.transformOriginToReal(this.context,null==(n=null==(n=null==this?void 0:this.data)?void 0:n.data)?void 0:n.data)).leftTopPoint,i=n.width,n=n.height,o=et.xmu([t.x,t.y]),i=et.yue([[[e.x,e.y],[e.x+i,e.y],[e.x+i,e.y+n],[e.x,e.y+n],[e.x,e.y]]]),et.FWy(o,i))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&hn.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var n,o;this.context&&this.data&&t&&e&&((n=Un({},this.data.data)).data=Un(Un({},n.data),{leftTopPoint:Un({},n.data.leftTopPoint)}),t=this.context.pixelToPoint(t),o=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,n.data)&&n.data.leftTopPoint&&(n.data.leftTopPoint.x+=o,n.data.leftTopPoint.y+=e,n.style&&(n.style.globalAlpha=Re.globalAlpha,n.style.strokeStyle=Re.strokeStyle,n.style.lineWidth=Re.lineWidth,n.style.lineDash=Re.lineDash,n.style.lineDashOffset=Re.lineDashOffset),hn.draw(this.context,this.context.getAssistCtx(),n))},e.prototype.destroy=function(){this.startIndex=-1,t.prototype.destroy.call(this)},e}(jn),Fn=Yn,Jn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Qn=function(){return(Qn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Vn=function(t){function e(e){return(e=t.call(this,e)||this).ResizeCursorMapping=new Map([[0,"ns-resize"],[1,"ew-resize"],[2,"ns-resize"],[3,"ew-resize"]]),e}return Jn(e,t),e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t){for(var e=(n=gn.transformOriginToReal(this.context,null==(n=null==(n=null==this?void 0:this.data)?void 0:n.data)?void 0:n.data)).center,n=n.outRadius,o=[{x:e.x,y:e.y-n},{x:e.x+n,y:e.y},{x:e.x,y:e.y+n},{x:e.x-n,y:e.y}],i=0;i<o.length;i++){var r=o[i];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(r.x,r.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}t.beginPath(),this.setAnchorLineStyle(),t.ellipse(e.x,e.y,n,n,45*Math.PI/180,0,2*Math.PI),t.closePath(),t.stroke()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,n=-1,o=(i=gn.transformOriginToReal(this.context,null==(i=null==(i=null==this?void 0:this.data)?void 0:i.data)?void 0:i.data)).center,i=i.outRadius,r=[{x:o.x,y:o.y-i},{x:o.x+i,y:o.y},{x:o.x,y:o.y+i},{x:o.x-i,y:o.y}],a=0;a<r.length;a++){var s=r[a],l=this.anchorRadius+this.anchorLineWidth;if(k.Z.isPointInCircle(t,{center:s,radius:l})){e=s,n=a;break}}return e&&-1!==n?{point:e,index:n}:null},e.prototype.setResizeCursorByIndex=function(t){var e,n;this.context&&(e=this.context.getCanvasEl(),n=this.context.getAssistCanvasEl(),e)&&n&&(t=this.ResizeCursorMapping.get(t),e.style.cursor=n.style.cursor=t)},e.prototype.drawModify=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();n&&o&&this.data&&this.startPoint&&(o=n.getHistoryDataById(this.data.data.id))&&(e=o.data.center,e=n.pointToPixel(e),o.data.outRadius=n.distanceToActual(k.Z.getDistanceByBetweenPoint({p1:e,p2:t})),o.data.innerRadius=o.data.outRadius/2,this.data.data=Qn({},o),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var n,o=this.context,i=null==o?void 0:o.getCtx();o&&i&&this.data&&(i=o.getHistoryDataById(this.data.data.id))&&(t=o.pixelToPoint(t),n=(e=o.pixelToPoint(e)).x-t.x,e=e.y-t.y,i.data.center.x+=n,i.data.center.y+=e,this.data.data=Qn({},i),o.clearDraw(),o.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return D.Start},e.prototype.isCanMove=function(t){if(!this.data)return!1;for(var e=(i=gn.transformOriginToReal(this.context,null==(i=null==(i=null==this?void 0:this.data)?void 0:i.data)?void 0:i.data)).center,n=i.outRadius,o=i.innerRadius,i=et.xmu([t.x,t.y]),r=[],a=0;a<5;a++)r.push({x:Math.cos((18+72*a)/180*Math.PI)*n+e.x,y:-Math.sin((18+72*a)/180*Math.PI)*n+e.y}),r.push({x:Math.cos((54+72*a)/180*Math.PI)*o+e.x,y:-Math.sin((54+72*a)/180*Math.PI)*o+e.y});var s=r.map((function(t){return[t.x,t.y]}));s.push(s[0]),s=et.yue([s]);return et.FWy(i,s)&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&gn.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var n,o;this.context&&this.data&&t&&e&&((n=Qn({},this.data.data)).data=Qn(Qn({},n.data),{center:Qn({},n.data.center)}),t=this.context.pixelToPoint(t),o=(e=this.context.pixelToPoint(e)).x-t.x,e=e.y-t.y,n.data)&&n.data.center&&(n.data.center.x+=o,n.data.center.y+=e,n.style&&(n.style.globalAlpha=Re.globalAlpha,n.style.strokeStyle=Re.strokeStyle,n.style.lineWidth=Re.lineWidth,n.style.lineDash=Re.lineDash,n.style.lineDashOffset=Re.lineDashOffset),gn.draw(this.context,this.context.getAssistCtx(),n))},e.prototype.setCursor=function(){},e}(jn),Xn=Vn,Kn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),qn=function(){return(qn=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},$n=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},to=function(t){function e(e){return(e=t.call(this,e)||this).rectangleAnchorPoints=[],e.indexToModifyHandlerMapping=new Map([[0,e.modifyDataByLeftTop],[1,e.modifyDataByCenterTop],[2,e.modifyDataByRightTop],[3,e.modifyDataByRightCenter],[4,e.modifyDataByRightBottom],[5,e.modifyDataByCenterBottom],[6,e.modifyDataByLeftBottom],[7,e.modifyDataByLeftCenter]]),e.ResizeCursorMapping=new Map([[0,"nwse-resize"],[1,"ns-resize"],[2,"nesw-resize"],[3,"ew-resize"],[4,"nwse-resize"],[5,"ns-resize"],[6,"nesw-resize"],[7,"ew-resize"]]),e}return Kn(e,t),e.prototype.setCursor=function(){throw new Error("Method not implemented.")},e.prototype.drawAnchors=function(){if(this.context){var t=this.context.getCtx();if(t)if((e=Tn.transformOriginToReal(this.context,null==(e=null==(e=null==this?void 0:this.data)?void 0:e.data)?void 0:e.data).points)&&e.length){var e,n={x:e[0].x,y:e[1].y},o=e[2].x-e[0].x,i=o/2,r=(e=e[2].y-e[1].y)/2;this.rectangleAnchorPoints=[qn({},n),{x:n.x+i,y:n.y},{x:n.x+o,y:n.y},{x:n.x+o,y:n.y+r},{x:n.x+o,y:n.y+e},{x:n.x+i,y:n.y+e},{x:n.x,y:n.y+e},{x:n.x,y:n.y+r}];for(var a=0;a<this.rectangleAnchorPoints.length;a++){var s=this.rectangleAnchorPoints[a];t.beginPath(),this.setAnchorCircleStyle(),t.ellipse(s.x,s.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),t.stroke(),t.fill()}t.beginPath(),this.setAnchorLineStyle(),t.moveTo(n.x,n.y),t.lineTo(n.x+o,n.y),t.lineTo(n.x+o,n.y+e),t.lineTo(n.x,n.y+e),t.lineTo(n.x,n.y),t.stroke()}}},e.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var e=null,n=-1,o=0;o<this.rectangleAnchorPoints.length;o++){var i=this.rectangleAnchorPoints[o],r=this.anchorRadius+this.anchorLineWidth;if(k.Z.isPointInCircle(t,{center:i,radius:r})){e=i,n=o;break}}return e&&-1!==n?{point:e,index:n}:null},e.prototype.setResizeCursorByIndex=function(t){var e,n;this.context&&(e=this.context.getCanvasEl(),n=this.context.getAssistCanvasEl(),e)&&n&&(e.style.cursor=n.style.cursor=this.ResizeCursorMapping.get(t))},e.prototype.drawModify=function(t){var e,n=this.context,o=null==n?void 0:n.getCtx();n&&o&&this.data&&this.startPoint&&(o=n.getHistoryDataById(this.data.data.id))&&(e=this.indexToModifyHandlerMapping.get(this.startIndex))&&e.call(this,t)&&(this.data.data=qn({},o),n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},e.prototype.drawMove=function(t,e){var n,o,i=this.context,r=null==i?void 0:i.getCtx();i&&r&&this.data&&(r=i.getHistoryDataById(this.data.data.id))&&(t=i.pixelToPoint(t),e=i.pixelToPoint(e),n=e.x-t.x,o=e.y-t.y,r.data.points.forEach((function(t){t.x+=n,t.y+=o})),this.data.data=qn({},r),i.clearDraw(),i.drawHistoryData(),this.drawAnchors())},e.prototype.getSelectType=function(){return D.Triangle},e.prototype.getBox=function(){var t,e,n=this.context;return n&&this.data&&(t=n.getHistoryDataById(this.data.data.id))&&(n=Tn.transformOriginToReal(n,t.data).points)&&n.length?(t={x:n[0].x,y:n[1].y},e=n[2].x-n[0].x,n=n[2].y-n[1].y,{leftTop:qn({},t),rightTop:{x:t.x+e,y:t.y},rightBottom:{x:t.x+e,y:t.y+n},leftBottom:{x:t.x,y:t.y+n}}):null},e.prototype.modifyDataByLeftTop=function(t){var e,n,o=this.context,i=null==o?void 0:o.getCtx();return!!(o&&i&&this.data&&this.startPoint)&&!!(i=o.getHistoryDataById(this.data.data.id))&&!(!(n=i.data.points)||!n.length||!(n=this.getBox())||t.x>n.rightTop.x||t.y>n.rightBottom.y||(e=n.rightTop.x-t.x,n=n.rightBottom.y-t.y,i.data.points=Tn.transformRealToOrigin(o,{points:[{x:t.x,y:t.y+n},{x:t.x+e/2,y:t.y},{x:t.x+e,y:t.y+n}]}).points,0))},e.prototype.modifyDataByCenterTop=function(t){var e,n,o,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(o=r.data.points)||!o.length||!(o=this.getBox())||t.y>o.leftBottom.y||(e={x:o.leftTop.x,y:t.y},n=o.rightTop.x-o.leftTop.x,o=o.rightBottom.y-t.y,r.data.points=Tn.transformRealToOrigin(i,{points:[{x:e.x,y:e.y+o},{x:e.x+n/2,y:e.y},{x:e.x+n,y:e.y+o}]}).points,0))},e.prototype.modifyDataByRightTop=function(t){var e,n,o,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(o=r.data.points)||!o.length||!(o=this.getBox())||t.x<o.leftTop.x||t.y>o.leftBottom.y||(e={x:o.leftTop.x,y:t.y},n=t.x-o.leftTop.x,o=o.rightBottom.y-t.y,r.data.points=Tn.transformRealToOrigin(i,{points:[{x:e.x,y:e.y+o},{x:e.x+n/2,y:e.y},{x:e.x+n,y:e.y+o}]}).points,0))},e.prototype.modifyDataByRightCenter=function(t){var e,n,o=this.context,i=null==o?void 0:o.getCtx();return!!(o&&i&&this.data&&this.startPoint)&&!!(i=o.getHistoryDataById(this.data.data.id))&&!(!(n=i.data.points)||!n.length||!(n=this.getBox())||t.x<n.leftTop.x||(e={x:n.leftTop.x,y:n.leftTop.y},t=t.x-n.leftTop.x,n=n.rightBottom.y-n.rightTop.y,i.data.points=Tn.transformRealToOrigin(o,{points:[{x:e.x,y:e.y+n},{x:e.x+t/2,y:e.y},{x:e.x+t,y:e.y+n}]}).points,0))},e.prototype.modifyDataByRightBottom=function(t){var e,n,o,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(e=r.data.points)||!e.length||!(e=this.getBox())||t.x<e.leftTop.x||t.y<e.leftTop.y||(n=qn({},e.leftTop),o=t.x-e.leftTop.x,t=t.y-e.leftTop.y,r.data.points=Tn.transformRealToOrigin(i,{points:[{x:n.x,y:n.y+t},{x:n.x+o/2,y:n.y},{x:n.x+o,y:n.y+t}]}).points,0))},e.prototype.modifyDataByCenterBottom=function(t){var e,n,o,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(e=r.data.points)||!e.length||!(e=this.getBox())||t.y<e.leftTop.y||(n=qn({},e.leftTop),o=e.rightTop.x-e.leftTop.x,t=t.y-e.leftTop.y,r.data.points=Tn.transformRealToOrigin(i,{points:[{x:n.x,y:n.y+t},{x:n.x+o/2,y:n.y},{x:n.x+o,y:n.y+t}]}).points,0))},e.prototype.modifyDataByLeftBottom=function(t){var e,n,o,i=this.context,r=null==i?void 0:i.getCtx();return!!(i&&r&&this.data&&this.startPoint)&&!!(r=i.getHistoryDataById(this.data.data.id))&&!(!(e=r.data.points)||!e.length||!(e=this.getBox())||t.x>e.rightBottom.x||t.y<e.rightTop.y||(n={x:t.x,y:e.leftTop.y},o=e.rightBottom.x-t.x,t=t.y-e.rightTop.y,r.data.points=Tn.transformRealToOrigin(i,{points:[{x:n.x,y:n.y+t},{x:n.x+o/2,y:n.y},{x:n.x+o,y:n.y+t}]}).points,0))},e.prototype.modifyDataByLeftCenter=function(t){var e,n,o=this.context,i=null==o?void 0:o.getCtx();return!!(o&&i&&this.data&&this.startPoint)&&!!(i=o.getHistoryDataById(this.data.data.id))&&!(!(n=i.data.points)||!n.length||!(n=this.getBox())||t.x>n.rightBottom.x||(e={x:t.x,y:n.leftTop.y},t=n.rightBottom.x-t.x,n=n.rightBottom.y-n.rightTop.y,i.data.points=Tn.transformRealToOrigin(o,{points:[{x:e.x,y:e.y+n},{x:e.x+t/2,y:e.y},{x:e.x+t,y:e.y+n}]}).points,0))},e.prototype.isCanMove=function(t){var e,n;return!!this.data&&((n=Tn.transformOriginToReal(this.context,{points:$n([],(null==(n=null==(n=null==(n=null==this?void 0:this.data)?void 0:n.data)?void 0:n.data)?void 0:n.points)||[],!0)}).points).push(n[0]),e=et.xmu([t.x,t.y]),n=et.yue([n.map((function(t){return[t.x,t.y]}))]),et.FWy(e,n))&&!this.getPointInAnchor(t)},e.prototype.drawMoveGeometry=function(){this.context&&this.data&&Tn.draw(this.context,this.context.getAssistCtx(),this.data)},e.prototype.drawMoveGeometry=function(t,e){var n,o,i;this.context&&this.data&&t&&e&&((n=qn({},this.data.data)).data=qn(qn({},n.data),{points:n.data.points.map((function(t){return qn({},t)}))}),t=this.context.pixelToPoint(t),e=this.context.pixelToPoint(e),o=e.x-t.x,i=e.y-t.y,n.data)&&n.data.points&&n.data.points.length&&(n.data.points.forEach((function(t){t.x+=o,t.y+=i})),n.style&&(n.style.globalAlpha=Re.globalAlpha,n.style.strokeStyle=Re.strokeStyle,n.style.lineWidth=Re.lineWidth,n.style.lineDash=Re.lineDash,n.style.lineDashOffset=Re.lineDashOffset),Tn.draw(this.context,this.context.getAssistCtx(),n))},e.prototype.destroy=function(){this.startIndex=-1,t.prototype.destroy.call(this)},e}(jn),eo=to,no={fillStyle:"#fff",strokeStyle:"#fff",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:1},oo={fillStyle:"#fff",strokeStyle:"#fff",lineWidth:1,lineCap:"round",lineJoin:"round",lineDash:[5,4,3],lineDashOffset:-1,globalAlpha:.6},io=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},ro=function(){function t(t){var e=t.context,n=t.id,o=t.coordinates,i=t.renderPosition,r=t.renderStep,a=t.renderCap;t=t.duration;this.id="",this.context=null,this.coordinates=[],this.duration=0,this.status=d.UnInit,this.boutTotal=0,this.bout=1,this.loopHeader=-1,this.loopPointEntitys=[],this.stepEntityIndexes=[],this.preLoopPixel=null,this.arrowMarker=null,this.context=e,this.id=n,this.coordinates=o,this.duration=t,this.renderPosition=i,this.renderStep=r,this.renderCap=a}return t.prototype.drawDefaultPosition=function(t,e){var n,o=this.context;o&&(n=o.getCtx())&&(o=o.pointToPixel({x:t.lng,y:t.lat}),n.beginPath(),n.strokeStyle="red",n.fillStyle="#fff",n.lineWidth=3,n.ellipse(o.x,o.y,6,6,45*Math.PI/180,0,2*Math.PI),n.stroke(),n.fill(),n.beginPath(),n.font="8px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle="#000",n.fillText("".concat(e+1),o.x,o.y,10))},t.prototype.createDefaultCap=function(){var t;if(this.context)return t=new BMap.Icon("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMxNDU2MzQ2NjYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQxMzYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTc4OC40OCA1MTJMMzEyLjMyIDc4Ni45MjM1MlYyMzcuMDk2OTZ6IiBwLWlkPSI0MTM3IiBmaWxsPSIjRkZBNTAwIj48L3BhdGg+PC9zdmc+",new BMap.Size(16,16)),new BMap.Marker(new BMap.Point(90,90),{icon:t})},t.prototype.updateCap=function(t){var e,n,o=(r=this).preLoopPixel,i=r.context,r=r.arrowMarker;i&&o&&r&&(i=i.pixelToPoint(t),e=t.x-o.x,n=t.y-o.y,Math.atan2(n,e),Math.PI,n=k.Z.slopToAngle(o,t,"geographic"),r.setPosition(new BMap.Point(i.x,i.y)),r.setRotation(n))},t.prototype.drawPosition=function(){var t,e,n=this,o=(e=this).renderPosition,i=e.coordinates;(e=e.context)&&(t=e.getCtx())&&i.forEach((function(e,i){o?o({ctx:t,coordinate:e}):n.drawDefaultPosition(e,i)}))},t.prototype.drawTrajectory=function(){this.drawPosition(),this.prepareLoopData();for(var t=1;t<this.boutTotal;t++)this.loopBout(t);this.drawLastFrame(),this.finishDeal()},t.prototype.drawLastFrame=function(){var t=this,e=t.loopPointEntitys,n=t.context,o=t.renderStep;t.renderCap,n&&(t=n.getCtx())&&(e=e[e.length-1],n=n.pointToPixel({x:e.point.lng,y:e.point.lat}),t.beginPath(),o?o(t,n):(this.setDrawLoopStyle(),t.lineTo(n.x,n.y),t.stroke(),this.preLoopPixel=null),this.updateCap(n))},t.prototype.setDrawLoopStyle=function(){var t=this.context;t&&(t=t.getCtx())&&(t.strokeStyle="orange",t.lineWidth=3)},t.prototype.finishDeal=function(){var t=this.context;t&&(t=t.getMap())&&(-1!==this.loopHeader&&"undefined"!=typeof window&&window.cancelAnimationFrame(this.loopHeader),this.loopHeader=-1,this.bout=1,this.boutTotal=0,this.loopPointEntitys=[],this.stepEntityIndexes=[],this.preLoopPixel=null,this.arrowMarker&&t.removeOverlay(this.arrowMarker),this.arrowMarker=null)},t.prototype.loopBout=function(t){var e=(l=this).context,n=l.loopPointEntitys,o=l.stepEntityIndexes,i=l.renderStep,r=l.renderCap;if(e){var a=e.getCtx();if(a)for(var s=e.getMap(),l=1===t?0:o[t-2],c=o[t-1],u=l;u<c;u++){var p=n[u].point;p=e.pointToPixel({x:p.lng,y:p.lat});this.preLoopPixel?this.updateCap(p):(this.arrowMarker=r?r():this.createDefaultCap(),s.addOverlay(this.arrowMarker)),i?i(a,p):this.preLoopPixel?(a.lineTo(p.x,p.y),a.stroke(),a.beginPath(),this.setDrawLoopStyle(),a.moveTo(p.x,p.y)):(a.beginPath(),this.setDrawLoopStyle(),a.moveTo(p.x,p.y),this.preLoopPixel=p)}}},t.prototype.loop=function(){var t=this;"undefined"!=typeof window&&(this.loopHeader=window.requestAnimationFrame((function(){var e;t.status===d.Pause?t.loop():(e=t.context)&&e.getCtx()&&(t.loopBout(t.bout),t.bout++,t.bout>=t.boutTotal?(t.drawLastFrame(),t.finishDeal(),t.status=d.End):t.loop())})))},t.prototype.prepareLoopData=function(){for(var t=this,e=this.duration,n=this.coordinates,o=[],i=(n.reduce((function(t,e,i){return i=0===i?0:et.vs3(et.TE$(et.xmu([n[i-1].lng,n[i-1].lat]),et.xmu([e.lng,e.lat]),{units:"kilometers"}),"kilometers","meters"),o.push({point:e,distance:t+i,isStep:!1}),t+i}),0),et.TuJ(n.map((function(t){return[t.lng,t.lat]})))),r=et.vs3(et.kE(i,{units:"kilometers"}),"kilometers","meters"),a=(this.boutTotal=60*e,r/this.boutTotal),s=[],l=0;l<this.boutTotal;l++){var c=(l+1)*a,u=et.$1t(i,et.vs3(c,"meters","kilometers"),{units:"kilometers"});s.push({point:{lng:u.geometry.coordinates[0],lat:u.geometry.coordinates[1]},distance:c,isStep:!0})}this.loopPointEntitys=io(io([],o,!0),s,!0),this.loopPointEntitys.sort((function(t,e){return t.distance>e.distance?1:t.distance<e.distance?-1:0})),this.stepEntityIndexes=[],this.loopPointEntitys.forEach((function(e,n){e.isStep&&t.stepEntityIndexes.push(n)}))},t.prototype.init=function(){this.status===d.UnInit&&(this.drawPosition(),this.status=d.Init)},t.prototype.start=function(){var t=this.context;t&&t.getCtx()&&[d.Init,d.End,d.Pause].includes(this.status)&&([d.Pause,d.End].includes(this.status)&&(d.Pause===this.status&&this.finishDeal(),t.clear(),t.drawHistory()),this.status=d.Running,this.prepareLoopData(),this.loop())},t.prototype.pause=function(){this.status=d.Pause},t.prototype.resume=function(){this.status=d.Running},t.prototype.finish=function(){this.context&&![d.End,d.Destroy].includes(this.status)&&(this.finishDeal(),this.status=d.End)},t.prototype.destroy=function(){var t;this.status!==d.Destroy&&(t=this.context)&&(this.finishDeal(),t.clear(),this.status=d.Destroy,t.removeTrajectoryById(this.id))},t.prototype.getId=function(){return this.id},t.prototype.getStatus=function(){return this.status},t.prototype.drawHistory=function(){var t=this.status;if(d.Init===t?this.drawPosition():d.End===t&&this.drawTrajectory(),[d.Pause,d.Running].includes(t)){this.drawPosition();for(var e=1;e<this.bout;e++)this.loopBout(e)}},t}(),ao=ro,so=function(){var t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),lo=function(){return(lo=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},co=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||((o=o||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},uo=function(t){function e(e,n){var o=this;return o.update=o.update.bind(o),(o=t.call(this,{update:o.update,paneName:n.paneName,zIndex:n.zIndex})||this).emitter=new G.Z.Events,o.isLoad=!1,o.source=[],o.el=null,o.canvasEl=null,o.ctx=null,o.map=e,o.config=lo({},n),o}return so(e,t),e.prototype.initCanvas=function(){this.el=this.canvas.parentElement,this.canvasEl=this.canvas,this.el.style.width="".concat(this.canvasEl.width,"px"),this.el.style.height="".concat(this.canvasEl.height,"px"),this.canvasEl.className="".concat("adhere-ui-trajectoryplaybacklayer"),this.ctx=this.canvasEl.getContext("2d"),this.emitter.trigger(w.CanvasMount)},e.prototype.firstLoad=function(){this.initCanvas()},e.prototype.update=function(){var t=this.canvas.getContext("2d");t&&(this.isLoad||this.firstLoad(),this.isLoad=!0,t.clearRect(0,0,t.canvas.width,t.canvas.height),this.drawHistory())},e.prototype.getMap=function(){return this.map},e.prototype.getCtx=function(){return this.ctx},e.prototype.getCanvasEl=function(){return this.canvasEl},e.prototype.getEmitter=function(){return this.emitter},e.prototype.pixelToPoint=function(t){return{x:(t=this.map.pixelToPoint(t)).lng,y:t.lat}},e.prototype.pointToPixel=function(t){return this.map.pointToPixel(new BMap.Point(t.x,t.y))},e.prototype.distanceToActual=function(t){return t/F.default.getScale(this.map)},e.prototype.actualToDistance=function(t){return F.default.getScale(this.map)*t},e.prototype.addTrajectory=function(t){this.hasTrajectoryById(t.getId())||(this.source.push(t),t.init())},e.prototype.removeTrajectory=function(t){this.removeTrajectoryById(t.getId())},e.prototype.removeTrajectoryById=function(t){var e=this.source.findIndex((function(e){return e.getId()===t}));-1!==e&&(this.source[e].destroy(),this.source.splice(e,1))},e.prototype.clean=function(){this.source.forEach((function(t){return t.destroy()})),this.source=[]},e.prototype.getTrajectoryById=function(t){return this.source.find((function(e){return e.getId()===t}))},e.prototype.getTrajectorys=function(){return co([],this.source,!0)},e.prototype.hasTrajectoryById=function(t){return!!this.getTrajectoryById(t)},e.prototype.clear=function(){var t=this.getCtx(),e=this.getCanvasEl();t&&e&&t.clearRect(0,0,e.width,e.height)},e.prototype.drawHistory=function(){this.source.filter((function(t){return t.getStatus()!==d.Destroy})).forEach((function(t){t.drawHistory()}))},e}(BMap.CanvasLayer),po=uo}}]);